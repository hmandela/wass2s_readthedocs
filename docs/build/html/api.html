

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>API Reference &mdash; wass2s: A python-based tool for seasonal climate forecast in West Africa and the Sahel. 0.3.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=1e28cc32"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Implementation of WAS-NextGen Approaches" href="ImplementWASNextGen.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            wass2s: A python-based tool for seasonal climate forecast in West Africa and the Sahel.
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-documentation">Module Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_download">wass2s.was_download module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_download.WAS_Download"><code class="docutils literal notranslate"><span class="pre">WAS_Download</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_download.plot_map"><code class="docutils literal notranslate"><span class="pre">plot_map()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_transformdata">wass2s.was_transformdata module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_transformdata.WAS_TransformData"><code class="docutils literal notranslate"><span class="pre">WAS_TransformData</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_transformdata.inv_boxcox"><code class="docutils literal notranslate"><span class="pre">inv_boxcox()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_compute_predictand">wass2s.was_compute_predictand module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.ETCCDIHeatWaveIndices"><code class="docutils literal notranslate"><span class="pre">ETCCDIHeatWaveIndices</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.ETCCDITempIndices"><code class="docutils literal notranslate"><span class="pre">ETCCDITempIndices</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.ExtremeType"><code class="docutils literal notranslate"><span class="pre">ExtremeType</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.HeatWaveDefinition"><code class="docutils literal notranslate"><span class="pre">HeatWaveDefinition</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.HeatWaveMetric"><code class="docutils literal notranslate"><span class="pre">HeatWaveMetric</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices"><code class="docutils literal notranslate"><span class="pre">WAS_HeatWaveIndices</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_PrecipIndices"><code class="docutils literal notranslate"><span class="pre">WAS_PrecipIndices</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices"><code class="docutils literal notranslate"><span class="pre">WAS_TempPercentileIndices</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_compute_cessation"><code class="docutils literal notranslate"><span class="pre">WAS_compute_cessation</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell"><code class="docutils literal notranslate"><span class="pre">WAS_compute_cessation_dry_spell</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_compute_onset"><code class="docutils literal notranslate"><span class="pre">WAS_compute_onset</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell"><code class="docutils literal notranslate"><span class="pre">WAS_compute_onset_dry_spell</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_count_dry_spells"><code class="docutils literal notranslate"><span class="pre">WAS_count_dry_spells</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_count_rainy_days"><code class="docutils literal notranslate"><span class="pre">WAS_count_rainy_days</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_count_wet_spells"><code class="docutils literal notranslate"><span class="pre">WAS_count_wet_spells</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_bias_correction">wass2s.was_bias_correction module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_bias_correction.WAS_Qmap"><code class="docutils literal notranslate"><span class="pre">WAS_Qmap</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_bias_correction.WAS_bias_correction"><code class="docutils literal notranslate"><span class="pre">WAS_bias_correction</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_merge_predictand">wass2s.was_merge_predictand module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_merge_predictand.WAS_Merging"><code class="docutils literal notranslate"><span class="pre">WAS_Merging</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_cross_validate">wass2s.was_cross_validate module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_cross_validate.CustomTimeSeriesSplit"><code class="docutils literal notranslate"><span class="pre">CustomTimeSeriesSplit</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_cross_validate.WAS_Cross_Validator"><code class="docutils literal notranslate"><span class="pre">WAS_Cross_Validator</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_linear_models">wass2s.was_linear_models module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_linear_models.WAS_ElasticNet_Model"><code class="docutils literal notranslate"><span class="pre">WAS_ElasticNet_Model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_linear_models.WAS_LassoLars_Model"><code class="docutils literal notranslate"><span class="pre">WAS_LassoLars_Model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_linear_models.WAS_Lasso_Model"><code class="docutils literal notranslate"><span class="pre">WAS_Lasso_Model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_linear_models.WAS_LinearRegression_Model"><code class="docutils literal notranslate"><span class="pre">WAS_LinearRegression_Model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_linear_models.WAS_Ridge_Model"><code class="docutils literal notranslate"><span class="pre">WAS_Ridge_Model</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_eof">wass2s.was_eof module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_eof.WAS_EOF"><code class="docutils literal notranslate"><span class="pre">WAS_EOF</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_pcr">wass2s.was_pcr module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_pcr.WAS_PCR"><code class="docutils literal notranslate"><span class="pre">WAS_PCR</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_cca">wass2s.was_cca module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_cca.WAS_CCA"><code class="docutils literal notranslate"><span class="pre">WAS_CCA</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_machine_learning">wass2s.was_machine_learning module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.BaseOptimizer"><code class="docutils literal notranslate"><span class="pre">BaseOptimizer</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.MARS"><code class="docutils literal notranslate"><span class="pre">MARS</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model"><code class="docutils literal notranslate"><span class="pre">WAS_LogisticRegression_Model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_MARS_Model"><code class="docutils literal notranslate"><span class="pre">WAS_MARS_Model</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_MLP"><code class="docutils literal notranslate"><span class="pre">WAS_MLP</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_PoissonRegression"><code class="docutils literal notranslate"><span class="pre">WAS_PoissonRegression</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_PolynomialRegression"><code class="docutils literal notranslate"><span class="pre">WAS_PolynomialRegression</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking"><code class="docutils literal notranslate"><span class="pre">WAS_RandomForest_XGBoost_ML_Stacking</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP"><code class="docutils literal notranslate"><span class="pre">WAS_RandomForest_XGBoost_Stacking_MLP</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_SVR"><code class="docutils literal notranslate"><span class="pre">WAS_SVR</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge"><code class="docutils literal notranslate"><span class="pre">WAS_Stacking_Ridge</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_analog">wass2s.was_analog module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_analog.WAS_Analog"><code class="docutils literal notranslate"><span class="pre">WAS_Analog</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_verification">wass2s.was_verification module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_verification.WAS_Verification"><code class="docutils literal notranslate"><span class="pre">WAS_Verification</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.was_mme">wass2s.was_mme module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.EP_Gene"><code class="docutils literal notranslate"><span class="pre">EP_Gene</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.EP_Individual"><code class="docutils literal notranslate"><span class="pre">EP_Individual</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.HPELMWrapper"><code class="docutils literal notranslate"><span class="pre">HPELMWrapper</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.Roebber2015Config"><code class="docutils literal notranslate"><span class="pre">Roebber2015Config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_EnsembleBMA"><code class="docutils literal notranslate"><span class="pre">WAS_EnsembleBMA</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_GaussianBMA_EM"><code class="docutils literal notranslate"><span class="pre">WAS_GaussianBMA_EM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop"><code class="docutils literal notranslate"><span class="pre">WAS_GaussianDressing_WangBishop</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_Min2009_ProbWeighted"><code class="docutils literal notranslate"><span class="pre">WAS_Min2009_ProbWeighted</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_PrecipBMA_SchmeitsKok2010"><code class="docutils literal notranslate"><span class="pre">WAS_PrecipBMA_SchmeitsKok2010</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007"><code class="docutils literal notranslate"><span class="pre">WAS_PrecipBMA_Sloughter2007</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_ProbWeighted"><code class="docutils literal notranslate"><span class="pre">WAS_ProbWeighted</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_MLP"><code class="docutils literal notranslate"><span class="pre">WAS_mme_MLP</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_MLP_"><code class="docutils literal notranslate"><span class="pre">WAS_mme_MLP_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_MVA"><code class="docutils literal notranslate"><span class="pre">WAS_mme_MVA</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_NGR"><code class="docutils literal notranslate"><span class="pre">WAS_mme_NGR</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_RF"><code class="docutils literal notranslate"><span class="pre">WAS_mme_RF</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_RF_"><code class="docutils literal notranslate"><span class="pre">WAS_mme_RF_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_Roebber2015"><code class="docutils literal notranslate"><span class="pre">WAS_mme_Roebber2015</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_Stacking"><code class="docutils literal notranslate"><span class="pre">WAS_mme_Stacking</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_Stacking_"><code class="docutils literal notranslate"><span class="pre">WAS_mme_Stacking_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_Weighted"><code class="docutils literal notranslate"><span class="pre">WAS_mme_Weighted</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_XGBoosting"><code class="docutils literal notranslate"><span class="pre">WAS_mme_XGBoosting</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_XGBoosting_"><code class="docutils literal notranslate"><span class="pre">WAS_mme_XGBoosting_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_gaussian_process"><code class="docutils literal notranslate"><span class="pre">WAS_mme_gaussian_process</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_hpELM"><code class="docutils literal notranslate"><span class="pre">WAS_mme_hpELM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_hpELM_"><code class="docutils literal notranslate"><span class="pre">WAS_mme_hpELM_</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_logistic"><code class="docutils literal notranslate"><span class="pre">WAS_mme_logistic</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_xcELM"><code class="docutils literal notranslate"><span class="pre">WAS_mme_xcELM</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_xcELR"><code class="docutils literal notranslate"><span class="pre">WAS_mme_xcELR</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.compute_gridpoint_terciles_from_obs"><code class="docutils literal notranslate"><span class="pre">compute_gridpoint_terciles_from_obs()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.myfill"><code class="docutils literal notranslate"><span class="pre">myfill()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.predict_fast"><code class="docutils literal notranslate"><span class="pre">predict_fast()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.was_mme.process_datasets_for_mme"><code class="docutils literal notranslate"><span class="pre">process_datasets_for_mme()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-wass2s.utils">wass2s.utils module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.anomalize_timeseries"><code class="docutils literal notranslate"><span class="pre">anomalize_timeseries()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.build_iridl_url_ersst"><code class="docutils literal notranslate"><span class="pre">build_iridl_url_ersst()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.compute_other_indices"><code class="docutils literal notranslate"><span class="pre">compute_other_indices()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.compute_sst_indices"><code class="docutils literal notranslate"><span class="pre">compute_sst_indices()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.decode_cf"><code class="docutils literal notranslate"><span class="pre">decode_cf()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.download_file"><code class="docutils literal notranslate"><span class="pre">download_file()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.et0_fao56_daily"><code class="docutils literal notranslate"><span class="pre">et0_fao56_daily()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.extraterrestrial_radiation"><code class="docutils literal notranslate"><span class="pre">extraterrestrial_radiation()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.find_best_distribution_grid"><code class="docutils literal notranslate"><span class="pre">find_best_distribution_grid()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.fix_time_coord"><code class="docutils literal notranslate"><span class="pre">fix_time_coord()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.get_best_models"><code class="docutils literal notranslate"><span class="pre">get_best_models()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.load_gridded_predictor"><code class="docutils literal notranslate"><span class="pre">load_gridded_predictor()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.parse_variable"><code class="docutils literal notranslate"><span class="pre">parse_variable()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.plot_date"><code class="docutils literal notranslate"><span class="pre">plot_date()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.plot_map"><code class="docutils literal notranslate"><span class="pre">plot_map()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.plot_prob_forecasts"><code class="docutils literal notranslate"><span class="pre">plot_prob_forecasts()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.plot_prob_forecasts1"><code class="docutils literal notranslate"><span class="pre">plot_prob_forecasts1()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.plot_prob_forecasts2"><code class="docutils literal notranslate"><span class="pre">plot_prob_forecasts2()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.plot_tercile"><code class="docutils literal notranslate"><span class="pre">plot_tercile()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.pre_process_biophysical_model"><code class="docutils literal notranslate"><span class="pre">pre_process_biophysical_model()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.predictant_mask"><code class="docutils literal notranslate"><span class="pre">predictant_mask()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.prepare_predictand"><code class="docutils literal notranslate"><span class="pre">prepare_predictand()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.proceed_seasonal_daily_bias_correction"><code class="docutils literal notranslate"><span class="pre">proceed_seasonal_daily_bias_correction()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.process_model_for_other_params"><code class="docutils literal notranslate"><span class="pre">process_model_for_other_params()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.retrieve_several_zones_for_PCR"><code class="docutils literal notranslate"><span class="pre">retrieve_several_zones_for_PCR()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.retrieve_single_zone_for_PCR"><code class="docutils literal notranslate"><span class="pre">retrieve_single_zone_for_PCR()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.reverse_standardize"><code class="docutils literal notranslate"><span class="pre">reverse_standardize()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.standardize_timeseries"><code class="docutils literal notranslate"><span class="pre">standardize_timeseries()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.svp"><code class="docutils literal notranslate"><span class="pre">svp()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.to_iridl_lat"><code class="docutils literal notranslate"><span class="pre">to_iridl_lat()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.to_iridl_lon"><code class="docutils literal notranslate"><span class="pre">to_iridl_lon()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.trend_data"><code class="docutils literal notranslate"><span class="pre">trend_data()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#wass2s.utils.verify_station_network"><code class="docutils literal notranslate"><span class="pre">verify_station_network()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">wass2s: A python-based tool for seasonal climate forecast in West Africa and the Sahel.</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">API Reference</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/api.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="api-reference">
<h1>API Reference<a class="headerlink" href="#api-reference" title="Link to this heading"></a></h1>
<p>This page contains the API reference for the wass2s package.</p>
<section id="module-documentation">
<span id="modules"></span><h2>Module Documentation<a class="headerlink" href="#module-documentation" title="Link to this heading"></a></h2>
<section id="module-wass2s.was_download">
<span id="wass2s-was-download-module"></span><h3>wass2s.was_download module<a class="headerlink" href="#module-wass2s.was_download" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_download.</span></span><span class="sig-name descname"><span class="pre">WAS_Download</span></span><a class="headerlink" href="#wass2s.was_download.WAS_Download" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.AgroObsName">
<span class="sig-name descname"><span class="pre">AgroObsName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'AGRO.DSWR':</span> <span class="pre">('solar_radiation_flux',</span> <span class="pre">None),</span> <span class="pre">'AGRO.ETP':</span> <span class="pre">('reference_evapotranspiration',</span> <span class="pre">None),</span> <span class="pre">'AGRO.HUMAX':</span> <span class="pre">('2m_relative_humidity_derived',</span> <span class="pre">'24_hour_maximum'),</span> <span class="pre">'AGRO.HUMIN':</span> <span class="pre">('2m_relative_humidity_derived',</span> <span class="pre">'24_hour_minimum'),</span> <span class="pre">'AGRO.PRCP':</span> <span class="pre">('precipitation_flux',</span> <span class="pre">None),</span> <span class="pre">'AGRO.TEMP':</span> <span class="pre">('2m_temperature',</span> <span class="pre">'24_hour_mean'),</span> <span class="pre">'AGRO.TMAX':</span> <span class="pre">('2m_temperature',</span> <span class="pre">'24_hour_maximum'),</span> <span class="pre">'AGRO.TMIN':</span> <span class="pre">('2m_temperature',</span> <span class="pre">'24_hour_minimum'),</span> <span class="pre">'AGRO.WFF':</span> <span class="pre">('10m_wind_speed',</span> <span class="pre">'24_hour_mean')}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.AgroObsName" title="Link to this definition"></a></dt>
<dd><p>Generate a dictionary for agrometeorological observation variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>variables</strong> (<em>dict</em>) – Mapping of agro variable short names to full names.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary mapping agro variables to their corresponding full names.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.ModelsName">
<span class="sig-name descname"><span class="pre">ModelsName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centre</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'BOM_2':</span> <span class="pre">'bom',</span> <span class="pre">'CFSV2_1':</span> <span class="pre">'cfsv2',</span> <span class="pre">'CMC1_1':</span> <span class="pre">'cmc1',</span> <span class="pre">'CMC2_1':</span> <span class="pre">'cmc2',</span> <span class="pre">'CMCC_35':</span> <span class="pre">'cmcc',</span> <span class="pre">'DWD_21':</span> <span class="pre">'dwd',</span> <span class="pre">'DWD_22':</span> <span class="pre">'dwd',</span> <span class="pre">'ECCC_4':</span> <span class="pre">'eccc',</span> <span class="pre">'ECCC_5':</span> <span class="pre">'eccc',</span> <span class="pre">'ECMWF_51':</span> <span class="pre">'ecmwf',</span> <span class="pre">'GFDL_1':</span> <span class="pre">'gfdl',</span> <span class="pre">'JMA_3':</span> <span class="pre">'jma',</span> <span class="pre">'METEOFRANCE_8':</span> <span class="pre">'meteo_france',</span> <span class="pre">'METEOFRANCE_9':</span> <span class="pre">'meteo_france',</span> <span class="pre">'NASA_1':</span> <span class="pre">'nasa',</span> <span class="pre">'NCAR_CCSM4_1':</span> <span class="pre">'ncar_ccsm4',</span> <span class="pre">'NCAR_CESM1_1':</span> <span class="pre">'ncar_cesm1',</span> <span class="pre">'NCEP_2':</span> <span class="pre">'ncep',</span> <span class="pre">'NMME_1':</span> <span class="pre">'nmme',</span> <span class="pre">'UKMO_603':</span> <span class="pre">'ukmo',</span> <span class="pre">'UKMO_604':</span> <span class="pre">'ukmo'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'DLWR':</span> <span class="pre">'surface_thermal_radiation_downwards',</span> <span class="pre">'DSWR':</span> <span class="pre">'surface_solar_radiation_downwards',</span> <span class="pre">'NOLR':</span> <span class="pre">'top_net_thermal_radiation',</span> <span class="pre">'PRCP':</span> <span class="pre">'total_precipitation',</span> <span class="pre">'RUNOFF':</span> <span class="pre">'mean_surface_runoff_rate',</span> <span class="pre">'SLP':</span> <span class="pre">'mean_sea_level_pressure',</span> <span class="pre">'SST':</span> <span class="pre">'sea_surface_temperature',</span> <span class="pre">'TDEW':</span> <span class="pre">'2m_dewpoint_temperature',</span> <span class="pre">'TEMP':</span> <span class="pre">'2m_temperature',</span> <span class="pre">'TMAX':</span> <span class="pre">'maximum_2m_temperature_in_the_last_24_hours',</span> <span class="pre">'TMIN':</span> <span class="pre">'minimum_2m_temperature_in_the_last_24_hours',</span> <span class="pre">'UGRD10':</span> <span class="pre">'10m_u_component_of_wind',</span> <span class="pre">'VGRD10':</span> <span class="pre">'10m_v_component_of_wind'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'HUSS_1000':</span> <span class="pre">'specific_humidity',</span> <span class="pre">'HUSS_850':</span> <span class="pre">'specific_humidity',</span> <span class="pre">'HUSS_925':</span> <span class="pre">'specific_humidity',</span> <span class="pre">'UGRD_1000':</span> <span class="pre">'u_component_of_wind',</span> <span class="pre">'UGRD_850':</span> <span class="pre">'u_component_of_wind',</span> <span class="pre">'UGRD_925':</span> <span class="pre">'u_component_of_wind',</span> <span class="pre">'VGRD_1000':</span> <span class="pre">'v_component_of_wind',</span> <span class="pre">'VGRD_850':</span> <span class="pre">'v_component_of_wind',</span> <span class="pre">'VGRD_925':</span> <span class="pre">'v_component_of_wind'}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.ModelsName" title="Link to this definition"></a></dt>
<dd><p>Generate a combined dictionary of model names and variables.
For more information on C3S, browse the <a class="reference external" href="https://confluence.ecmwf.int/display/CKB/Description+of+the+C3S+seasonal+multi-system">MetaData</a>.
For more information on NMME, browse the <a class="reference external" href="https://confluence.ecmwf.int/display/CKB/Description+of+the+C3S+seasonal+multi-system">MetaData</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centre</strong> (<em>dict</em>) – Mapping of model identifiers to model names.</p></li>
<li><p><strong>variables_1</strong> (<em>dict</em>) – Mapping of variable short names to full names for category 1.</p></li>
<li><p><strong>variables_2</strong> (<em>dict</em>) – Mapping of variable short names to full names for category 2.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A combined dictionary with keys as model.variable combinations and values as tuples (model name, variable name).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.ReanalysisName">
<span class="sig-name descname"><span class="pre">ReanalysisName</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centre</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'ERA5':</span> <span class="pre">'reanalysis</span> <span class="pre">ERA5',</span> <span class="pre">'NOAA':</span> <span class="pre">'NOAA</span> <span class="pre">ERSST'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'DLWR':</span> <span class="pre">'surface_thermal_radiation_downwards',</span> <span class="pre">'DSWR':</span> <span class="pre">'surface_solar_radiation_downwards',</span> <span class="pre">'NOLR':</span> <span class="pre">'top_thermal_radiation',</span> <span class="pre">'PRCP':</span> <span class="pre">'total_precipitation',</span> <span class="pre">'SLP':</span> <span class="pre">'mean_sea_level_pressure',</span> <span class="pre">'SST':</span> <span class="pre">'sea_surface_temperature',</span> <span class="pre">'TEMP':</span> <span class="pre">'2m_temperature',</span> <span class="pre">'UGRD10':</span> <span class="pre">'10m_u_component_of_wind',</span> <span class="pre">'VGRD10':</span> <span class="pre">'10m_v_component_of_wind'}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_2</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{'HUSS_1000':</span> <span class="pre">'specific_humidity',</span> <span class="pre">'HUSS_850':</span> <span class="pre">'specific_humidity',</span> <span class="pre">'HUSS_925':</span> <span class="pre">'specific_humidity',</span> <span class="pre">'UGRD_1000':</span> <span class="pre">'u_component_of_wind',</span> <span class="pre">'UGRD_850':</span> <span class="pre">'u_component_of_wind',</span> <span class="pre">'UGRD_925':</span> <span class="pre">'u_component_of_wind',</span> <span class="pre">'VGRD_1000':</span> <span class="pre">'v_component_of_wind',</span> <span class="pre">'VGRD_850':</span> <span class="pre">'v_component_of_wind',</span> <span class="pre">'VGRD_925':</span> <span class="pre">'v_component_of_wind'}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.ReanalysisName" title="Link to this definition"></a></dt>
<dd><p>Generate a combined dictionary of reanalysis names and variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centre</strong> (<em>dict</em>) – Mapping of reanalysis identifiers to reanalysis names.</p></li>
<li><p><strong>variables_1</strong> (<em>dict</em>) – Mapping of variable short names to full names for category 1.</p></li>
<li><p><strong>variables_2</strong> (<em>dict</em>) – Mapping of variable short names to full names for category 2.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A combined dictionary with keys as reanalysis.variable combinations and values as tuples (reanalysis name, variable name).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_AgroIndicators">
<span class="sig-name descname"><span class="pre">WAS_Download_AgroIndicators</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['01',</span> <span class="pre">'02',</span> <span class="pre">'03']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_delay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_AgroIndicators" title="Link to this definition"></a></dt>
<dd><p>Download agro-meteorological indicators for specified variables, years, and months,
handling cross-year seasons (e.g., NDJ) with retries for failed downloads.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory to save the downloaded files.</p></li>
<li><p><strong>variables</strong> (<em>list</em>) – List of shorthand variables (e.g., [“AGRO.PRCP”, “AGRO.TMAX”]).</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year for the data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year for the data.</p></li>
<li><p><strong>area</strong> (<em>list</em>) – Bounding box as [North, West, South, East].</p></li>
<li><p><strong>seas</strong> (<em>list</em>) – List of months (e.g., [“11”,”12”,”01”] for NDJ).</p></li>
<li><p><strong>force_download</strong> (<em>bool</em>) – If True, forces download even if file exists.</p></li>
<li><p><strong>max_retries</strong> (<em>int</em>) – Maximum number of retry attempts for failed downloads (default: 3).</p></li>
<li><p><strong>retry_delay</strong> (<em>int</em>) – Seconds to wait between retry attempts (default: 5).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_AgroIndicators_daily">
<span class="sig-name descname"><span class="pre">WAS_Download_AgroIndicators_daily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_delay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_AgroIndicators_daily" title="Link to this definition"></a></dt>
<dd><p>Download daily agro-meteorological indicators from the Copernicus Data Store (CDS)
for specified variables and years, with retries for failed downloads.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em><em> or </em><em>pathlib.Path</em>) – Directory path where the downloaded NetCDF files will be saved.
The directory will be created if it does not exist.</p></li>
<li><p><strong>variables</strong> (<em>list</em><em> of </em><em>str</em>) – List of variable shorthand names to download. Valid options are:
[“AGRO.PRCP”, “AGRO.TMAX”, “AGRO.TEMP”, “AGRO.TMIN”, “AGRO.DSWR”,
“AGRO.ETP”, “AGRO.WFF”, “AGRO.HUMAX”, “AGRO.HUMIN”].
Each variable corresponds to a CDS variable and optional statistic
(e.g., “AGRO.PRCP” maps to “precipitation_flux”).</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year for the data to download (inclusive).</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year for the data to download (inclusive).</p></li>
<li><p><strong>area</strong> (<em>list</em><em> of </em><em>float</em>) – Bounding box for spatial subsetting in the format [North, West, South, East].
Example: [50, -10, 40, 10] for a region in Europe.</p></li>
<li><p><strong>force_download</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, forces download even if the output file exists. Default is False.</p></li>
<li><p><strong>max_retries</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of retry attempts for failed downloads. Default is 3.</p></li>
<li><p><strong>retry_delay</strong> (<em>int</em><em>, </em><em>optional</em>) – Seconds to wait between retry attempts. Default is 5.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The function saves NetCDF files to <cite>dir_to_save</cite> but does not return a value.
Output files are named as <cite>Daily_&lt;variable&gt;_&lt;year_start&gt;_&lt;year_end&gt;.nc</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The function downloads data from the CDS dataset “sis-agrometeorological-indicators”.</p></li>
<li><p>Data is downloaded year-by-year as ZIP files containing NetCDF files, which are</p></li>
</ul>
<p>extracted, concatenated, and saved as a single NetCDF file per variable.
- Temperature variables (“AGRO.TMIN”, “AGRO.TEMP”, “AGRO.TMAX”) are converted
from Kelvin to Celsius.
- Solar radiation (“AGRO.DSWR”) is converted from J/m^2/day to W/m^2.
- Coordinates are renamed to “X” (longitude), “Y” (latitude), and “T” (time),
with latitude flipped to ascending order.
- The function requires a valid CDS API key configured in <cite>~/.cdsapirc</cite>.
- Downloads are skipped for a variable if any year’s data fails to download
after <cite>max_retries</cite> attempts to ensure data completeness.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_CHIRPSv3_Daily">
<span class="sig-name descname"><span class="pre">WAS_Download_CHIRPSv3_Daily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blend_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ERA5'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_delay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_CHIRPSv3_Daily" title="Link to this definition"></a></dt>
<dd><p>Download daily CHIRPS v3.0 precipitation (blended with ERA5 or IMERGlate-v07) from the Copernicus Data Store (CDS)
for specified years, with retries for failed downloads.
:param dir_to_save: Directory path where the downloaded NetCDF files will be saved.</p>
<blockquote>
<div><p>The directory will be created if it does not exist.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>year_start</strong> (<em>int</em>) – Start year for the data to download (inclusive).</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year for the data to download (inclusive).</p></li>
<li><p><strong>blend_type</strong> (<em>str</em>) – Blend type, either “ERA5” or “IMERGlate-v07” (default: “ERA5”).
Note: IMERGlate-v07 availability starts from ~2000; earlier years may fail.</p></li>
<li><p><strong>area</strong> (<em>list</em><em> of </em><em>float</em>) – Bounding box for spatial subsetting in the format [North, West, South, East].</p></li>
<li><p><strong>force_download</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, forces download even if the output file exists. Default is False.</p></li>
<li><p><strong>max_retries</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of retry attempts for failed downloads. Default is 3.</p></li>
<li><p><strong>retry_delay</strong> (<em>int</em><em>, </em><em>optional</em>) – Seconds to wait between retry attempts. Default is 5.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The function saves NetCDF files to <cite>dir_to_save</cite> but does not return a value.
Output files are named as <cite>Daily_PRCP_{blend_type}_{year_start}_{year_end}.nc</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Downloads individual daily TIFF files, processes them with rioxarray, clips if area specified,
and combines into a single NetCDF with daily time dimension.</p></li>
<li><p>Units: precipitation in mm/day.</p></li>
<li><p>Coordinates renamed to “X” (longitude), “Y” (latitude), “T” (time), with Y flipped if needed.</p></li>
<li><p>Deletes temporary TIFF files after processing.</p></li>
<li><p>Skips invalid dates (e.g., Feb 30) automatically.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_CHIRPSv3_Seasonal">
<span class="sig-name descname"><span class="pre">WAS_Download_CHIRPSv3_Seasonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">region</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'africa'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season_months</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['03',</span> <span class="pre">'04',</span> <span class="pre">'05']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_CHIRPSv3_Seasonal" title="Link to this definition"></a></dt>
<dd><p>Download CHIRPS v3.0 monthly precipitation for a specified cross-year season
from year_start to year_end, optionally clipped to ‘area’,
and aggregate them into a single NetCDF file.
:param dir_to_save: Directory to save the downloaded files.
:type dir_to_save: str
:param variables: List of variables to download (e.g., [“PRCP”]).
:type variables: list
:param year_start: Start year for the data.
:type year_start: int
:param year_end: End year for the data.
:type year_end: int
:param region: CHIRPS region (default: “africa”).
:type region: str
:param area: Bounding box as [North, West, South, East] (optional).
:type area: list
:param season_months: List of months as strings (e.g., [“03”, “04”, “05”]).
:type season_months: list
:param force_download: If True, forces download even if file exists.
:type force_download: bool</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Saves the aggregated seasonal data to a NetCDF file.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_ERA5Land">
<span class="sig-name descname"><span class="pre">WAS_Download_ERA5Land</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['01',</span> <span class="pre">'02',</span> <span class="pre">'03']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_ERA5Land" title="Link to this definition"></a></dt>
<dd><p>Download ERA5Land reanalysis data for specified variable combinations, years, and months,
handling cross-year seasons (e.g., NDJ).
:param dir_to_save: Directory to save the downloaded files.
:type dir_to_save: str
:param center_variable: List of center-variable identifiers (e.g., [“ERA5Land.PRCP”, “ERA5Land.TEMP”]).
:type center_variable: list
:param year_start: Start year for the data.
:type year_start: int
:param year_end: End year for the data.
:type year_end: int
:param area: Bounding box as [North, West, South, East].
:type area: list
:param seas: List of months (e.g., [“11”,”12”,”01”] for NDJ).
:type seas: list
:param force_download: If True, forces download even if file exists.
:type force_download: bool</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_ERA5Land_daily">
<span class="sig-name descname"><span class="pre">WAS_Download_ERA5Land_daily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">retry_delay</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_ERA5Land_daily" title="Link to this definition"></a></dt>
<dd><p>Download daily ERA5Land reanalysis data from the Copernicus Data Store (CDS)
for specified variables and years, with retries for failed downloads.
:param dir_to_save: Directory path where the downloaded NetCDF files will be saved.</p>
<blockquote>
<div><p>The directory will be created if it does not exist.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>center_variable</strong> (<em>list</em><em> of </em><em>str</em>) – List of center-variable identifiers (e.g., [“ERA5Land.PRCP”, “ERA5Land.TEMP”]).</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year for the data to download (inclusive).</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year for the data to download (inclusive).</p></li>
<li><p><strong>area</strong> (<em>list</em><em> of </em><em>float</em>) – Bounding box for spatial subsetting in the format [North, West, South, East].</p></li>
<li><p><strong>force_download</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, forces download even if the output file exists. Default is False.</p></li>
<li><p><strong>max_retries</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum number of retry attempts for failed downloads. Default is 3.</p></li>
<li><p><strong>retry_delay</strong> (<em>int</em><em>, </em><em>optional</em>) – Seconds to wait between retry attempts. Default is 5.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The function saves NetCDF files to <cite>dir_to_save</cite> but does not return a value.
Output files are named as <cite>Daily_&lt;variable&gt;_&lt;year_start&gt;_&lt;year_end&gt;.nc</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The function downloads hourly data from the CDS dataset “reanalysis-era5-land”
and aggregates it to daily resolution.</p></li>
<li><p>Aggregation: sum for accumulative variables (e.g., PRCP, radiation), mean for others (e.g., TEMP).</p></li>
<li><p>Unit conversions: PRCP to mm/day, TEMP to °C, radiation to W/m² (daily average).</p></li>
<li><p>Coordinates are renamed to “X” (longitude), “Y” (latitude), and “T” (time),
with latitude flipped.</p></li>
<li><p>Downloads are performed month-by-month due to API limitations.</p></li>
<li><p>Requires a valid CDS API key configured in <cite>~/.cdsapirc</cite>.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_Models">
<span class="sig-name descname"><span class="pre">WAS_Download_Models</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start_hindcast</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end_hindcast</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nmme_source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cpt'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_init_nmmeNC</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2025</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_Models" title="Link to this definition"></a></dt>
<dd><p>Download seasonal forecast model data for specified center-variable combinations, initialization month, lead times, and years.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory to save the downloaded files.</p></li>
<li><p><strong>center_variable</strong> (<em>list</em>) – List of center-variable identifiers (e.g., [“ECMWF_51.PRCP”, “UKMO_602.TEMP”]).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em>) – Initialization month as an integer (1-12).</p></li>
<li><p><strong>lead_time</strong> (<em>list</em>) – List of lead times in months.</p></li>
<li><p><strong>year_start_hindcast</strong> (<em>int</em>) – Start year for hindcast data.</p></li>
<li><p><strong>year_end_hindcast</strong> (<em>int</em>) – End year for hindcast data.</p></li>
<li><p><strong>area</strong> (<em>list</em>) – Bounding box as [North, West, South, East] for clipping.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – Forecast year if downloading forecast data. Defaults to None.</p></li>
<li><p><strong>mean</strong> (<em>ensemble</em>) – it’s can be median, mean or None. Defaults to None.</p></li>
<li><p><strong>force_download</strong> (<em>bool</em>) – If True, forces download even if file exists.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_Models_Daily">
<span class="sig-name descname"><span class="pre">WAS_Download_Models_Daily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">day_of_initialization</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">leadtime_hour</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start_hindcast</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end_hindcast</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_Models_Daily" title="Link to this definition"></a></dt>
<dd><p>Download daily/sub-daily seasonal forecast model data (original)
using ‘seasonal-original-single-levels’ from the CDS.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em><em> or </em><em>Path</em>) – Directory to save the downloaded files.</p></li>
<li><p><strong>center_variable</strong> (<em>list</em>) – Each element e.g. “ECMWF_51.PRCP”
- left side of ‘.’ is model (ECMWF_51),
- right side is variable short code (PRCP).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em>) – Initialization month (1-12).</p></li>
<li><p><strong>day_of_initialization</strong> (<em>int</em>) – Initialization day (1-31).</p></li>
<li><p><strong>leadtime_hour</strong> (<em>list</em><em> of </em><em>str</em>) – e.g. [“24”, “48”, …, “5160”].</p></li>
<li><p><strong>year_start_hindcast</strong> (<em>int</em>) – Start year for hindcast data.</p></li>
<li><p><strong>year_end_hindcast</strong> (<em>int</em>) – End year for hindcast data.</p></li>
<li><p><strong>area</strong> (<em>list</em>) – Bounding box as [North, West, South, East].</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – If provided, downloads that single
forecast year. Otherwise downloads hindcast for the specified range.</p></li>
<li><p><strong>ensemble_mean</strong> (<em>str</em><em>, </em><em>optional</em>) – e.g. “mean”, “median”, or None.</p></li>
<li><p><strong>force_download</strong> (<em>bool</em>) – Force download if True, even if file exists.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_Reanalysis">
<span class="sig-name descname"><span class="pre">WAS_Download_Reanalysis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['01',</span> <span class="pre">'02',</span> <span class="pre">'03']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_avg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_Reanalysis" title="Link to this definition"></a></dt>
<dd><p>Download reanalysis data for specified center-variable combinations, years, and months,
handling cross-year seasons (e.g., NDJ).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_Reanalysis_">
<span class="sig-name descname"><span class="pre">WAS_Download_Reanalysis_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">center_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['01',</span> <span class="pre">'02',</span> <span class="pre">'03']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_avg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_Reanalysis_" title="Link to this definition"></a></dt>
<dd><p>Download reanalysis data for specified center-variable combinations, years, and months,
handling cross-year seasons (e.g., NDJ).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_TAMSAT_Daily">
<span class="sig-name descname"><span class="pre">WAS_Download_TAMSAT_Daily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">product</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'rfe'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'soilmoisture'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'rfe'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'1983'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'2024'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Path</span></span></span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_TAMSAT_Daily" title="Link to this definition"></a></dt>
<dd><p>Download TAMSAT daily data (RFE v3.1 or Soil Moisture v2.3.1) and combine into a single NetCDF file.
:param dir_to_save: Directory where daily files and the combined output will be saved.
:type dir_to_save: str | Path
:param product: Dataset to download: “rfe” (precipitation) or “soil_moisture”.
:type product: {“rfe”, “soil_moisture”}, default “rfe”
:param variables: Names of variables to extract from NetCDF. If None, chosen by product.</p>
<blockquote>
<div><ul class="simple">
<li><p>rfe: defaults to (“rfe”,)</p></li>
<li><p>soil_moisture: defaults to (“sm”,)</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>start_date</strong> (<em>str</em><em>, </em><em>default &quot;1983-01-01&quot;</em>) – Start date in “YYYY-MM-DD” format.</p></li>
<li><p><strong>end_date</strong> (<em>str</em><em>, </em><em>default &quot;2025-10-20&quot;</em>) – End date in “YYYY-MM-DD” format (inclusive).</p></li>
<li><p><strong>area</strong> (<em>list</em><em>[</em><em>float</em><em>]</em><em>, </em><em>optional</em>) – Bounding box [north, west, south, east] in degrees.</p></li>
<li><p><strong>version</strong> (<em>str</em><em>, </em><em>optional</em>) – Product version. Defaults to:
- rfe: “v3.1”
- soil_moisture: “v2.3.1”</p></li>
<li><p><strong>force_download</strong> (<em>bool</em><em>, </em><em>default False</em>) – Re-download daily files even if present locally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Path to the combined daily NetCDF file.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Path</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.WAS_Download_TAMSAT_Seasonal">
<span class="sig-name descname"><span class="pre">WAS_Download_TAMSAT_Seasonal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">product</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'rfe'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'soil_moisture'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'rfe'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1983</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2025</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">area</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season_months</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">['03',</span> <span class="pre">'04',</span> <span class="pre">'05']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">version</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'sum'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'mean'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Path</span></span></span><a class="headerlink" href="#wass2s.was_download.WAS_Download.WAS_Download_TAMSAT_Seasonal" title="Link to this definition"></a></dt>
<dd><p>Download and aggregate TAMSAT monthly data (RFE v3.1 or Soil Moisture v2.3.1) for a specified season.
:param dir_to_save: Directory where monthly files and the seasonal output will be saved.
:type dir_to_save: str | Path
:param product: Dataset to download: “rfe” (precipitation) or “soil_moisture”.
:type product: {“rfe”, “soil_moisture”}, default “rfe”
:param variables: Names of variables to extract from NetCDF. If None, chosen by product.</p>
<blockquote>
<div><ul class="simple">
<li><p>rfe: defaults to (“rfe”,)</p></li>
<li><p>soil_moisture: defaults to (“sm”,)</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>year_start</strong> (<em>int</em><em>, </em><em>default 1983</em>) – First seasonal year (pivot year) to include.</p></li>
<li><p><strong>year_end</strong> (<em>int</em><em>, </em><em>default 2025</em>) – Last year for which data is included (inclusive). For seasons spanning calendar years, the last pivot year processed will be year_end - 1 to ensure no data from year_end + 1 is fetched.</p></li>
<li><p><strong>area</strong> (<em>list</em><em>[</em><em>float</em><em>]</em><em>, </em><em>optional</em>) – Bounding box [north, west, south, east] in degrees.</p></li>
<li><p><strong>season_months</strong> (<em>sequence</em><em>[</em><em>str</em><em>]</em><em>, </em><em>default</em><em> [</em><em>&quot;03&quot;</em><em>,</em><em>&quot;04&quot;</em><em>,</em><em>&quot;05&quot;</em><em>]</em>) – Months defining the season, e.g. [“11”,”12”,”01”] for NDJ.</p></li>
<li><p><strong>version</strong> (<em>str</em><em>, </em><em>optional</em>) – Product version. Defaults to:
- rfe: “v3.1”
- soil_moisture: “v2.3.1”</p></li>
<li><p><strong>force_download</strong> (<em>bool</em><em>, </em><em>default False</em>) – Re-download monthly files even if present locally.</p></li>
<li><p><strong>agg</strong> (<em>{&quot;sum&quot;</em><em>,</em><em>&quot;mean&quot;}</em><em>, </em><em>optional</em>) – Seasonal aggregation. Defaults to:
- rfe: “sum”
- soil_moisture: “mean”</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Path to the seasonal aggregated NetCDF file.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Path</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.days_in_month">
<span class="sig-name descname"><span class="pre">days_in_month</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.days_in_month" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.download_nmme_txt_with_progress">
<span class="sig-name descname"><span class="pre">download_nmme_txt_with_progress</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chunk_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1024</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.download_nmme_txt_with_progress" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_download.WAS_Download.parse_cpt_data_optimized">
<span class="sig-name descname"><span class="pre">parse_cpt_data_optimized</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_path</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.WAS_Download.parse_cpt_data_optimized" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.was_download.plot_map">
<span class="sig-prename descclassname"><span class="pre">wass2s.was_download.</span></span><span class="sig-name descname"><span class="pre">plot_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">extent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Map'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_download.plot_map" title="Link to this definition"></a></dt>
<dd><p>Plots a map with specified geographic extent.</p>
<p>Parameters:
- extent: list of float, specifying [west, east, south, north]
- title: str, title of the map</p>
</dd></dl>

</section>
<section id="module-wass2s.was_transformdata">
<span id="wass2s-was-transformdata-module"></span><h3>wass2s.was_transformdata module<a class="headerlink" href="#module-wass2s.was_transformdata" title="Link to this heading"></a></h3>
<p>WAS_TransformData: Skewness Analysis and Transformation for Geospatial Time-Series</p>
<p>This module provides the <cite>WAS_TransformData</cite> class to analyze skewness, apply
transformations, fit distributions, and visualize geospatial time-series data with
dimensions (T, Y, X) representing time, latitude, and longitude, respectively.</p>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_transformdata.</span></span><span class="sig-name descname"><span class="pre">WAS_TransformData</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distribution_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Manage skewness analysis, data transformation, distribution fitting, and visualization
for geospatial time-series data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>xarray.DataArray</em>) – Input data with dimensions (T, Y, X) for time, latitude, and longitude.</p></li>
<li><p><strong>distribution_map</strong> (<em>dict</em><em>, </em><em>optional</em>) – Mapping of distribution names to numeric codes. Default is:
{‘norm’: 1, ‘lognorm’: 2, ‘expon’: 3, ‘gamma’: 4, ‘weibull_min’: 5}.</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of clusters for KMeans in distribution fitting. Default is 5.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.data">
<span class="sig-name descname"><span class="pre">data</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.data" title="Link to this definition"></a></dt>
<dd><p>Input geospatial time-series data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.distribution_map">
<span class="sig-name descname"><span class="pre">distribution_map</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.distribution_map" title="Link to this definition"></a></dt>
<dd><p>Mapping of distribution names to codes.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.n_clusters">
<span class="sig-name descname"><span class="pre">n_clusters</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.n_clusters" title="Link to this definition"></a></dt>
<dd><p>Number of clusters for KMeans.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.transformed_data">
<span class="sig-name descname"><span class="pre">transformed_data</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.transformed_data" title="Link to this definition"></a></dt>
<dd><p>Transformed data after applying transformations.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.transform_methods">
<span class="sig-name descname"><span class="pre">transform_methods</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.transform_methods" title="Link to this definition"></a></dt>
<dd><p>Transformation methods applied per grid cell.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.transform_params">
<span class="sig-name descname"><span class="pre">transform_params</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.transform_params" title="Link to this definition"></a></dt>
<dd><p>Parameters for parametric transformations (e.g., Box-Cox lambda).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.skewness_ds">
<span class="sig-name descname"><span class="pre">skewness_ds</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.skewness_ds" title="Link to this definition"></a></dt>
<dd><p>Skewness analysis results.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.handle_ds">
<span class="sig-name descname"><span class="pre">handle_ds</span></span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.handle_ds" title="Link to this definition"></a></dt>
<dd><p>Skewness handling recommendations.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.detect_skewness">
<span class="sig-name descname"><span class="pre">detect_skewness</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.detect_skewness" title="Link to this definition"></a></dt>
<dd><p>Compute and classify skewness per grid cell.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.handle_skewness">
<span class="sig-name descname"><span class="pre">handle_skewness</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.handle_skewness" title="Link to this definition"></a></dt>
<dd><p>Recommend transformations based on skewness.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.apply_transformation">
<span class="sig-name descname"><span class="pre">apply_transformation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.apply_transformation" title="Link to this definition"></a></dt>
<dd><p>Apply transformations to data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.inverse_transform">
<span class="sig-name descname"><span class="pre">inverse_transform</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.inverse_transform" title="Link to this definition"></a></dt>
<dd><p>Reverse transformations to recover original data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.find_best_distribution_grid">
<span class="sig-name descname"><span class="pre">find_best_distribution_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_transformed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.find_best_distribution_grid" title="Link to this definition"></a></dt>
<dd><p>Fit distributions to data using KMeans clustering.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.plot_best_fit_map">
<span class="sig-name descname"><span class="pre">plot_best_fit_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file='map.png'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">...</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.plot_best_fit_map" title="Link to this definition"></a></dt>
<dd><p>Plot categorical map of distributions or skewness classes.</p>
</dd></dl>

<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If <cite>data</cite> is not an xarray.DataArray or lacks required dimensions.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="id0">
<span class="sig-name descname"><span class="pre">apply_transformation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="Link to this definition"></a></dt>
<dd><p>Apply transformations to reduce skewness in the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>method</strong> (<em>str</em><em> or </em><em>xarray.DataArray</em><em>, </em><em>optional</em>) – Transformation method to apply. Options:
- None: Use first recommended method per grid cell from <cite>handle_skewness</cite>.
- str: Apply the same method to all grid cells (e.g., ‘log’, ‘box_cox’).
- xarray.DataArray: Specify method per grid cell with dimensions (Y, X).
Default is None.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>transformed_data</strong> – Transformed data with same shape as input.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If <cite>method</cite> is None and <cite>handle_skewness</cite> has not been called.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Supported methods: ‘log’, ‘square_root’, ‘box_cox’, ‘yeo_johnson’,
‘reflect_log’, ‘reflect_square_root’, ‘reflect_yeo_johnson’, ‘clipping’, ‘binning’.
Transformations are skipped for invalid data or methods, with warnings printed.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id2">
<span class="sig-name descname"><span class="pre">detect_skewness</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id2" title="Link to this definition"></a></dt>
<dd><p>Compute and classify skewness for each grid cell.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>skewness_ds</strong> (<em>xarray.Dataset</em>) – Dataset with variables ‘skewness’ (float) and ‘skewness_class’ (str).
Skewness classes: ‘symmetric’, ‘moderate_positive’, ‘moderate_negative’,
‘high_positive’, ‘high_negative’, ‘invalid’.</p></li>
<li><p><strong>summary</strong> (<em>dict</em>) – Dictionary with ‘class_counts’ mapping skewness classes to grid cell counts.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Skewness is computed using <cite>scipy.stats.skew</cite> with <cite>nan_policy=’omit’</cite>.
Classification thresholds:
- Symmetric: -0.5 ≤ skewness ≤ 0.5
- Moderate positive: 0.5 &lt; skewness ≤ 1
- Moderate negative: -1 ≤ skewness &lt; -0.5
- High positive: skewness &gt; 1
- High negative: skewness &lt; -1
- Invalid: insufficient data (&lt; 3 non-NaN values).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.find_best_distribution_grid___">
<span class="sig-name descname"><span class="pre">find_best_distribution_grid___</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_transformed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.find_best_distribution_grid___" title="Link to this definition"></a></dt>
<dd><p>Fit distributions to data using KMeans clustering.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>use_transformed</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use transformed data; otherwise, use original data. Default is False.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>dist_codes</strong> – Numeric codes for best-fitting distributions per grid cell.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses <cite>fitter.Fitter</cite> to fit distributions (e.g., normal, lognormal) to clustered data.
Clusters are determined by mean values using KMeans.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.fit_best_distribution_grid_onlycluster">
<span class="sig-name descname"><span class="pre">fit_best_distribution_grid_onlycluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_transformed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.fit_best_distribution_grid_onlycluster" title="Link to this definition"></a></dt>
<dd><p>Fit best distributions by homogeneous zones (clusters) and map to each grid cell.</p>
<dl class="simple">
<dt>Clustering:</dt><dd><ul class="simple">
<li><p>Done on simple distributional features per grid cell (mean, std over T).</p></li>
<li><p>Produces n_clusters homogeneous zones.</p></li>
</ul>
</dd>
<dt>For each cluster:</dt><dd><ul class="simple">
<li><p>Pool all time series values from its grid cells.</p></li>
<li><dl class="simple">
<dt>For each candidate distribution in self.distribution_map:</dt><dd><ul>
<li><p>Fit parameters by MLE (SciPy).</p></li>
<li><p>Compute AIC = 2k - 2 logL on that cluster sample.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Select distribution with minimum AIC.</p></li>
<li><p>Assign its (code, shape, loc, scale) to all grid cells in that cluster.</p></li>
</ul>
</dd>
<dt>Supports (if present in distribution_map):</dt><dd><ul class="simple">
<li><p>‘norm’        -&gt; code 1</p></li>
<li><p>‘lognorm’     -&gt; code 2</p></li>
<li><p>‘expon’       -&gt; code 3</p></li>
<li><p>‘gamma’       -&gt; code 4</p></li>
<li><p>‘weibull_min’ -&gt; code 5</p></li>
<li><p>‘t’           -&gt; code 6</p></li>
<li><p>‘poisson’     -&gt; code 7</p></li>
<li><p>‘nbinom’      -&gt; code 8</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>use_transformed</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use self.transformed_data; otherwise use original self.data.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_code</strong> (<em>xarray.DataArray, shape (Y, X)</em>) – Code of best distribution per grid cell.</p></li>
<li><p><strong>best_shape</strong> (<em>xarray.DataArray, shape (Y, X)</em>) – Primary shape param (e.g., ‘a’ in gamma, ‘mu’ in poisson, ‘n’ in nbinom).</p></li>
<li><p><strong>best_loc</strong> (<em>xarray.DataArray, shape (Y, X)</em>) – Location parameter.</p></li>
<li><p><strong>best_scale</strong> (<em>xarray.DataArray, shape (Y, X)</em>) – Scale parameter (e.g., ‘p’ in nbinom).</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><dl class="simple">
<dt>Continuous (precip-like):</dt><dd><ul>
<li><p>‘lognorm’, ‘gamma’, ‘weibull_min’, ‘expon’ are fitted on non-negative values with loc=0.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Continuous (unbounded):</dt><dd><ul>
<li><p>‘norm’ and ‘t’ are fitted on all finite values (no non-negativity constraint).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Discrete (counts):</dt><dd><ul>
<li><p>‘poisson’, ‘nbinom’ are fitted on non-negative INTEGER values with loc=0.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Requires enough valid data per cluster; if not, affected cells get NaNs.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.fit_best_distribution_grid_onlygrid">
<span class="sig-name descname"><span class="pre">fit_best_distribution_grid_onlygrid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_transformed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.fit_best_distribution_grid_onlygrid" title="Link to this definition"></a></dt>
<dd><p>Fit candidate distributions per grid cell and select best by AIC.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>use_transformed</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use self.transformed_data; otherwise use original data.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_code</strong> (<em>xarray.DataArray  (Y, X)</em>) – Code of best distribution per grid (per self.distribution_map).</p></li>
<li><p><strong>best_shape</strong> (<em>xarray.DataArray  (Y, X)</em>)</p></li>
<li><p><strong>best_loc</strong> (<em>xarray.DataArray  (Y, X)</em>)</p></li>
<li><p><strong>best_scale</strong> (<em>xarray.DataArray  (Y, X)</em>)</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Fits are done independently per grid cell (no clustering).</p></li>
<li><dl class="simple">
<dt>For precip-like variables:</dt><dd><ul>
<li><p>‘lognorm’, ‘gamma’, ‘weibull_min’, ‘expon’ are fitted on positive values with loc=0.</p></li>
<li><p>‘norm’ and ‘t’ are fitted on all finite values.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>AIC = 2k - 2 ln(L) is used for model selection.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_transformdata.WAS_TransformData.fit_best_distribution_grid_two_options">
<span class="sig-name descname"><span class="pre">fit_best_distribution_grid_two_options</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_transformed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.WAS_TransformData.fit_best_distribution_grid_two_options" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Fit best distributions either by:</dt><dd><ul class="simple">
<li><p>homogeneous zones (mode=’cluster’), or</p></li>
<li><p>per grid cell (mode=’grid’).</p></li>
</ul>
</dd>
<dt>Uses AIC for model selection and supports:</dt><dd><p>‘norm’, ‘lognorm’, ‘expon’, ‘gamma’, ‘weibull_min’, ‘t’, ‘poisson’, ‘nbinom’</p>
</dd>
</dl>
<p>(if present in self.distribution_map).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>use_transformed</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use self.transformed_data, else self.data.</p></li>
<li><p><strong>mode</strong> (<em>{'cluster'</em><em>, </em><em>'grid'}</em><em>, </em><em>optional</em>) – ‘cluster’ : KMeans on (mean,std) → one distribution per cluster.
‘grid’    : independent fit at each (Y,X) via xr.apply_ufunc.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_code</strong> (<em>xarray.DataArray (Y, X)</em>)</p></li>
<li><p><strong>best_shape</strong> (<em>xarray.DataArray (Y, X)</em>)</p></li>
<li><p><strong>best_loc</strong> (<em>xarray.DataArray (Y, X)</em>)</p></li>
<li><p><strong>best_scale</strong> (<em>xarray.DataArray (Y, X)</em>)</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray (Y, X)</em>) – Cluster labels for mode=’cluster’; all-NaN for mode=’grid’.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id3">
<span class="sig-name descname"><span class="pre">handle_skewness</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id3" title="Link to this definition"></a></dt>
<dd><p>Recommend transformations based on skewness and data properties.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>handle_ds</strong> (<em>xarray.Dataset</em>) – Dataset with variables ‘skewness’, ‘skewness_class’, and ‘recommended_methods’
(semicolon-separated string of transformation methods).</p></li>
<li><p><strong>summary</strong> (<em>dict</em>) – Dictionary with ‘general_recommendations’ mapping skewness classes to advice.</p></li>
</ul>
</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If <cite>detect_skewness</cite> has not been called.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Recommendations consider data properties (e.g., zeros, negatives) and skewness class.
Example methods: ‘log’, ‘square_root’, ‘box_cox’, ‘yeo_johnson’, ‘clipping’, ‘binning’.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id4">
<span class="sig-name descname"><span class="pre">inverse_transform</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#id4" title="Link to this definition"></a></dt>
<dd><p>Reverse transformations to recover original data scale.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>inverse_data</strong> – Data in original scale with same shape as input.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>xarray.DataArray</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If no transformation has been applied or required parameters are missing.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Non-invertible methods (‘clipping’, ‘binning’) return unchanged data with a warning.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id5">
<span class="sig-name descname"><span class="pre">plot_best_fit_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'map.png'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Categorical</span> <span class="pre">Map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">figsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(10,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id5" title="Link to this definition"></a></dt>
<dd><p>Plot a categorical map of distributions or skewness classes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data_array</strong> (<em>xarray.DataArray</em>) – Data to plot (e.g., distribution codes or skewness classes) with dimensions (Y, X).</p></li>
<li><p><strong>map_dict</strong> (<em>dict</em>) – Mapping of category names to numeric codes (e.g., distribution_map).</p></li>
<li><p><strong>output_file</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to save the plot. Default is ‘map.png’.</p></li>
<li><p><strong>title</strong> (<em>str</em><em>, </em><em>optional</em>) – Plot title. Default is ‘Categorical Map’.</p></li>
<li><p><strong>colors</strong> (<em>list</em><em>, </em><em>optional</em>) – Colors for each code. Default is [‘blue’, ‘green’, ‘red’, ‘purple’, ‘orange’].</p></li>
<li><p><strong>figsize</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Figure size (width, height) in inches. Default is (10, 6).</p></li>
<li><p><strong>extent</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Map extent (lon_min, lon_max, lat_min, lat_max). Default is data bounds.</p></li>
<li><p><strong>show_plot</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, display the plot interactively. Default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If insufficient colors are provided for the number of categories.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses <cite>cartopy</cite> for geospatial visualization with PlateCarree projection.
Saves the plot as a PNG file.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.was_transformdata.inv_boxcox">
<span class="sig-prename descclassname"><span class="pre">wass2s.was_transformdata.</span></span><span class="sig-name descname"><span class="pre">inv_boxcox</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lmbda</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_transformdata.inv_boxcox" title="Link to this definition"></a></dt>
<dd><p>Inverse Box-Cox transformation for SciPy 1.11.3 compatibility.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>array_like</em>) – Transformed data.</p></li>
<li><p><strong>lmbda</strong> (<em>float</em>) – Box-Cox lambda parameter.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>x</strong> – Original data before Box-Cox transformation.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Implements the inverse of the Box-Cox transformation manually</p>
</dd></dl>

</section>
<section id="module-wass2s.was_compute_predictand">
<span id="wass2s-was-compute-predictand-module"></span><h3>wass2s.was_compute_predictand module<a class="headerlink" href="#module-wass2s.was_compute_predictand" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDIHeatWaveIndices">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">ETCCDIHeatWaveIndices</span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDIHeatWaveIndices" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Factory for creating standard ETCCDI heat wave indices.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDIHeatWaveIndices.compound_heat_wave">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">compound_heat_wave</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tx_percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tn_percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_consecutive_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices" title="wass2s.was_compute_predictand.WAS_HeatWaveIndices"><span class="pre">WAS_HeatWaveIndices</span></a></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDIHeatWaveIndices.compound_heat_wave" title="Link to this definition"></a></dt>
<dd><p>Create calculator for compound heat waves (both TX and TN).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDIHeatWaveIndices.heat_wave_frequency">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">heat_wave_frequency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tx_percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_consecutive_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices" title="wass2s.was_compute_predictand.WAS_HeatWaveIndices"><span class="pre">WAS_HeatWaveIndices</span></a></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDIHeatWaveIndices.heat_wave_frequency" title="Link to this definition"></a></dt>
<dd><p>Create calculator for Heat Wave Frequency.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDIHeatWaveIndices.wsdi">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">wsdi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tx_percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_consecutive_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices" title="wass2s.was_compute_predictand.WAS_HeatWaveIndices"><span class="pre">WAS_HeatWaveIndices</span></a></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDIHeatWaveIndices.wsdi" title="Link to this definition"></a></dt>
<dd><p>Create calculator for WSDI (Warm Spell Duration Index).</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDITempIndices">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">ETCCDITempIndices</span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDITempIndices" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Factory for creating standard ETCCDI temperature indices.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDITempIndices.cold_days">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cold_days</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices" title="wass2s.was_compute_predictand.WAS_TempPercentileIndices"><span class="pre">WAS_TempPercentileIndices</span></a></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDITempIndices.cold_days" title="Link to this definition"></a></dt>
<dd><p>Create calculator for cold days (TX10p).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDITempIndices.cold_nights">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">cold_nights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices" title="wass2s.was_compute_predictand.WAS_TempPercentileIndices"><span class="pre">WAS_TempPercentileIndices</span></a></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDITempIndices.cold_nights" title="Link to this definition"></a></dt>
<dd><p>Create calculator for cold nights (TN10p).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDITempIndices.hot_days">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">hot_days</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices" title="wass2s.was_compute_predictand.WAS_TempPercentileIndices"><span class="pre">WAS_TempPercentileIndices</span></a></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDITempIndices.hot_days" title="Link to this definition"></a></dt>
<dd><p>Create calculator for hot days (TX90p).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ETCCDITempIndices.hot_nights">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">hot_nights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices" title="wass2s.was_compute_predictand.WAS_TempPercentileIndices"><span class="pre">WAS_TempPercentileIndices</span></a></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.ETCCDITempIndices.hot_nights" title="Link to this definition"></a></dt>
<dd><p>Create calculator for hot nights (TN90p).</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ExtremeType">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">ExtremeType</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">values</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.ExtremeType" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Type of temperature extreme.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ExtremeType.COLD">
<span class="sig-name descname"><span class="pre">COLD</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'cold'</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.ExtremeType.COLD" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.ExtremeType.HOT">
<span class="sig-name descname"><span class="pre">HOT</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'hot'</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.ExtremeType.HOT" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveDefinition">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">HeatWaveDefinition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Timestamp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">duration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_temp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_temp</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveDefinition" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Definition of a heat wave event.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveDefinition.duration">
<span class="sig-name descname"><span class="pre">duration</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveDefinition.duration" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveDefinition.end_date">
<span class="sig-name descname"><span class="pre">end_date</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Timestamp</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveDefinition.end_date" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveDefinition.max_temp">
<span class="sig-name descname"><span class="pre">max_temp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveDefinition.max_temp" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveDefinition.mean_temp">
<span class="sig-name descname"><span class="pre">mean_temp</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveDefinition.mean_temp" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveDefinition.start_date">
<span class="sig-name descname"><span class="pre">start_date</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Timestamp</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveDefinition.start_date" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveMetric">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">HeatWaveMetric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">values</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveMetric" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>ETCCDI Heat Wave Indices.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveMetric.HWDI">
<span class="sig-name descname"><span class="pre">HWDI</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'HWDI'</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveMetric.HWDI" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveMetric.HWF">
<span class="sig-name descname"><span class="pre">HWF</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'HWF'</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveMetric.HWF" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveMetric.HWN">
<span class="sig-name descname"><span class="pre">HWN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'HWN'</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveMetric.HWN" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.HeatWaveMetric.WSDI">
<span class="sig-name descname"><span class="pre">WSDI</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'WSDI'</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.HeatWaveMetric.WSDI" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_HeatWaveIndices">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_HeatWaveIndices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tx_percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tn_percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_consecutive_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_break_days</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">require_both_tx_tn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_intensity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Correct implementation of ETCCDI heat wave indices.</p>
<p>Standard ETCCDI Indices:
1. WSDI (Warm Spell Duration Index): Annual count of days with at least</p>
<blockquote>
<div><p>6 consecutive days when TX &gt; 90th percentile</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>HWF (Heat Wave Frequency): Annual count of heat wave events</p></li>
<li><p>HWDI (Heat Wave Duration Index): Annual maximum length of heat waves</p></li>
</ol>
<p>Reference:
- ETCCDI Climate Change Indices (2009)
- Perkins &amp; Alexander (2013): On the measurement of heat waves</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_HeatWaveIndices.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_cdt_tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">df_cdt_tn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'WSDI'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices.compute_insitu" title="Link to this definition"></a></dt>
<dd><p>Compute heat wave indices for in-situ data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df_cdt_tx</strong> (<em>pd.DataFrame</em>) – Daily maximum temperature in CDT format</p></li>
<li><p><strong>df_cdt_tn</strong> (<em>pd.DataFrame</em><em>, </em><em>optional</em>) – Daily minimum temperature in CDT format (for compound heat waves)</p></li>
<li><p><strong>metric</strong> (<em>str</em>) – Heat wave metric to compute: “WSDI”, “HWF”, or “HWDI”</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Results in CDT format</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_HeatWaveIndices.compute_xarray">
<span class="sig-name descname"><span class="pre">compute_xarray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds_tx</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds_tn</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'WSDI'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices.compute_xarray" title="Link to this definition"></a></dt>
<dd><p>Compute heat wave indices for xarray data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds_tx</strong> (<em>xr.Dataset</em><em> or </em><em>xr.DataArray</em>) – Daily maximum temperature</p></li>
<li><p><strong>ds_tn</strong> (<em>xr.Dataset</em><em> or </em><em>xr.DataArray</em><em>, </em><em>optional</em>) – Daily minimum temperature (for compound heat waves)</p></li>
<li><p><strong>metric</strong> (<em>str</em>) – Heat wave metric to compute</p></li>
<li><p><strong>chunk_size</strong> (<em>dict</em><em>, </em><em>optional</em>) – Chunk sizes for parallel processing</p></li>
<li><p><strong>parallel</strong> (<em>bool</em>) – Whether to use Dask for parallel processing</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Heat wave index values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xr.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_HeatWaveIndices.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_HeatWaveIndices.transform_cdt" title="Link to this definition"></a></dt>
<dd><p>Transform CDT format to long format DataFrame.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_PrecipIndices">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_PrecipIndices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_day_threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_base_years</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">15</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_PrecipIndices" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Correct implementation of ETCCDI precipitation indices (R95p, R99p, etc.)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_period</strong> (<em>slice</em>) – Slice for base period years, e.g., slice(“1991”, “2020”)</p></li>
<li><p><strong>percentile</strong> (<em>float</em>) – Percentile value (95 for R95p, 99 for R99p)</p></li>
<li><p><strong>season</strong> (<em>list</em><em>, </em><em>optional</em>) – Months to consider (e.g., [6, 7, 8, 9] for JJAS)</p></li>
<li><p><strong>wet_day_threshold</strong> (<em>float</em>) – Minimum precipitation for a wet day (default 1.0 mm)</p></li>
<li><p><strong>min_base_years</strong> (<em>int</em>) – Minimum years required in base period (default 15)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_PrecipIndices.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_cdt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_PrecipIndices.compute_insitu" title="Link to this definition"></a></dt>
<dd><p>Compute index for in-situ (station) data in CDT format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df_cdt</strong> (<em>pd.DataFrame</em>) – Input data in CDT format</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Result in CDT format</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_PrecipIndices.compute_xarray">
<span class="sig-name descname"><span class="pre">compute_xarray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_PrecipIndices.compute_xarray" title="Link to this definition"></a></dt>
<dd><p>Compute index for xarray DataArray (gridded data).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>da</strong> (<em>xr.DataArray</em>) – Precipitation DataArray with dimensions (time, y, x) or (time, lat, lon)</p></li>
<li><p><strong>chunk_size</strong> (<em>dict</em><em>, </em><em>optional</em>) – Chunk sizes for parallel processing, e.g., {‘y’: 100, ‘x’: 100}</p></li>
<li><p><strong>parallel</strong> (<em>bool</em>) – Whether to use Dask for parallel processing</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Annual index values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xr.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_PrecipIndices.get_index_definition">
<span class="sig-name descname"><span class="pre">get_index_definition</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_PrecipIndices.get_index_definition" title="Link to this definition"></a></dt>
<dd><p>Return index definition metadata.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_PrecipIndices.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_PrecipIndices.transform_cdt" title="Link to this definition"></a></dt>
<dd><p>Transform CDT format to long format DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>df</strong> (<em>pd.DataFrame</em>) – Input DataFrame in CDT format</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Long format DataFrame with columns: DATE, STATION, VALUE, LAT, LON</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_TempPercentileIndices">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_TempPercentileIndices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_period</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">slice</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">percentile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">90</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">var_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'TMAX'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extreme_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'hot'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bootstrap_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_base_years</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">15</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Correct implementation of ETCCDI temperature percentile indices.</p>
<p>Standard ETCCDI Indices:
- Hot Days: TX90p (daily max temperature &gt; 90th percentile)
- Hot Nights: TN90p (daily min temperature &gt; 90th percentile)
- Cold Days: TX10p (daily max temperature &lt; 10th percentile)
- Cold Nights: TN10p (daily min temperature &lt; 10th percentile)</p>
<p>Reference: ETCCDI Climate Change Indices (2009)</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_TempPercentileIndices.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_cdt</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_confidence</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataFrame</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices.compute_insitu" title="Link to this definition"></a></dt>
<dd><p>Compute index for in-situ (station) data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_TempPercentileIndices.compute_xarray">
<span class="sig-name descname"><span class="pre">compute_xarray</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">var_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parallel</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices.compute_xarray" title="Link to this definition"></a></dt>
<dd><p>Compute index for xarray data (gridded).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_TempPercentileIndices.get_index_definition">
<span class="sig-name descname"><span class="pre">get_index_definition</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Dict</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices.get_index_definition" title="Link to this definition"></a></dt>
<dd><p>Return index definition metadata.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_TempPercentileIndices.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataFrame</span></span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_TempPercentileIndices.transform_cdt" title="Link to this definition"></a></dt>
<dd><p>Transform CDT format to long format DataFrame.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_compute_cessation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user_criteria</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to compute cessation dates based on soil moisture balance for different
regions and criteria, leveraging parallel computation for efficiency.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.adjust_duplicates">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">adjust_duplicates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.adjust_duplicates" title="Link to this definition"></a></dt>
<dd><p>If any values in the Series repeat, nudge them by a tiny increment
so that all are unique (to avoid indexing collisions).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.cessation_function">
<span class="sig-name descname"><span class="pre">cessation_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ijour_dem_cal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idebut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ETP</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cap_ret_maxi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irch_fin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.cessation_function" title="Link to this definition"></a></dt>
<dd><p>Compute cessation date using soil moisture balance criteria.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.compute" title="Link to this definition"></a></dt>
<dd><p>Compute cessation dates for each pixel using criteria based on regions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.compute_insitu" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.day_of_year">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">day_of_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dem_rech1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.day_of_year" title="Link to this definition"></a></dt>
<dd><p>Given a year ‘i’ and a month-day string ‘dem_rech1’ (e.g., ‘07-23’),
return the 1-based day of the year.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.default_criteria">
<span class="sig-name descname"><span class="pre">default_criteria</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{0:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search':</span> <span class="pre">'09-30',</span> <span class="pre">'start_search':</span> <span class="pre">'09-01',</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel100_0mm'},</span> <span class="pre">1:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search':</span> <span class="pre">'10-05',</span> <span class="pre">'start_search':</span> <span class="pre">'09-01',</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel200_100mm'},</span> <span class="pre">2:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search':</span> <span class="pre">'11-10',</span> <span class="pre">'start_search':</span> <span class="pre">'09-01',</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel400_200mm'},</span> <span class="pre">3:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search':</span> <span class="pre">'11-15',</span> <span class="pre">'start_search':</span> <span class="pre">'09-15',</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel600_400mm'},</span> <span class="pre">4:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">4.5,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search':</span> <span class="pre">'11-30',</span> <span class="pre">'start_search':</span> <span class="pre">'10-01',</span> <span class="pre">'zone_name':</span> <span class="pre">'Soudan'},</span> <span class="pre">5:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">4.0,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search':</span> <span class="pre">'12-01',</span> <span class="pre">'start_search':</span> <span class="pre">'10-15',</span> <span class="pre">'zone_name':</span> <span class="pre">'Golfe_Of_Guinea'}}</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.default_criteria" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.rainf_zone">
<span class="sig-name descname"><span class="pre">rainf_zone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.rainf_zone" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation.transform_cdt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Transform a DataFrame with:</dt><dd><ul class="simple">
<li><p>Row 0 = LON</p></li>
<li><p>Row 1 = LAT</p></li>
<li><p>Row 2 = ELEV</p></li>
<li><p>Rows 3+ = daily data (or any date) with ‘ID’ column containing dates.</p></li>
</ul>
</dd>
</dl>
<p>Returns an xarray DataArray with coords = (T, Y, X), variable = ‘Observation’.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_compute_cessation_dry_spell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user_criteria</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class for computing the longest dry spell length
after the onset of a rainy season, based on user-defined criteria.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.adjust_duplicates">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">adjust_duplicates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.adjust_duplicates" title="Link to this definition"></a></dt>
<dd><p>If any values in the Series repeat, nudge them by a tiny increment
so that all are unique (to avoid indexing collisions).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.compute" title="Link to this definition"></a></dt>
<dd><p>Compute the longest dry spell length after the rainy season onset
for each pixel in the given daily rainfall DataArray, using different
criteria (both for onset and cessation) based on isohyet zones.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_data</strong> (<em>xarray.DataArray</em>) – Daily rainfall data, coords = (T, Y, X).</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em>) – Number of parallel processes (workers) to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array with the longest dry spell length per pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.compute_insitu" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.day_of_year">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">day_of_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dem_rech1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.day_of_year" title="Link to this definition"></a></dt>
<dd><p>Convert year i and MM-DD string dem_rech1 (e.g., ‘07-23’)
into a 1-based day of the year.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.default_criteria">
<span class="sig-name descname"><span class="pre">default_criteria</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{0:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'cumulative':</span> <span class="pre">10,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search1':</span> <span class="pre">'08-15',</span> <span class="pre">'end_search2':</span> <span class="pre">'09-30',</span> <span class="pre">'nbjour':</span> <span class="pre">40,</span> <span class="pre">'number_dry_days':</span> <span class="pre">25,</span> <span class="pre">'start_search1':</span> <span class="pre">'05-01',</span> <span class="pre">'start_search2':</span> <span class="pre">'09-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel100_0mm'},</span> <span class="pre">1:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'cumulative':</span> <span class="pre">15,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search1':</span> <span class="pre">'08-15',</span> <span class="pre">'end_search2':</span> <span class="pre">'10-05',</span> <span class="pre">'nbjour':</span> <span class="pre">40,</span> <span class="pre">'number_dry_days':</span> <span class="pre">25,</span> <span class="pre">'start_search1':</span> <span class="pre">'05-15',</span> <span class="pre">'start_search2':</span> <span class="pre">'09-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel200_100mm'},</span> <span class="pre">2:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'cumulative':</span> <span class="pre">15,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search1':</span> <span class="pre">'07-31',</span> <span class="pre">'end_search2':</span> <span class="pre">'11-10',</span> <span class="pre">'nbjour':</span> <span class="pre">40,</span> <span class="pre">'number_dry_days':</span> <span class="pre">20,</span> <span class="pre">'start_search1':</span> <span class="pre">'05-01',</span> <span class="pre">'start_search2':</span> <span class="pre">'09-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel400_200mm'},</span> <span class="pre">3:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">5.0,</span> <span class="pre">'cumulative':</span> <span class="pre">20,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search1':</span> <span class="pre">'07-31',</span> <span class="pre">'end_search2':</span> <span class="pre">'11-15',</span> <span class="pre">'nbjour':</span> <span class="pre">45,</span> <span class="pre">'number_dry_days':</span> <span class="pre">20,</span> <span class="pre">'start_search1':</span> <span class="pre">'03-15',</span> <span class="pre">'start_search2':</span> <span class="pre">'09-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel600_400mm'},</span> <span class="pre">4:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">4.5,</span> <span class="pre">'cumulative':</span> <span class="pre">20,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search1':</span> <span class="pre">'07-31',</span> <span class="pre">'end_search2':</span> <span class="pre">'11-30',</span> <span class="pre">'nbjour':</span> <span class="pre">50,</span> <span class="pre">'number_dry_days':</span> <span class="pre">10,</span> <span class="pre">'start_search1':</span> <span class="pre">'03-15',</span> <span class="pre">'start_search2':</span> <span class="pre">'10-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Soudan'},</span> <span class="pre">5:</span> <span class="pre">{'Cap_ret_maxi':</span> <span class="pre">70,</span> <span class="pre">'ETP':</span> <span class="pre">4.0,</span> <span class="pre">'cumulative':</span> <span class="pre">20,</span> <span class="pre">'date_dry_soil':</span> <span class="pre">'01-01',</span> <span class="pre">'end_search1':</span> <span class="pre">'06-15',</span> <span class="pre">'end_search2':</span> <span class="pre">'12-01',</span> <span class="pre">'nbjour':</span> <span class="pre">50,</span> <span class="pre">'number_dry_days':</span> <span class="pre">10,</span> <span class="pre">'start_search1':</span> <span class="pre">'02-01',</span> <span class="pre">'start_search2':</span> <span class="pre">'10-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Golfe_Of_Guinea'}}</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.default_criteria" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.dry_spell_cessation_function">
<span class="sig-name descname"><span class="pre">dry_spell_cessation_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idebut1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cumul</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jour_pluvieux</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irch_fin1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idebut2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ijour_dem_cal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ETP</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Cap_ret_maxi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irch_fin2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbjour</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.dry_spell_cessation_function" title="Link to this definition"></a></dt>
<dd><p>Computes the longest dry spell length after the onset and
determines the cessation date (when soil water returns to 0)
based on water balance, then checks for a dry spell.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em>) – Daily rainfall or similar values.</p></li>
<li><p><strong>idebut1</strong> (<em>int</em>) – Start index to begin searching for the onset.</p></li>
<li><p><strong>cumul</strong> (<em>float</em>) – Cumulative rainfall threshold to trigger onset.</p></li>
<li><p><strong>nbsec</strong> (<em>int</em>) – Maximum number of dry days allowed in the sequence.</p></li>
<li><p><strong>jour_pluvieux</strong> (<em>float</em>) – Minimum rainfall to consider a day as rainy.</p></li>
<li><p><strong>irch_fin1</strong> (<em>int</em>) – Maximum index limit for the onset search.</p></li>
<li><p><strong>idebut2</strong> (<em>int</em>) – Start index for the cessation search.</p></li>
<li><p><strong>ijour_dem_cal</strong> (<em>int</em>) – Start index from which the water balance is calculated.</p></li>
<li><p><strong>ETP</strong> (<em>float</em>) – Daily evapotranspiration (mm).</p></li>
<li><p><strong>Cap_ret_maxi</strong> (<em>float</em>) – Maximum soil water retention capacity (mm).</p></li>
<li><p><strong>irch_fin2</strong> (<em>int</em>) – Maximum index limit for the cessation search.</p></li>
<li><p><strong>nbjour</strong> (<em>int</em>) – Number of days after onset to check for the dry spell.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Length of the longest dry spell sequence after onset and before soil water
returns to zero, or NaN if not found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.rainf_zone">
<span class="sig-name descname"><span class="pre">rainf_zone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.rainf_zone" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_cessation_dry_spell.transform_cdt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Transform a DataFrame with:</dt><dd><ul class="simple">
<li><p>Row 0 = LON</p></li>
<li><p>Row 1 = LAT</p></li>
<li><p>Row 2 = ELEV</p></li>
<li><p>Rows 3+ = daily data (or any date) with ‘ID’ column containing dates.</p></li>
</ul>
</dd>
</dl>
<p>Returns an xarray DataArray with coords = (T, Y, X), variable = ‘Observation’.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_compute_onset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user_criteria</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class that encapsulates methods for transforming precipitation data
from different formats (CPT, CDT) and computing onset dates based on
rainfall criteria.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.adjust_duplicates">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">adjust_duplicates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.adjust_duplicates" title="Link to this definition"></a></dt>
<dd><p>If any values in the Series repeat, nudge them by a tiny increment
so that all are unique (to avoid indexing collisions).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.compute" title="Link to this definition"></a></dt>
<dd><p>Compute onset dates for each pixel in a given daily rainfall DataArray
using different criteria based on isohyet zones.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_data</strong> (<em>xarray.DataArray</em>) – Daily rainfall data, coords = (T, Y, X).</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em>) – Number of parallel processes to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array with onset dates computed per pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.compute_insitu" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.day_of_year">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">day_of_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dem_rech1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.day_of_year" title="Link to this definition"></a></dt>
<dd><p>Given a year ‘i’ and a month-day string ‘dem_rech1’ (e.g., ‘07-23’),
return the day of the year (1-based).</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.default_criteria">
<span class="sig-name descname"><span class="pre">default_criteria</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{0:</span> <span class="pre">{'cumulative':</span> <span class="pre">10,</span> <span class="pre">'end_search':</span> <span class="pre">'08-30',</span> <span class="pre">'number_dry_days':</span> <span class="pre">25,</span> <span class="pre">'start_search':</span> <span class="pre">'06-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel100_0mm'},</span> <span class="pre">1:</span> <span class="pre">{'cumulative':</span> <span class="pre">15,</span> <span class="pre">'end_search':</span> <span class="pre">'08-15',</span> <span class="pre">'number_dry_days':</span> <span class="pre">25,</span> <span class="pre">'start_search':</span> <span class="pre">'05-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel200_100mm'},</span> <span class="pre">2:</span> <span class="pre">{'cumulative':</span> <span class="pre">15,</span> <span class="pre">'end_search':</span> <span class="pre">'07-31',</span> <span class="pre">'number_dry_days':</span> <span class="pre">20,</span> <span class="pre">'start_search':</span> <span class="pre">'05-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel400_200mm'},</span> <span class="pre">3:</span> <span class="pre">{'cumulative':</span> <span class="pre">20,</span> <span class="pre">'end_search':</span> <span class="pre">'07-31',</span> <span class="pre">'number_dry_days':</span> <span class="pre">20,</span> <span class="pre">'start_search':</span> <span class="pre">'03-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel600_400mm'},</span> <span class="pre">4:</span> <span class="pre">{'cumulative':</span> <span class="pre">20,</span> <span class="pre">'end_search':</span> <span class="pre">'07-31',</span> <span class="pre">'number_dry_days':</span> <span class="pre">10,</span> <span class="pre">'start_search':</span> <span class="pre">'03-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Soudan'},</span> <span class="pre">5:</span> <span class="pre">{'cumulative':</span> <span class="pre">20,</span> <span class="pre">'end_search':</span> <span class="pre">'06-15',</span> <span class="pre">'number_dry_days':</span> <span class="pre">10,</span> <span class="pre">'start_search':</span> <span class="pre">'02-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Golfe_Of_Guinea'}}</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.default_criteria" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.onset_function">
<span class="sig-name descname"><span class="pre">onset_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idebut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cumul</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jour_pluvieux</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irch_fin</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.onset_function" title="Link to this definition"></a></dt>
<dd><p>Calculate the onset date of a season based on cumulative rainfall criteria.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em>) – Daily rainfall or similar values.</p></li>
<li><p><strong>idebut</strong> (<em>int</em>) – Start index to begin searching for the onset.</p></li>
<li><p><strong>cumul</strong> (<em>float</em>) – Cumulative rainfall threshold to trigger onset.</p></li>
<li><p><strong>nbsec</strong> (<em>int</em>) – Maximum number of dry days allowed in the sequence.</p></li>
<li><p><strong>jour_pluvieux</strong> (<em>float</em>) – Minimum rainfall to consider a day as rainy.</p></li>
<li><p><strong>irch_fin</strong> (<em>int</em>) – Maximum index limit for the onset.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Index of the onset date or NaN if onset not found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int or float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.rainf_zone">
<span class="sig-name descname"><span class="pre">rainf_zone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.rainf_zone" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset.transform_cdt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Transform a DataFrame with:</dt><dd><ul class="simple">
<li><p>Row 0 = LON</p></li>
<li><p>Row 1 = LAT</p></li>
<li><p>Row 2 = ELEV</p></li>
<li><p>Rows 3+ = daily data (or any date) with ‘ID’ column containing dates.</p></li>
</ul>
</dd>
</dl>
<p>Returns an xarray DataArray with coords = (T, Y, X), variable = ‘Observation’.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_compute_onset_dry_spell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">user_criteria</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class for computing the longest dry spell length
after the onset of a rainy season, based on user-defined criteria.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.adjust_duplicates">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">adjust_duplicates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.adjust_duplicates" title="Link to this definition"></a></dt>
<dd><p>If any values in the Series repeat, nudge them by a tiny increment
so that all are unique (to avoid indexing collisions).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.compute" title="Link to this definition"></a></dt>
<dd><p>Compute the longest dry spell length after the onset for each pixel in a
given daily rainfall DataArray, using different criteria based on isohyet zones.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_data</strong> (<em>xarray.DataArray</em>) – Daily rainfall data, coords = (T, Y, X).</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em>) – Number of parallel processes to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array with the longest dry spell length per pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.compute_insitu" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.day_of_year">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">day_of_year</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">i</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dem_rech1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.day_of_year" title="Link to this definition"></a></dt>
<dd><p>Given a year ‘i’ and a month-day string ‘dem_rech1’ (e.g., ‘07-23’),
return the 1-based day of the year.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.default_criteria">
<span class="sig-name descname"><span class="pre">default_criteria</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{0:</span> <span class="pre">{'cumulative':</span> <span class="pre">10,</span> <span class="pre">'end_search':</span> <span class="pre">'08-30',</span> <span class="pre">'nbjour':</span> <span class="pre">40,</span> <span class="pre">'number_dry_days':</span> <span class="pre">25,</span> <span class="pre">'start_search':</span> <span class="pre">'06-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel100_0mm'},</span> <span class="pre">1:</span> <span class="pre">{'cumulative':</span> <span class="pre">15,</span> <span class="pre">'end_search':</span> <span class="pre">'08-15',</span> <span class="pre">'nbjour':</span> <span class="pre">40,</span> <span class="pre">'number_dry_days':</span> <span class="pre">25,</span> <span class="pre">'start_search':</span> <span class="pre">'05-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel200_100mm'},</span> <span class="pre">2:</span> <span class="pre">{'cumulative':</span> <span class="pre">15,</span> <span class="pre">'end_search':</span> <span class="pre">'07-31',</span> <span class="pre">'nbjour':</span> <span class="pre">40,</span> <span class="pre">'number_dry_days':</span> <span class="pre">20,</span> <span class="pre">'start_search':</span> <span class="pre">'05-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel400_200mm'},</span> <span class="pre">3:</span> <span class="pre">{'cumulative':</span> <span class="pre">20,</span> <span class="pre">'end_search':</span> <span class="pre">'07-31',</span> <span class="pre">'nbjour':</span> <span class="pre">45,</span> <span class="pre">'number_dry_days':</span> <span class="pre">20,</span> <span class="pre">'start_search':</span> <span class="pre">'03-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Sahel600_400mm'},</span> <span class="pre">4:</span> <span class="pre">{'cumulative':</span> <span class="pre">20,</span> <span class="pre">'end_search':</span> <span class="pre">'07-31',</span> <span class="pre">'nbjour':</span> <span class="pre">50,</span> <span class="pre">'number_dry_days':</span> <span class="pre">10,</span> <span class="pre">'start_search':</span> <span class="pre">'03-15',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Soudan'},</span> <span class="pre">5:</span> <span class="pre">{'cumulative':</span> <span class="pre">20,</span> <span class="pre">'end_search':</span> <span class="pre">'06-15',</span> <span class="pre">'nbjour':</span> <span class="pre">50,</span> <span class="pre">'number_dry_days':</span> <span class="pre">10,</span> <span class="pre">'start_search':</span> <span class="pre">'02-01',</span> <span class="pre">'thrd_rain_day':</span> <span class="pre">0.85,</span> <span class="pre">'zone_name':</span> <span class="pre">'Golfe_Of_Guinea'}}</span></em><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.default_criteria" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.dry_spell_onset_function">
<span class="sig-name descname"><span class="pre">dry_spell_onset_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idebut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cumul</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jour_pluvieux</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irch_fin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbjour</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.dry_spell_onset_function" title="Link to this definition"></a></dt>
<dd><p>Calculate the onset date of a season based on cumulative rainfall criteria, and
determine the longest dry spell sequence within a specified period after the onset.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.dry_spell_onset_function_">
<span class="sig-name descname"><span class="pre">dry_spell_onset_function_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">idebut</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cumul</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbsec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jour_pluvieux</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irch_fin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nbjour</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.dry_spell_onset_function_" title="Link to this definition"></a></dt>
<dd><p>Calculate the onset date of a season based on cumulative rainfall criteria, and
determine the longest dry spell sequence within a specified period after the onset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em>) – Daily rainfall or similar values.</p></li>
<li><p><strong>idebut</strong> (<em>int</em>) – Start index to begin searching for the onset.</p></li>
<li><p><strong>cumul</strong> (<em>float</em>) – Cumulative rainfall threshold to trigger onset.</p></li>
<li><p><strong>nbsec</strong> (<em>int</em>) – Maximum number of dry days allowed in the sequence.</p></li>
<li><p><strong>jour_pluvieux</strong> (<em>float</em>) – Minimum rainfall to consider a day as rainy.</p></li>
<li><p><strong>irch_fin</strong> (<em>int</em>) – Maximum index limit for the onset.</p></li>
<li><p><strong>nbjour</strong> (<em>int</em>) – Number of days to check for the longest dry spell after onset.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Length of the longest dry spell sequence after onset or NaN if onset not found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.rainf_zone">
<span class="sig-name descname"><span class="pre">rainf_zone</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.rainf_zone" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_compute_onset_dry_spell.transform_cdt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Transform a DataFrame with:</dt><dd><ul class="simple">
<li><p>Row 0 = LON</p></li>
<li><p>Row 1 = LAT</p></li>
<li><p>Row 2 = ELEV</p></li>
<li><p>Rows 3+ = daily data (or any date) with ‘ID’ column containing dates.</p></li>
</ul>
</dd>
</dl>
<p>Returns an xarray DataArray with coords = (T, Y, X), variable = ‘Observation’.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_dry_spells">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_count_dry_spells</span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_dry_spells" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to compute the number of dry spells within a specified period
(onset to cessation) for each pixel or station in a daily rainfall dataset.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_dry_spells.adjust_duplicates">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">adjust_duplicates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_dry_spells.adjust_duplicates" title="Link to this definition"></a></dt>
<dd><p>If any values in the Series repeat, nudge them by a tiny increment
so that all are unique (to avoid indexing collisions).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_dry_spells.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_spell_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_dry_spells.compute" title="Link to this definition"></a></dt>
<dd><p>Compute the number of dry spells for each pixel within the onset and cessation period
in a daily xarray DataArray.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_data</strong> (<em>xarray.DataArray</em>) – Daily rainfall data, coords = (T, Y, X).</p></li>
<li><p><strong>onset_date</strong> (<em>xarray.DataArray</em>) – DataArray containing onset dates for each pixel.</p></li>
<li><p><strong>cessation_date</strong> (<em>xarray.DataArray</em>) – DataArray containing cessation dates for each pixel.</p></li>
<li><p><strong>dry_spell_length</strong> (<em>int</em>) – The length of a dry spell to count.</p></li>
<li><p><strong>dry_threshold</strong> (<em>float</em>) – Rainfall threshold to classify a day as “dry.”</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em>) – Number of parallel processes to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An array with the count of dry spells per pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_dry_spells.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_df_cpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_df_cpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_spell_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_dry_spells.compute_insitu" title="Link to this definition"></a></dt>
<dd><p>Compute the number of dry spells (of length = dry_spell_length) between the
onset and cessation dates for in-situ stations (CDT format).</p>
<dl class="simple">
<dt>Returns a DataFrame in CPT format:</dt><dd><ul class="simple">
<li><p>Row 0: [“LAT”, lat_stn1, lat_stn2, …]</p></li>
<li><p>Row 1: [“LON”, lon_stn1, lon_stn2, …]</p></li>
<li><p>Subsequent rows: [year, station1_value, station2_value, …]</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_df</strong> (<em>pd.DataFrame</em>) – CDT rainfall data (ID column = date, station columns).</p></li>
<li><p><strong>onset_df_cpt</strong> (<em>pd.DataFrame</em>) – CPT-format DataFrame containing onset dates (as returned by some method).</p></li>
<li><p><strong>cessation_df_cpt</strong> (<em>pd.DataFrame</em>) – CPT-format DataFrame containing cessation dates.</p></li>
<li><p><strong>dry_spell_length</strong> (<em>int</em>) – The length of the dry spell to look for.</p></li>
<li><p><strong>dry_threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – Rainfall threshold below which a day is considered “dry.” Defaults to 1.0 mm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Final dry-spell counts in CPT pivot format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_dry_spells.count_dry_spells">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">count_dry_spells</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_spell_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dry_threshold</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_dry_spells.count_dry_spells" title="Link to this definition"></a></dt>
<dd><p>Count the number of dry spells of a specific length between onset and cessation dates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em>) – Daily rainfall values.</p></li>
<li><p><strong>onset</strong> (<em>int</em>) – Start index for the calculation (onset date).</p></li>
<li><p><strong>cessation</strong> (<em>int</em>) – End index for the calculation (cessation date).</p></li>
<li><p><strong>dry_spell_length</strong> (<em>int</em>) – The length of a dry spell to count.</p></li>
<li><p><strong>dry_threshold</strong> (<em>float</em>) – Rainfall threshold to classify a day as “dry.”</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The number of dry spells of the specified length (NaN if invalid).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int or float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_dry_spells.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_dry_spells.transform_cdt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Transform a DataFrame with:</dt><dd><ul class="simple">
<li><p>Row 0 = LON</p></li>
<li><p>Row 1 = LAT</p></li>
<li><p>Row 2 = ELEV</p></li>
<li><p>Rows 3+ = daily data with ‘ID’ column containing dates.</p></li>
</ul>
</dd>
<dt>Returns a DataFrame with columns like:</dt><dd><p>DATE | STATION | VALUE | LON | LAT | ELEV | MEAN_ANNUAL_RAINFALL | zonename</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_dry_spells.transform_cpt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cpt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">missing_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_dry_spells.transform_cpt" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Transform a DataFrame in CPT format with:</dt><dd><ul class="simple">
<li><p>Row 0 = LAT</p></li>
<li><p>Row 1 = LON</p></li>
<li><p>Rows 2+ = numeric year data in wide format (stations in columns).</p></li>
</ul>
</dd>
<dt>Returns a DataFrame with columns like:</dt><dd><p>YEAR | STATION | VALUE | LAT | LON</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_rainy_days">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_count_rainy_days</span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_rainy_days" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to compute the number of rainy days between onset and cessation dates
for each pixel or station in a daily rainfall dataset.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_rainy_days.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rain_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_rainy_days.compute" title="Link to this definition"></a></dt>
<dd><p>Compute the number of rainy days for each pixel between onset and cessation dates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_data</strong> (<em>xarray.DataArray</em>) – Daily rainfall data, coords = (T, Y, X).</p></li>
<li><p><strong>onset_date</strong> (<em>xarray.DataArray</em>) – DataArray containing onset dates for each pixel.</p></li>
<li><p><strong>cessation_date</strong> (<em>xarray.DataArray</em>) – DataArray containing cessation dates for each pixel.</p></li>
<li><p><strong>rain_threshold</strong> (<em>float</em>) – Rainfall threshold to classify a day as “rainy.”</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em>) – Number of parallel processes to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array with the count of rainy days per pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_rainy_days.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_df_cpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_df_cpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rain_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.85</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_rainy_days.compute_insitu" title="Link to this definition"></a></dt>
<dd><p>Compute, for in-situ stations (CDT data), the number of rainy days between
onset and cessation, for each station and year.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_df</strong> (<em>pd.DataFrame</em>) – CDT precipitation data (ID column = date; columns = stations).
Follows the standard CDT format.</p></li>
<li><p><strong>onset_df_cpt</strong> (<em>pd.DataFrame</em>) – Result of <cite>WAS_compute_onset.compute_insitu(…)</cite> for onset (CPT format).</p></li>
<li><p><strong>cessation_df_cpt</strong> (<em>pd.DataFrame</em>) – Same format for cessation (CPT format).</p></li>
<li><p><strong>rain_threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – Precipitation threshold for counting a day as “rainy,” by default 0.85 mm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>df_final</strong> – The count of rainy days in CPT pivot format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_rainy_days.count_rainy_days">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">count_rainy_days</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rain_threshold</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_rainy_days.count_rainy_days" title="Link to this definition"></a></dt>
<dd><p>Count the number of rainy days between onset and cessation dates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em>) – Daily rainfall values.</p></li>
<li><p><strong>onset_date</strong> (<em>int</em>) – Start index for the calculation (onset date).</p></li>
<li><p><strong>cessation_date</strong> (<em>int</em>) – End index for the calculation (cessation date).</p></li>
<li><p><strong>rain_threshold</strong> (<em>float</em>) – Rainfall threshold to classify a day as “rainy.”</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Number of rainy days (returns NaN if data is invalid).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int or float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_rainy_days.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_rainy_days.transform_cdt" title="Link to this definition"></a></dt>
<dd><p>Transform a DataFrame in CDT format into a standardized long DataFrame.</p>
<dl class="simple">
<dt>CDT format assumptions:</dt><dd><ul class="simple">
<li><p>Row 0 = LON</p></li>
<li><p>Row 1 = LAT</p></li>
<li><p>Row 2 = ELEV</p></li>
<li><p>Rows 3+ = daily data with ‘ID’ column holding dates in YYYYMMDD format.</p></li>
</ul>
</dd>
<dt>This method returns a DataFrame with columns:</dt><dd><p>DATE, STATION, VALUE, LON, LAT, ELEV, (optional) MEAN_ANNUAL_RAINFALL, zonename</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_wet_spells">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_compute_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_count_wet_spells</span></span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_wet_spells" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to compute the number of wet spells within a specified period
(onset to cessation) for each pixel or station in a daily rainfall dataset.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_wet_spells.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_spell_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_wet_spells.compute" title="Link to this definition"></a></dt>
<dd><p>Compute the number of wet spells for each pixel within the onset and cessation period
in a daily xarray DataArray.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_data</strong> (<em>xarray.DataArray</em>) – Daily rainfall data, coords = (T, Y, X).</p></li>
<li><p><strong>onset_date</strong> (<em>xarray.DataArray</em>) – DataArray containing onset dates for each pixel.</p></li>
<li><p><strong>cessation_date</strong> (<em>xarray.DataArray</em>) – DataArray containing cessation dates for each pixel.</p></li>
<li><p><strong>wet_spell_length</strong> (<em>int</em>) – The length of a wet spell to count.</p></li>
<li><p><strong>wet_threshold</strong> (<em>float</em>) – Rainfall threshold to classify a day as “wet.”</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em>) – Number of parallel processes to use.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array with the count of wet spells per pixel.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_wet_spells.compute_insitu">
<span class="sig-name descname"><span class="pre">compute_insitu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">daily_df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_df_cpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_df_cpt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_spell_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_wet_spells.compute_insitu" title="Link to this definition"></a></dt>
<dd><p>Compute the number of wet spells (of length = wet_spell_length) between
onset and cessation for in-situ stations (CDT data).</p>
<dl class="simple">
<dt>Returns a DataFrame in CPT format:</dt><dd><ul class="simple">
<li><p>Row 0: [“LAT”, lat_station1, lat_station2, …]</p></li>
<li><p>Row 1: [“LON”, lon_station1, lon_station2, …]</p></li>
<li><p>Then one row per year: [year, station1_value, station2_value, …]</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>daily_df</strong> (<em>pd.DataFrame</em>) – CDT rainfall data (ID column = date, station columns).</p></li>
<li><p><strong>onset_df_cpt</strong> (<em>pd.DataFrame</em>) – CPT-format DataFrame with onset dates (same station columns).</p></li>
<li><p><strong>cessation_df_cpt</strong> (<em>pd.DataFrame</em>) – CPT-format DataFrame with cessation dates (same station columns).</p></li>
<li><p><strong>wet_spell_length</strong> (<em>int</em>) – The length of a wet spell to count.</p></li>
<li><p><strong>wet_threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – Rainfall threshold classifying a day as “wet.” Defaults to 1.0 mm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Final wet-spell counts in CPT pivot format.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_wet_spells.count_wet_spells">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">count_wet_spells</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">onset_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cessation_date</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_spell_length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_threshold</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_wet_spells.count_wet_spells" title="Link to this definition"></a></dt>
<dd><p>Count the number of wet spells of a specific length between onset and cessation dates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em>) – Daily rainfall values.</p></li>
<li><p><strong>onset_date</strong> (<em>int</em>) – Start index for the calculation (onset date).</p></li>
<li><p><strong>cessation_date</strong> (<em>int</em>) – End index for the calculation (cessation date).</p></li>
<li><p><strong>wet_spell_length</strong> (<em>int</em>) – The length of a wet spell to count.</p></li>
<li><p><strong>wet_threshold</strong> (<em>float</em>) – Rainfall threshold to classify a day as “wet.”</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The number of wet spells of the specified length (NaN if data is invalid).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int or float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_compute_predictand.WAS_count_wet_spells.transform_cdt">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_compute_predictand.WAS_count_wet_spells.transform_cdt" title="Link to this definition"></a></dt>
<dd><p>Transform a CDT-format DataFrame into a standard table.</p>
<dl class="simple">
<dt>CDT format assumptions:</dt><dd><ul class="simple">
<li><p>Row 0 = LON</p></li>
<li><p>Row 1 = LAT</p></li>
<li><p>Row 2 = ELEV</p></li>
<li><p>Rows 3+ = daily data, ‘ID’ column has dates in YYYYMMDD.</p></li>
</ul>
</dd>
<dt>Returns a DataFrame with columns:</dt><dd><p>[DATE, STATION, VALUE, LON, LAT, ELEV, MEAN_ANNUAL_RAINFALL, zonename]</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_bias_correction">
<span id="wass2s-was-bias-correction-module"></span><h3>wass2s.was_bias_correction module<a class="headerlink" href="#module-wass2s.was_bias_correction" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_bias_correction.</span></span><span class="sig-name descname"><span class="pre">WAS_Qmap</span></span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Bias correction methods using quantile mapping techniques, adapted from qmap R package.</p>
<p>This class provides static methods for fitting and applying various bias correction
techniques, including empirical quantile mapping (QUANT), robust quantile mapping (RQUANT),
smoothing splines (SSPLIN), parametric transformations (PTF), and distribution-based
methods (DIST). The methods support both NumPy arrays (1D, 2D, or 3D) and xarray
DataArrays (3D: T, Y, X or similar).</p>
<p>All methods handle wet/dry day corrections optionally and are designed for
precipitation or similar non-negative variables.</p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Inputs are expected to be non-negative.</p></li>
<li><p>For gridded data, computations are performed column-wise (per grid cell).</p></li>
<li><p>xarray support preserves coordinates and attributes.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.doQmap">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doQmap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.doQmap" title="Link to this definition"></a></dt>
<dd><p>Apply the fitted bias correction to new data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – New modeled data to correct, same format and shape structure as fitting data.</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitQmap</cite>.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the specific application method.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Bias-corrected data, same type and shape as <cite>x</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array_like or xarray.DataArray</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If input types or dimensions mismatch the fitted object.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#wass2s.was_bias_correction.WAS_Qmap.fitQmap" title="wass2s.was_bias_correction.WAS_Qmap.fitQmap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fitQmap</span></code></a></dt><dd><p>Fit the bias correction model.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.doQmapDIST">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doQmapDIST</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.doQmapDIST" title="Link to this definition"></a></dt>
<dd><p>Apply distribution-based (DIST) correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitQmapDIST</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.doQmapPTF">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doQmapPTF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.doQmapPTF" title="Link to this definition"></a></dt>
<dd><p>Apply parametric transformation (PTF) correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitQmapPTF</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If unknown transfun in fobj.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.doQmapQUANT">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doQmapQUANT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.doQmapQUANT" title="Link to this definition"></a></dt>
<dd><p>Apply empirical quantile mapping (QUANT) correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitQmapQUANT</cite>.</p></li>
<li><p><strong>type</strong> (<em>str</em><em>, </em><em>optional</em>) – Interpolation kind for <cite>interp1d</cite> (default ‘linear’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.doQmapRQUANT">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doQmapRQUANT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slope_bound</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0,</span> <span class="pre">inf]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.doQmapRQUANT" title="Link to this definition"></a></dt>
<dd><p>Apply robust quantile mapping (RQUANT) correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitQmapRQUANT</cite>.</p></li>
<li><p><strong>type</strong> (<em>str</em><em>, </em><em>optional</em>) – Interpolation kind for <cite>interp1d</cite> (default ‘linear’).</p></li>
<li><p><strong>slope_bound</strong> (<em>list</em><em> of </em><em>float</em><em>, </em><em>optional</em>) – Bounds for extrapolation slopes [min, max] (default [0, inf]).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.doQmapSSPLIN">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doQmapSSPLIN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.doQmapSSPLIN" title="Link to this definition"></a></dt>
<dd><p>Apply quantile mapping correction using PCHIP interpolator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitQmapSSPLIN</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.evaluate_bias_correction">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">evaluate_bias_correction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corrected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extreme_quantiles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.95,</span> <span class="pre">0.99]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.evaluate_bias_correction" title="Link to this definition"></a></dt>
<dd><p>Evaluate bias correction performance with metrics for dry/wet days and extremes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – Observed data (numpy array or xarray.DataArray, shape (T, Y, X) or (T,)).</p></li>
<li><p><strong>mod</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – Modeled (uncorrected) data (same shape as obs).</p></li>
<li><p><strong>corrected</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – Bias-corrected data (same shape as obs).</p></li>
<li><p><strong>wet_threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – Threshold for wet days (default 0.1 mm).</p></li>
<li><p><strong>extreme_quantiles</strong> (<em>list</em><em> of </em><em>float</em><em>, </em><em>optional</em>) – List of quantiles for extremes (default [0.95, 0.99]).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary with evaluation metrics, or xarray.Dataset if input is DataArray.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict or xarray.Dataset</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.fitQmap">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitQmap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.fitQmap" title="Link to this definition"></a></dt>
<dd><p>Fit a bias correction model using the specified quantile mapping method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – Observed data. If array_like, can be 1D (time), 2D (time, grid), or 3D (T, Y, X).
If xarray.DataArray, must be 3D with dimensions (T, Y, X).</p></li>
<li><p><strong>mod</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – Modeled data to fit against, same shape as <cite>obs</cite>.</p></li>
<li><p><strong>method</strong> (<em>str</em>) – Bias correction method. Options: ‘QUANT’, ‘RQUANT’, ‘SSPLIN’, ‘PTF’, ‘DIST’ (case-insensitive).</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the specific fitting method.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted object containing parameters, class identifier, and metadata for applying correction.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If shapes mismatch, invalid dimensions, or unknown method.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#wass2s.was_bias_correction.WAS_Qmap.doQmap" title="wass2s.was_bias_correction.WAS_Qmap.doQmap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">doQmap</span></code></a></dt><dd><p>Apply the fitted bias correction to new data.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.fitQmapDIST">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitQmapDIST</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'berngamma'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.fitQmapDIST" title="Link to this definition"></a></dt>
<dd><p>Fit distribution-based quantile mapping (DIST).</p>
<p>Uses Bernoulli for wet/dry and a continuous distribution for wet values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
<li><p><strong>distr</strong> (<em>str</em><em>, </em><em>optional</em>) – Wet distribution: ‘berngamma’, ‘bernexp’, ‘bernlnorm’, ‘bernweibull’ (default ‘berngamma’).</p></li>
<li><p><strong>qstep</strong> (<em>float</em><em>, </em><em>optional</em>) – If set, fit on quantiles; else on full data.</p></li>
<li><p><strong>**kwargs</strong> – Additional arguments (unused).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including distributions and transfer functions.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If unknown distr.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.fitQmapPTF">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitQmapPTF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transfun</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'power'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parini</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'RSS'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.fitQmapPTF" title="Link to this definition"></a></dt>
<dd><p>Fit parametric transformation function (PTF) for bias correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
<li><p><strong>transfun</strong> (<em>str</em><em> or </em><em>callable</em><em>, </em><em>optional</em>) – Transformation function: ‘power’, ‘power.x0’, ‘expasympt’, ‘expasympt.x0’, ‘scale’, ‘linear’,
or a custom callable (default ‘power’).</p></li>
<li><p><strong>parini</strong> (<em>list</em><em>, </em><em>optional</em>) – Initial parameter guesses for optimization.</p></li>
<li><p><strong>cost</strong> (<em>str</em><em>, </em><em>optional</em>) – Cost function for optimization: ‘RSS’ or ‘MAE’ (default ‘RSS’).</p></li>
<li><p><strong>wet_day</strong> (<em>bool</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Wet day handling (default False).</p></li>
<li><p><strong>qstep</strong> (<em>float</em><em>, </em><em>optional</em>) – If set, fit on quantiles with this step; else fit on sorted data.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including transformation and thresholds.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If unknown transfun or cost.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.fitQmapQUANT">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitQmapQUANT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nboot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.fitQmapQUANT" title="Link to this definition"></a></dt>
<dd><p>Fit empirical quantile mapping (QUANT) with optional bootstrapping.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
<li><p><strong>wet_day</strong> (<em>bool</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Wet day handling (default False).</p></li>
<li><p><strong>qstep</strong> (<em>float</em><em>, </em><em>optional</em>) – Quantile step size (default 0.01).</p></li>
<li><p><strong>nboot</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of bootstrap samples for observed quantiles (default 1, no bootstrap).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including quantiles and thresholds.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.fitQmapRQUANT">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitQmapRQUANT</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nlls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nboot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.fitQmapRQUANT" title="Link to this definition"></a></dt>
<dd><p>Fit robust quantile mapping (RQUANT) with local linear fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
<li><p><strong>wet_day</strong> (<em>bool</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Wet day handling (default True).</p></li>
<li><p><strong>qstep</strong> (<em>float</em><em>, </em><em>optional</em>) – Quantile step size (default 0.01).</p></li>
<li><p><strong>nlls</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of local quantiles for linear fit (default 10).</p></li>
<li><p><strong>nboot</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of bootstrap samples (default 10).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including quantiles, slopes, and thresholds.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.fitQmapSSPLIN">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitQmapSSPLIN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.fitQmapSSPLIN" title="Link to this definition"></a></dt>
<dd><p>Fit quantile mapping using PCHIP smoothing splines (SSPLIN).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
<li><p><strong>wet_day</strong> (<em>bool</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – Wet day handling (default False).</p></li>
<li><p><strong>qstep</strong> (<em>float</em><em>, </em><em>optional</em>) – Quantile step size (default 0.01).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including quantiles and thresholds.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.plot_extreme_quantiles_group">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">plot_extreme_quantiles_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">robust</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.plot_extreme_quantiles_group" title="Link to this definition"></a></dt>
<dd><p>Plots extreme_quantiles_* variables, faceting by variable (columns) and quantile (rows).
Assumes dims (‘quantile’, ‘Y’, ‘X’).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.plot_fraction_group">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">plot_fraction_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">group_prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">robust</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.plot_fraction_group" title="Link to this definition"></a></dt>
<dd><p>Plots dry/wet fraction groups (e.g., ‘<a href="#id21"><span class="problematic" id="id22">dry_fraction_</span></a>’ or ‘<a href="#id23"><span class="problematic" id="id24">wet_fraction_</span></a>’).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_Qmap.plot_mean_wet_group">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">plot_mean_wet_group</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extent</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">robust</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_Qmap.plot_mean_wet_group" title="Link to this definition"></a></dt>
<dd><p>Plots mean_wet_* variables.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_bias_correction.</span></span><span class="sig-name descname"><span class="pre">WAS_bias_correction</span></span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Bias correction methods for climate variables such as temperature or wind speed.</p>
<p>This class provides static methods for fitting and applying bias correction
techniques suitable for continuous variables that may include negative values
or skewed positive values, such as mean adjustment, variance scaling, empirical
quantile mapping (non-parametric), and parametric mapping assuming various
distributions (normal, lognormal, gamma, weibull). The methods support both
NumPy arrays (1D, 2D, or 3D) and xarray DataArrays (3D: time, lat, lon or similar).</p>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Inputs can be negative and are treated as continuous, but for positive skewed data
like wind speed, use distributions like ‘lognormal’, ‘gamma’, or ‘weibull’.</p></li>
<li><p>No handling for wet/dry days.</p></li>
<li><p>For gridded data, computations are performed column-wise (per grid cell).</p></li>
<li><p>xarray support preserves coordinates and attributes.</p></li>
<li><p>Non-parametric method: ‘QUANT’ (empirical quantile mapping).</p></li>
<li><p>Parametric methods: ‘NORM’ (normal), or ‘DIST’ with specified distribution.</p></li>
<li><p>Handles NaNs: Ignores NaNs in fitting by filtering them out; if fewer than 2 valid points
per grid cell in obs or mod, flags as all_nan and outputs NaNs for that grid in application.
NaNs in input data during application are propagated as NaNs in output.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.doBC">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doBC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.doBC" title="Link to this definition"></a></dt>
<dd><p>Apply the fitted bias correction to new data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – New modeled data to correct, same format and shape structure as fitting data.</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitBC</cite>.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the specific application method.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Bias-corrected data, same type and shape as <cite>x</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array_like or xarray.DataArray</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If input types or dimensions mismatch the fitted object.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#wass2s.was_bias_correction.WAS_bias_correction.fitBC" title="wass2s.was_bias_correction.WAS_bias_correction.fitBC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fitBC</span></code></a></dt><dd><p>Fit the bias correction model.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.doDist">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doDist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.doDist" title="Link to this definition"></a></dt>
<dd><p>Apply parametric distribution bias correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitDist</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.doMean">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doMean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.doMean" title="Link to this definition"></a></dt>
<dd><p>Apply mean additive bias correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitMean</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.doQuant">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doQuant</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.doQuant" title="Link to this definition"></a></dt>
<dd><p>Apply empirical quantile mapping correction (non-parametric).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitQuant</cite>.</p></li>
<li><p><strong>type</strong> (<em>str</em><em>, </em><em>optional</em>) – Interpolation kind for <cite>interp1d</cite> (default ‘linear’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.doVarscale">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">doVarscale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fobj</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.doVarscale" title="Link to this definition"></a></dt>
<dd><p>Apply variance scaling bias correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – 2D data to correct (time, grid).</p></li>
<li><p><strong>fobj</strong> (<em>dict</em>) – Fitted object from <cite>fitVarscale</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Corrected data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.fitBC">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitBC</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.fitBC" title="Link to this definition"></a></dt>
<dd><p>Fit a bias correction model using the specified method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – Observed data. If array_like, can be 1D (time), 2D (time, grid), or 3D (time, y, x).
If xarray.DataArray, must be 3D with dimensions (time, y, x).</p></li>
<li><p><strong>mod</strong> (<em>array_like</em><em> or </em><em>xarray.DataArray</em>) – Modeled data to fit against, same shape as <cite>obs</cite>.</p></li>
<li><p><strong>method</strong> (<em>str</em>) – Bias correction method. Options: ‘MEAN’, ‘VARSCALE’, ‘QUANT’, ‘NORM’, ‘DIST’ (case-insensitive).</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to the specific fitting method.
For ‘DIST’, include ‘distr’ (e.g., ‘lognormal’, ‘gamma’, ‘weibull’, default ‘normal’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted object containing parameters, class identifier, and metadata for applying correction.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If shapes mismatch, invalid dimensions, or unknown method.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<dl class="simple">
<dt><a class="reference internal" href="#wass2s.was_bias_correction.WAS_bias_correction.doBC" title="wass2s.was_bias_correction.WAS_bias_correction.doBC"><code class="xref py py-obj docutils literal notranslate"><span class="pre">doBC</span></code></a></dt><dd><p>Apply the fitted bias correction to new data.</p>
</dd>
</dl>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.fitDist">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitDist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distr</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'normal'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.fitDist" title="Link to this definition"></a></dt>
<dd><p>Fit parametric bias correction assuming a specified distribution.</p>
<p>Suitable for skewed data like wind speed with ‘lognormal’, ‘gamma’, or ‘weibull’.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
<li><p><strong>distr</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution: ‘normal’, ‘lognormal’, ‘gamma’, ‘weibull’ (default ‘normal’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including distribution parameters.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If unknown distribution.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.fitMean">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitMean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.fitMean" title="Link to this definition"></a></dt>
<dd><p>Fit mean additive bias correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including delta (mean difference).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.fitQuant">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitQuant</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qstep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nboot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.fitQuant" title="Link to this definition"></a></dt>
<dd><p>Fit empirical quantile mapping (non-parametric).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
<li><p><strong>qstep</strong> (<em>float</em><em>, </em><em>optional</em>) – Quantile step size (default 0.01).</p></li>
<li><p><strong>nboot</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of bootstrap samples for observed quantiles (default 1, no bootstrap).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including quantiles.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_bias_correction.WAS_bias_correction.fitVarscale">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">fitVarscale</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mod</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_bias_correction.WAS_bias_correction.fitVarscale" title="Link to this definition"></a></dt>
<dd><p>Fit variance scaling bias correction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>ndarray</em>) – 2D observed data (time, grid).</p></li>
<li><p><strong>mod</strong> (<em>ndarray</em>) – 2D modeled data (time, grid).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Fitted parameters including means and standard deviations.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_merge_predictand">
<span id="wass2s-was-merge-predictand-module"></span><h3>wass2s.was_merge_predictand module<a class="headerlink" href="#module-wass2s.was_merge_predictand" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_merge_predictand.</span></span><span class="sig-name descname"><span class="pre">WAS_Merging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">date_month_day</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'08-01'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.adjust_duplicates">
<span class="sig-name descname"><span class="pre">adjust_duplicates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">increment</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1e-05</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Series</span></span></span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.adjust_duplicates" title="Link to this definition"></a></dt>
<dd><p>If any values in the Series repeat, nudge them by a tiny increment
so that all are unique (to avoid indexing collisions).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.auto_select_kriging_parameters">
<span class="sig-name descname"><span class="pre">auto_select_kriging_parameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_col</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'residuals'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variogram_models</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nlags_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">range(3,</span> <span class="pre">10)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_splits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enable_plotting</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.auto_select_kriging_parameters" title="Link to this definition"></a></dt>
<dd><p>Automatically selects the best variogram_model and nlags for Ordinary Kriging
using cross-validation.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p>best_model (str)</p></li>
<li><p>best_nlags (int)</p></li>
<li><p>ok_best (OrdinaryKriging object)</p></li>
<li><p>results_df (pd.DataFrame)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.multiplicative_bias">
<span class="sig-name descname"><span class="pre">multiplicative_bias</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">missing_value:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">-999.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_cross_validation:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False)</span> <span class="pre">-&gt;</span> <span class="pre">(&lt;class</span> <span class="pre">'xarray.core.dataarray.DataArray'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">&lt;class</span> <span class="pre">'pandas.core.frame.DataFrame'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.multiplicative_bias" title="Link to this definition"></a></dt>
<dd><p>Apply multiplicative bias correction to gridded predictions using ground observations.</p>
<p>This method performs bias adjustment for each time step by comparing standardized observations
and model estimates, interpolating residuals using kriging, and applying a multiplicative correction
across the spatial domain.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>missing_value</strong> (<em>float</em><em>, </em><em>optional</em>) – Value used to represent missing data in the input observational CSV, by default -999.0.</p></li>
<li><p><strong>do_cross_validation</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, perform Leave-One-Out Cross-Validation to estimate kriging performance, by default False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>xr.DataArray</em> – The bias-corrected spatial dataset over time (with dimensions: T, Y, X), masked over valid areas.</p></li>
<li><p><em>pd.DataFrame or None</em> – DataFrame containing LOOCV RMSE per time step, or None if cross-validation was not performed.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.neural_network_kriging">
<span class="sig-name descname"><span class="pre">neural_network_kriging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">missing_value:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">-999.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_cross_validation:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False)</span> <span class="pre">-&gt;</span> <span class="pre">(&lt;class</span> <span class="pre">'xarray.core.dataarray.DataArray'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pandas.core.frame.DataFrame</span> <span class="pre">|</span> <span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.neural_network_kriging" title="Link to this definition"></a></dt>
<dd><p>Performs a two-step spatial bias adjustment for each time slice, leveraging:</p>
<ol class="arabic simple">
<li><p><strong>Neural Network</strong> (MLPRegressor) to capture non-linear relationships between
the large-scale estimations (predictors) and in-situ observations (predictands).</p></li>
<li><p><strong>Kriging</strong> of the residuals (observation - NN_prediction) to spatially interpolate
the remaining error structure under the assumption that these residuals are
stationary and exhibit spatial autocorrelation.</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>missing_value</strong> (<em>float</em><em>, </em><em>optional</em>) – Value used to fill missing data in the input station dataset, by default -999.0</p></li>
<li><p><strong>do_cross_validation</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether or not to perform cross-validation (e.g., leave-one-out or k-fold)
during kriging parameter selection, by default False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>xr.DataArray</em> – Bias-adjusted field over the domain, with the same spatial dimensions as the
original input (and time dimension if applicable).</p></li>
<li><p><em>pd.DataFrame or None</em> – If <cite>do_cross_validation=True</cite>, returns a DataFrame with RMSE records from CV;
otherwise, None.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>The hyperparameter search for the MLP uses GridSearchCV with MSE-based scoring.</p></li>
<li><p>Kriging assumes the residuals are reasonably stationary and spatially correlated.</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.neural_network_kriging_">
<span class="sig-name descname"><span class="pre">neural_network_kriging_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">missing_value:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">-999.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_cross_validation:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False)</span> <span class="pre">-&gt;</span> <span class="pre">(&lt;class</span> <span class="pre">'xarray.core.dataarray.DataArray'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">&lt;class</span> <span class="pre">'pandas.core.frame.DataFrame'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.neural_network_kriging_" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Performs spatial bias adjustment for each time slice using:</dt><dd><ol class="arabic simple">
<li><p>Neural Network</p></li>
<li><p>Kriging of residuals</p></li>
</ol>
</dd>
</dl>
<p>Optionally performs LOO cross-validation for each time.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.plot_merging_comparaison">
<span class="sig-name descname"><span class="pre">plot_merging_comparaison</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_Obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da_estimated</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">da_corrected</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">missing_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">-999.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.plot_merging_comparaison" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.regression_kriging">
<span class="sig-name descname"><span class="pre">regression_kriging</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">missing_value:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">-999.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_cross_validation:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False)</span> <span class="pre">-&gt;</span> <span class="pre">(&lt;class</span> <span class="pre">'xarray.core.dataarray.DataArray'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">&lt;class</span> <span class="pre">'pandas.core.frame.DataFrame'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.regression_kriging" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Performs spatial bias adjustment for each time slice using:</dt><dd><ol class="arabic simple">
<li><p>Linear Regression</p></li>
<li><p>Kriging of residuals</p></li>
</ol>
</dd>
</dl>
<p>Optionally performs LOO cross-validation for each time.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.simple_bias_adjustment">
<span class="sig-name descname"><span class="pre">simple_bias_adjustment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">missing_value:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">-999.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">do_cross_validation:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False)</span> <span class="pre">-&gt;</span> <span class="pre">(&lt;class</span> <span class="pre">'xarray.core.dataarray.DataArray'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">&lt;class</span> <span class="pre">'pandas.core.frame.DataFrame'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.simple_bias_adjustment" title="Link to this definition"></a></dt>
<dd><p>Performs spatial bias adjustment for each time slice. Optionally does
leave-one-out (LOO) cross-validation to compute RMSE at each time.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><em>xr.DataArray</em> – Concatenated bias-adjusted values along the time dimension.</p></li>
<li><p><em>pd.DataFrame or None</em> – A DataFrame containing the LOO RMSE for each time if do_cross_validation=True.
Otherwise, returns None.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.transform_cdt">
<span class="sig-name descname"><span class="pre">transform_cdt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.transform_cdt" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_merge_predictand.WAS_Merging.transform_cpt">
<span class="sig-name descname"><span class="pre">transform_cpt</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">missing_value</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-999.0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_merge_predictand.WAS_Merging.transform_cpt" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_cross_validate">
<span id="wass2s-was-cross-validate-module"></span><h3>wass2s.was_cross_validate module<a class="headerlink" href="#module-wass2s.was_cross_validate" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_cross_validate.CustomTimeSeriesSplit">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_cross_validate.</span></span><span class="sig-name descname"><span class="pre">CustomTimeSeriesSplit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_splits</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cross_validate.CustomTimeSeriesSplit" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Custom time series cross-validator for splitting data into training and test sets.</p>
<p>Ensures temporal ordering is maintained by generating training and test indices
suitable for time series data, with an option to omit samples after the test index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>n_splits</strong> (<em>int</em>) – Number of splits for the cross-validation.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cross_validate.CustomTimeSeriesSplit.get_n_splits">
<span class="sig-name descname"><span class="pre">get_n_splits</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cross_validate.CustomTimeSeriesSplit.get_n_splits" title="Link to this definition"></a></dt>
<dd><p>Return the number of splits for the cross-validation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>array-like</em><em>, </em><em>optional</em>) – The data to be split (ignored in this implementation).</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>optional</em>) – The target variable (ignored in this implementation).</p></li>
<li><p><strong>groups</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Group labels for the samples (ignored in this implementation).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The number of splits configured for the cross-validator.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cross_validate.CustomTimeSeriesSplit.split">
<span class="sig-name descname"><span class="pre">split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_omit</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groups</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cross_validate.CustomTimeSeriesSplit.split" title="Link to this definition"></a></dt>
<dd><p>Generate indices to split data into training and test sets.</p>
<p>Yields training indices before the test index (excluding a specified number of samples
after the test index) and test indices for each split.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>array-like</em>) – The data to be split, typically time series data.</p></li>
<li><p><strong>nb_omit</strong> (<em>int</em>) – Number of samples to omit from training after the test index to avoid data leakage.</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>optional</em>) – The target variable (ignored in this implementation).</p></li>
<li><p><strong>groups</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Group labels for the samples (ignored in this implementation).</p></li>
</ul>
</dd>
<dt class="field-even">Yields<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>train_indices</strong> (<em>ndarray</em>) – The training set indices for the current split.</p></li>
<li><p><strong>test_indices</strong> (<em>list</em>) – The test set indices for the current split.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_cross_validate.WAS_Cross_Validator">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_cross_validate.</span></span><span class="sig-name descname"><span class="pre">WAS_Cross_Validator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_splits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_omit</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cross_validate.WAS_Cross_Validator" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Performs cross-validation for time series forecasting models using a custom time series split.</p>
<p>This class wraps a custom time series cross-validator to evaluate forecasting models,
handling both deterministic hindcasts and probabilistic (tercile) predictions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_splits</strong> (<em>int</em>) – Number of splits for the cross-validation.</p></li>
<li><p><strong>nb_omit</strong> (<em>int</em>) – Number of samples to omit from training after the test index to prevent data leakage.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cross_validate.WAS_Cross_Validator.cross_validate">
<span class="sig-name descname"><span class="pre">cross_validate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">model_params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cross_validate.WAS_Cross_Validator.cross_validate" title="Link to this definition"></a></dt>
<dd><p>Perform cross-validation to compute deterministic hindcasts and tercile probabilities.</p>
<p>Iterates over time series splits, trains the model on training data, and generates
predictions for test data. Supports special handling for specific model types
(e.g., CCA, Analog, ELM, ELR, and various machine learning models).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<em>object</em>) – The forecasting model instance to evaluate.</p></li>
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Target dataset with dimensions (‘T’, ‘Y’, ‘X’) or (‘T’, ‘M’, ‘Y’, ‘X’).</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Predictor dataset with dimensions (‘T’, ‘M’, ‘Y’, ‘X’) or (‘T’, ‘features’).
Required for most models except specific cases like WAS_Analog.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em><em>, </em><em>optional</em>) – Start year of the climatology period for standardization and probability calculations.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em><em>, </em><em>optional</em>) – End year of the climatology period for standardization and probability calculations.</p></li>
<li><p><strong>**model_params</strong> (<em>dict</em>) – Additional keyword arguments to pass to the model’s compute_model method.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>If the model supports probability calculations (has compute_prob method):</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>hindcast_det<span class="classifier">xarray.DataArray</span></dt><dd><p>Deterministic hindcast results with dimensions (‘T’, ‘Y’, ‘X’) or
(‘probability’, ‘T’, ‘Y’, ‘X’) for specific models.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hindcast_prob<span class="classifier">xarray.DataArray</span></dt><dd><p>Tercile probabilities with dimensions (‘probability’, ‘T’, ‘Y’, ‘X’),
where ‘probability’ includes [‘PB’, ‘PN’, ‘PA’] (below-normal, normal, above-normal).</p>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>If the model does not support probability calculations (e.g., WAS_mme_ELR):</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>hindcast_det<span class="classifier">xarray.DataArray</span></dt><dd><p>Deterministic hindcast results with dimensions (‘T’, ‘Y’, ‘X’).</p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple or xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_linear_models">
<span id="wass2s-was-linear-models-module"></span><h3>wass2s.was_linear_models module<a class="headerlink" href="#module-wass2s.was_linear_models" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_linear_models.</span></span><span class="sig-name descname"><span class="pre">WAS_ElasticNet_Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alpha_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1_ratio_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparam_optimizer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'bayesian'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>ElasticNet regression model for spatial rainfall prediction.</p>
<p>ElasticNet combines L1 (Lasso) and L2 (Ridge) penalties, allowing both
feature selection and coefficient shrinkage. It is often a good compromise
between Lasso (aggressive sparsity) and Ridge (stability) — particularly
useful when predictors are correlated (common in climate/teleconnection data).</p>
<p>Supports two spatial optimization strategies:
- grid-wise: independent (α, l1_ratio) per grid cell (very expensive)
- cluster-wise: one (α, l1_ratio) per spatial cluster (recommended)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alpha_range</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Range of total regularization strength values.
Default: np.logspace(-6, 2, 100) — suitable for standardized rainfall data</p></li>
<li><p><strong>l1_ratio_range</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Range of L1 penalty ratio (0 = pure Ridge, 1 = pure Lasso).
Default: [0.1, 0.5, 0.7, 0.9, 0.95, 0.99, 1.0]</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>default=5</em>) – Number of spatial clusters (used only in mode=’cluster’)</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em><em>, </em><em>default=1</em>) – Number of parallel workers for grid-wise optimization</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>default='nonparam'</em>) – Clustering distance method (currently only ‘nonparam’ supported)</p></li>
<li><p><strong>hyperparam_optimizer</strong> (<em>{'bayesian'</em><em>, </em><em>'random'</em><em>, </em><em>'elasticnetcv'}</em><em>, </em><em>default='bayesian'</em>) – Hyperparameter search strategy:
- ‘bayesian’     → Optuna (usually best quality)
- ‘random’       → RandomizedSearchCV (faster, good compromise)
- ‘elasticnetcv’ → scikit-learn ElasticNetCV (fastest, discrete grid)</p></li>
<li><p><strong>n_trials</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of trials for Bayesian optimization</p></li>
<li><p><strong>n_iter</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of parameter settings sampled in randomized search</p></li>
<li><p><strong>mode</strong> (<em>{'cluster'</em><em>, </em><em>'grid'}</em><em>, </em><em>default='cluster'</em>) – Optimization approach:
- ‘cluster’ → one (alpha, l1_ratio) per spatial cluster (fast &amp; stable)
- ‘grid’    → independent optimization for each grid cell (slow, local)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Grid mode is computationally intensive — use only when spatial detail is critical
and sufficient computing resources are available.</p></li>
<li><p>Cluster mode is the recommended default for most rainfall modeling applications.</p></li>
<li><p>Requires: xarray, dask, scikit-learn, optuna (if using ‘bayesian’)</p></li>
<li><p>All models use max_iter=10000 to improve convergence</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Compute spatially varying optimal ElasticNet parameters (alpha and l1_ratio).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predictand</strong> (<em>xarray.DataArray</em>) – Target variable (typically rainfall)
Expected dimensions: (‘T’, ‘Y’, ‘X’)</p></li>
<li><p><strong>predictor</strong> (<em>xarray.DataArray</em>) – Predictor fields
Expected dimensions: (‘T’, ‘Y’, ‘X’, ‘features’) or (‘T’, ‘features’)</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of climatological standardization period</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of climatological standardization period</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>alpha_map</strong> (<em>xarray.DataArray</em>) – Spatial field (Y, X) of optimal alpha values</p></li>
<li><p><strong>l1_ratio_map</strong> (<em>xarray.DataArray</em>) – Spatial field (Y, X) of optimal l1_ratio values</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels (integers) when mode=’cluster’
Dummy array filled with 1s when mode=’grid’</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If invalid mode is provided</p></li>
<li><p><strong>RuntimeError</strong> – If dask parallel computation fails (in grid mode)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Locations/time series with &lt; 10 valid points are skipped (return NaN)</p></li>
<li><p>NaN handling is automatic (invalid time steps are masked)</p></li>
<li><p>Progress messages are printed for long-running computations</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.compute_model" title="Link to this definition"></a></dt>
<dd><p>Performs parallelized ElasticNet modeling for spatiotemporal data.
Returns [error, prediction] per grid cell.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1_ratio</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.fit_predict" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1_ratio</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates a single-year forecast using ElasticNet with (alpha, l1_ratio),
and computes tercile probabilities.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Climatology reference period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – Climatology reference period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=2, T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Single-year predictor data (features,).</p></li>
<li><p><strong>alpha</strong> (<em>xarray.DataArray</em>) – Spatial map of alpha values (Y, X).</p></li>
<li><p><strong>l1_ratio</strong> (<em>xarray.DataArray</em>) – Spatial map of l1_ratio values (Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (output=2, Y, X) =&gt; [error, forecast].
For a real forecast scenario, ‘error’ is NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; [PB, PN, PA].</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_ElasticNet_Model.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_ElasticNet_Model.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_linear_models.</span></span><span class="sig-name descname"><span class="pre">WAS_LassoLars_Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alpha_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparam_optimizer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'bayesian'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>LassoLars regression model for spatial rainfall prediction with least-angle
regression (LARS) path computation.</p>
<p>LassoLars is particularly suitable when:
- The number of samples is relatively small
- You want very precise control over the L1 regularization path
- Numerical stability is more important than speed</p>
<p>Compared to standard Lasso, LassoLars tends to be:
- More stable for small datasets
- Slightly slower
- Better when predictors are highly correlated</p>
<p>Supports two spatial strategies:
- grid-wise: independent alpha optimization per grid cell (very expensive)
- cluster-wise: one alpha per spatial cluster (recommended default)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alpha_range</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Range of regularization strength values to search.
Default: np.logspace(-6, 2, 100) — appropriate for standardized rainfall data</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>default=5</em>) – Number of spatial clusters (used only when mode=’cluster’)</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em><em>, </em><em>default=1</em>) – Number of parallel workers for grid-wise optimization</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>default='nonparam'</em>) – Clustering distance method (currently only ‘nonparam’ implemented)</p></li>
<li><p><strong>hyperparam_optimizer</strong> (<em>{'bayesian'</em><em>, </em><em>'random'</em><em>, </em><em>'lassolars_cv'}</em><em>, </em><em>default='bayesian'</em>) – Strategy for selecting optimal alpha:
- ‘bayesian’      → Optuna Bayesian optimization (best quality)
- ‘random’        → Randomized search (faster, reasonable quality)
- ‘lassolars_cv’  → scikit-learn LassoLarsCV (fastest, grid-based)</p></li>
<li><p><strong>n_trials</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of trials for Bayesian optimization (Optuna)</p></li>
<li><p><strong>n_iter</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of parameter settings sampled in randomized search</p></li>
<li><p><strong>mode</strong> (<em>{'cluster'</em><em>, </em><em>'grid'}</em><em>, </em><em>default='grid'</em>) – Optimization strategy:
- ‘cluster’ → one alpha per spatial cluster (fast &amp; robust)
- ‘grid’    → independent alpha for every grid cell (slow, very local)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>LassoLars uses the full regularization path → can be more stable than coordinate
descent Lasso when data is noisy or n_samples is small.</p></li>
<li><p>Grid mode is <strong>very computationally expensive</strong> — use cluster mode unless
you really need maximum spatial detail and have substantial computing power.</p></li>
<li><p>Requires: xarray, dask, scikit-learn, optuna (if using ‘bayesian’)</p></li>
<li><p>All models use max_iter=10000 to improve convergence on difficult cases</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Compute spatially varying optimal LassoLars regularization parameter (alpha).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predictand</strong> (<em>xarray.DataArray</em>) – Target variable (typically rainfall)
Expected dimensions: (‘T’, ‘Y’, ‘X’)</p></li>
<li><p><strong>predictor</strong> (<em>xarray.DataArray</em>) – Predictor fields
Expected dimensions: (‘T’, ‘Y’, ‘X’, ‘features’) or (‘T’, ‘features’)</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatological standardization period</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatological standardization period</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>alpha_map</strong> (<em>xarray.DataArray</em>) – Spatial field (Y, X) containing optimal alpha value(s)
- Different value per cell when mode=’grid’
- Constant per cluster when mode=’cluster’</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels (integers) when mode=’cluster’
Dummy array filled with 1s when mode=’grid’ (for API consistency)</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If mode is neither ‘cluster’ nor ‘grid’</p></li>
<li><p><strong>RuntimeError</strong> – If dask parallel computation fails (grid mode)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Time series with fewer than 10 valid points are automatically skipped (return NaN)</p></li>
<li><p>All NaN values in input are properly masked</p></li>
<li><p>Progress messages are printed during long computations</p></li>
<li><p>LassoLarsCV does <strong>not</strong> require pre-defined alpha grid (uses full LARS path)</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.compute_model" title="Link to this definition"></a></dt>
<dd><p>Fits and predicts the LassoLars model using Dask for parallel execution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data (dims: T, features).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training response variable (dims: T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test predictor data (dims: features,) or broadcastable to (Y, X).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test response variable (dims: Y, X).</p></li>
<li><p><strong>alpha</strong> (<em>xarray.DataArray</em>) – Cluster-wise optimal alpha values (dims: Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dims (output=2, Y, X) =&gt; [error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.fit_predict" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates a forecast for a single time step using LassoLars with alpha,
then computes tercile probabilities based on the chosen distribution method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year for the climatological reference period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year for the climatological reference period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=2, T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Single-year predictor data (features,) or shape (1, features).</p></li>
<li><p><strong>alpha</strong> (<em>xarray.DataArray</em>) – Spatial map of alpha values (Y, X) for LassoLars.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (output=2, Y, X) =&gt; [error, prediction].
For a true forecast scenario, the error is typically NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; [PB, PN, PA] for tercile categories.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LassoLars_Model.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LassoLars_Model.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_linear_models.</span></span><span class="sig-name descname"><span class="pre">WAS_Lasso_Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alpha_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparam_optimizer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'bayesian'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Lasso regression model for spatial rainfall prediction with support for two modes:
- per-grid-cell (pixel-wise) hyperparameter optimization
- spatially clustered optimization (recommended for most rainfall applications)</p>
<p>Lasso performs feature selection by driving less important coefficients to exactly zero,
which can be useful when working with many atmospheric/oceanic predictors.</p>
<p>Compared to Ridge, Lasso tends to need:
- smaller alpha values (less regularization)
- more iterations (coefficients can become unstable near zero)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alpha_range</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Range of alpha values to search over.
Default: np.logspace(-6, 2, 100) → reasonable for rainfall / standardized data</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>default=5</em>) – Number of spatial clusters (only used when mode=’cluster’)</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em><em>, </em><em>default=1</em>) – Number of parallel workers for grid-wise optimization</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>default='nonparam'</em>) – Clustering distance method (currently only ‘nonparam’ implemented)</p></li>
<li><p><strong>hyperparam_optimizer</strong> (<em>{'bayesian'</em><em>, </em><em>'random'</em><em>, </em><em>'lassocv'}</em><em>, </em><em>default='bayesian'</em>) – Strategy for finding optimal alpha:
- ‘bayesian’  → Optuna Bayesian optimization (usually best quality)
- ‘random’    → Randomized search (faster, decent quality)
- ‘lassocv’   → scikit-learn LassoCV (fastest, grid-based)</p></li>
<li><p><strong>n_trials</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of trials for Bayesian optimization (Optuna)</p></li>
<li><p><strong>n_iter</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of parameter settings sampled in randomized search</p></li>
<li><p><strong>mode</strong> (<em>{'cluster'</em><em>, </em><em>'grid'}</em><em>, </em><em>default='cluster'</em>) – Optimization strategy:
- ‘cluster’ → one alpha per spatial cluster (fast, stable)
- ‘grid’    → independent alpha for every grid cell (slow, very local)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Grid mode is computationally very expensive — use it only when you really need
maximum spatial detail and have sufficient computing resources.</p></li>
<li><p>Cluster mode is usually a very good compromise between performance and stability.</p></li>
<li><p>Lasso is more sensitive to data scaling than Ridge → make sure predictors
and predictand are properly standardized.</p></li>
<li><p>Requires: xarray, dask, scikit-learn, optuna (for bayesian mode)</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Compute spatially varying optimal Lasso regularization parameter alpha.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predictand</strong> (<em>xarray.DataArray</em>) – Target variable (typically rainfall amount)
Expected dimensions: (‘T’, ‘Y’, ‘X’)</p></li>
<li><p><strong>predictor</strong> (<em>xarray.DataArray</em>) – Predictor fields
Expected dimensions: (‘T’, ‘Y’, ‘X’, ‘features’) or (‘T’, ‘features’)</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the reference climatology period for standardization</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the reference climatology period for standardization</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>alpha_map</strong> (<em>xarray.DataArray</em>) – Spatial field (Y, X) containing optimal alpha value(s)
- In ‘grid’ mode: different value possible for each cell
- In ‘cluster’ mode: same value for all cells in the same cluster</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels (when mode=’cluster’)
Dummy array filled with 1s when mode=’grid’ (for compatibility)</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If unknown mode is provided</p></li>
<li><p><strong>RuntimeError</strong> – If dask parallel computation fails (grid mode)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Time series with fewer than 10 valid points are skipped (return NaN)</p></li>
<li><p>Lasso uses increased max_iter=10000 to help convergence</p></li>
<li><p>All NaN handling is automatic (masking invalid time steps)</p></li>
<li><p>Progress messages are printed during long computations</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.compute_model" title="Link to this definition"></a></dt>
<dd><p>Computes Lasso predictions for spatiotemporal data using provided alpha values.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>dims (output=2, Y, X) =&gt; [error, prediction].</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fit a Lasso model and make predictions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate a forecast for a single time (year) using Lasso with alpha,
then compute tercile probabilities from the chosen distribution method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=2, T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Single-year predictor data (features,).</p></li>
<li><p><strong>alpha</strong> (<em>xarray.DataArray</em>) – Spatial map of alpha values (Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (output=2, Y, X) =&gt; [error, prediction].
For a real forecast scenario, the error is typically NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; [PB, PN, PA].</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Lasso_Model.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Lasso_Model.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_linear_models.</span></span><span class="sig-name descname"><span class="pre">WAS_LinearRegression_Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to perform linear regression modeling on spatiotemporal datasets for climate prediction.</p>
<p>This class is designed to work with Dask and Xarray for parallelized, high-performance
regression computations across large datasets with spatial and temporal dimensions. The primary
methods are for fitting the model, making predictions, and calculating probabilistic predictions
for climate terciles.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.nb_cores">
<span class="sig-name descname"><span class="pre">nb_cores</span></span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.nb_cores" title="Link to this definition"></a></dt>
<dd><p>The number of CPU cores to use for parallel computation (default is 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.dist_method">
<span class="sig-name descname"><span class="pre">dist_method</span></span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.dist_method" title="Link to this definition"></a></dt>
<dd><p>Distribution method for tercile probability calculations. One of
{“t”,”gamma”,”normal”,”lognormal”,”nonparam”}. Default = “gamma”.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fits a linear regression model, makes predictions, and calculates error if y_test is provided.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.compute_model" title="Link to this definition"></a></dt>
<dd><p>Applies the linear regression model across a dataset using parallel computation with Dask.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Computes tercile probabilities for hindcast predictions over specified years.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates a single-year forecast and computes tercile probabilities.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id6">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id6" title="Link to this definition"></a></dt>
<dd><p>Applies linear regression across a spatiotemporal dataset in parallel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictors with dims (‘T’,’features’).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training targets with dims (‘T’,’Y’,’X’).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test predictors, shape (‘features’,) or (T, features).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test targets with dims (‘Y’,’X’), or broadcastable.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dims (‘output’,’Y’,’X’), where ‘output’=[error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id7">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#id7" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id8">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id8" title="Link to this definition"></a></dt>
<dd><p>Fits a linear regression model to the provided training data, makes predictions
on the test data, and calculates the prediction error (if y_test is provided).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>) – Training data (predictors).</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>) – Training targets.</p></li>
<li><p><strong>x_test</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_features</em><em>,</em><em>) or </em><em>(</em><em>1</em><em>, </em><em>n_features</em><em>)</em>) – Test data (predictors).</p></li>
<li><p><strong>y_test</strong> (<em>float</em><em> or </em><em>None</em>) – Test target value. If None, no error is computed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>If y_test is not None, returns [error, prediction].
If y_test is None, returns [prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id9">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id9" title="Link to this definition"></a></dt>
<dd><p>Generates a single-year forecast using linear regression, then computes
tercile probabilities using self.dist_method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dims (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year for climatology</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year for climatology</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data with dims (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=[error,prediction], T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Single-year predictor with shape (features,) or (1, features).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (output=2, Y, X) =&gt; [error, prediction].
For a true forecast, error is typically NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; [PB, PN, PA].</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_LinearRegression_Model.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_LinearRegression_Model.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_linear_models.</span></span><span class="sig-name descname"><span class="pre">WAS_Ridge_Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">alpha_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparam_optimizer</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'bayesian'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Ridge regression model for spatial rainfall prediction with support for two modes:
- per-grid-cell (pixel-wise) hyperparameter optimization
- spatially clustered optimization (faster, more robust for noisy data)</p>
<p>The class optimizes the Ridge regularization parameter (alpha) either:
* independently for each grid cell, or
* once per spatial cluster (using K-means on the predictand field)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>alpha_range</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Array of alpha values to consider when using classical RidgeCV.
Also defines the search space bounds for Bayesian/Randomized search.
Default: np.logspace(-10, 10, 100)</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>default=5</em>) – Number of spatial clusters (used only when mode=’cluster’)</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em><em>, </em><em>default=1</em>) – Number of CPU cores to use for parallel computation (grid mode)</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>default='nonparam'</em>) – Distance method used for clustering (currently only ‘nonparam’ implemented)</p></li>
<li><p><strong>hyperparam_optimizer</strong> (<em>{'bayesian'</em><em>, </em><em>'random'</em><em>, </em><em>'ridgecv'}</em><em>, </em><em>default='bayesian'</em>) – Method used for finding the best alpha:
- ‘bayesian’  → Optuna Bayesian optimization
- ‘random’    → RandomizedSearchCV
- ‘ridgecv’   → classic RidgeCV grid search</p></li>
<li><p><strong>n_trials</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of trials for Bayesian optimization (Optuna)</p></li>
<li><p><strong>n_iter</strong> (<em>int</em><em>, </em><em>default=50</em>) – Number of parameter settings sampled in RandomizedSearchCV</p></li>
<li><p><strong>mode</strong> (<em>{'cluster'</em><em>, </em><em>'grid'}</em><em>, </em><em>default='cluster'</em>) – Optimization strategy:
- ‘cluster’ → spatially cluster the field → one alpha per cluster
- ‘grid’    → independent alpha optimization for each grid cell</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Grid mode (‘grid’) is computationally expensive but gives the most local fit</p></li>
<li><p>Cluster mode (‘cluster’) is much faster and usually more stable</p></li>
<li><p>Requires xarray, dask, scikit-learn, optuna (for bayesian mode)</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Calculate tercile probabilities using best-fit distribution family.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Compute spatially varying Ridge alpha parameter(s).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predictand</strong> (<em>xarray.DataArray</em>) – Target variable (usually rainfall)
Must have dimensions: (‘T’, ‘Y’, ‘X’)</p></li>
<li><p><strong>predictor</strong> (<em>xarray.DataArray</em>) – Predictor array with dimensions: (‘T’, ‘Y’, ‘X’, ‘features’) or (‘T’, ‘features’)</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of climatological period for standardization</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of climatological period for standardization</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>alpha_map</strong> (<em>xarray.DataArray</em>) – Spatial field of optimal alpha values
- shape (Y, X) when mode=’grid’
- shape (Y, X) with constant values per cluster when mode=’cluster’</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray or None</em>) – Cluster labels (integers) when mode=’cluster’
Contains NaN where clustering was not possible
Returns dummy array filled with 1s when mode=’grid’</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If mode is neither ‘cluster’ nor ‘grid’</p></li>
<li><p><strong>RuntimeError</strong> – If dask client could not be created or computation failed (grid mode)</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>All NaN values in time series are handled (masked)</p></li>
<li><p>Minimum 10 valid time steps required per location/cluster</p></li>
<li><p>Standardization is applied to predictand using specified climatology period</p></li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.compute_model" title="Link to this definition"></a></dt>
<dd><p>Fit and predict ridge regression model for spatiotemporal data using Dask for parallel computation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data (dims: T, features).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data (dims: T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test predictor data (dims: features) or broadcastable.</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test predictand data (dims: Y, X).</p></li>
<li><p><strong>alpha</strong> (<em>xarray.DataArray</em>) – Spatial map of alpha values for each grid cell.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dims (output=2, Y, X) =&gt; [error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fit a ridge regression model and make predictions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>ndarray</em>) – Training data (shape = [n_samples, n_features]).</p></li>
<li><p><strong>y</strong> (<em>ndarray</em>) – Target values for training data (shape = [n_samples,]).</p></li>
<li><p><strong>x_test</strong> (<em>ndarray</em>) – Test data (shape = [n_features,] or [1, n_features]).</p></li>
<li><p><strong>y_test</strong> (<em>float</em>) – Target value for test data.</p></li>
<li><p><strong>alpha</strong> (<em>float</em>) – Regularization strength for Ridge regression.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>[error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates a ridge-based forecast for a single future time (year).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_linear_models.WAS_Ridge_Model.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_linear_models.WAS_Ridge_Model.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Solver for Weibull shape parameter.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_eof">
<span id="wass2s-was-eof-module"></span><h3>wass2s.was_eof module<a class="headerlink" href="#module-wass2s.was_eof" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_eof.WAS_EOF">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_eof.</span></span><span class="sig-name descname"><span class="pre">WAS_EOF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_coslat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standardize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opti_explained_variance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L2norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_eof.WAS_EOF" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class for performing Empirical Orthogonal Function (EOF) analysis using the xeofs package,
with additional options for detrending and cosine latitude weighting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_modes</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of EOF modes to retain. If None, the number of modes is determined by
explained variance.</p></li>
<li><p><strong>use_coslat</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, applies cosine latitude weighting to account for the Earth’s spherical geometry.</p></li>
<li><p><strong>standardize</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, standardizes the input data by removing the mean and dividing by the standard deviation.</p></li>
<li><p><strong>detrend</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, detrends the input data along the time dimension before performing EOF analysis.</p></li>
<li><p><strong>opti_explained_variance</strong> (<em>float</em><em>, </em><em>optional</em>) – The target cumulative explained variance (in percent) to determine the optimal number of EOF modes.</p></li>
<li><p><strong>L2norm</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, normalizes the components and scores to have L2 norm.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_eof.WAS_EOF.model">
<span class="sig-name descname"><span class="pre">model</span></span><a class="headerlink" href="#wass2s.was_eof.WAS_EOF.model" title="Link to this definition"></a></dt>
<dd><p>The EOF model fitted to the predictor data.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xeofs.models.EOF</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_eof.WAS_EOF.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_eof.WAS_EOF.fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_eof.WAS_EOF.inverse_transform">
<span class="sig-name descname"><span class="pre">inverse_transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pcs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_eof.WAS_EOF.inverse_transform" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_eof.WAS_EOF.plot_EOF">
<span class="sig-name descname"><span class="pre">plot_EOF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s_eofs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">s_expvar</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_eof.WAS_EOF.plot_EOF" title="Link to this definition"></a></dt>
<dd><p>Plot the EOF spatial patterns and their explained variance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>s_eofs</strong> (<em>xarray.DataArray</em>) – The EOF spatial patterns to plot.</p></li>
<li><p><strong>s_expvar</strong> (<em>numpy.ndarray</em>) – The explained variance for each EOF mode.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_eof.WAS_EOF.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_eof.WAS_EOF.transform" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_pcr">
<span id="wass2s-was-pcr-module"></span><h3>wass2s.was_pcr module<a class="headerlink" href="#module-wass2s.was_pcr" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_pcr.WAS_PCR">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_pcr.</span></span><span class="sig-name descname"><span class="pre">WAS_PCR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">regression_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_coslat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standardize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opti_explained_variance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">L2norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_pcr.WAS_PCR" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class for Principal Component Regression (PCR) integrating EOF analysis
with flexible regression models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>regression_model</strong> (<em>object</em>) – An instance of a WAS regression model class.</p></li>
<li><p><strong>n_modes</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of EOF modes to retain.</p></li>
<li><p><strong>use_coslat</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Apply cosine latitude weighting in EOF analysis.</p></li>
<li><p><strong>standardize</strong> (<em>bool</em><em>, </em><em>default=False</em>) – Standardize the input data.</p></li>
<li><p><strong>detrend</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Detrend the input data.</p></li>
<li><p><strong>opti_explained_variance</strong> (<em>float</em><em>, </em><em>optional</em>) – Target cumulative explained variance to determine number of EOF modes.</p></li>
<li><p><strong>L2norm</strong> (<em>bool</em><em>, </em><em>default=False</em>) – Normalize EOF components and scores to have L2 norm.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_pcr.WAS_PCR.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_pcr.WAS_PCR.compute_model" title="Link to this definition"></a></dt>
<dd><p>Fits EOF, transforms predictors, and runs the deterministic regression.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data</p></li>
<li><p><strong>y_train</strong> (<em>array-like</em><em> or </em><em>xarray.DataArray</em>) – Training target data</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test predictor data</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em>) – Additional parameters passed to the regression model’s compute_model method</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>result</strong> – Result from the regression model’s compute_model method</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>object</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_pcr.WAS_PCR.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_pcr.WAS_PCR.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Computes probabilistic forecasts using the regression model’s probability method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Target variable data</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year for climatology</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year for climatology</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Hindcast deterministic predictions</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em>) – Additional parameters for the regression model</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>result</strong> – Probabilistic forecast result or None for unsupported models</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>object or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_pcr.WAS_PCR.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_pcr.WAS_PCR.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates an operational forecast by projecting the forecast year onto EOF space.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Target variable data</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year for climatology</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year for climatology</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data for training</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Hindcast deterministic predictions</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the forecast year</p></li>
<li><p><strong>**kwargs</strong> (<em>dict</em>) – Additional parameters for the regression model</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>result</strong> – Forecast result from the regression model</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>object</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_cca">
<span id="wass2s-was-cca-module"></span><h3>wass2s.was_cca module<a class="headerlink" href="#module-wass2s.was_cca" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_cca.</span></span><span class="sig-name descname"><span class="pre">WAS_CCA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_pca_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standardize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_coslat</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_pca</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute the CCA model and generate hindcasts.</p>
<p>Parameters:
- X_train: xarray DataArray for predictor training data.
- y_train: xarray DataArray for predictand training data.
- X_test: xarray DataArray for predictor testing data.
- y_test: xarray DataArray for predictand testing data.</p>
<p>Returns:
- hindcast: xarray DataArray containing predictions and errors.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.fit_cca">
<span class="sig-name descname"><span class="pre">fit_cca</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.fit_cca" title="Link to this definition"></a></dt>
<dd><p>Fit the CCA model using the training data.</p>
<p>Parameters:
- X_train: xarray DataArray for predictor training data.
- y_train: xarray DataArray for predictand training data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.forecast" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.plot_cca_results">
<span class="sig-name descname"><span class="pre">plot_cca_results</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_modes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.plot_cca_results" title="Link to this definition"></a></dt>
<dd><p>Plots the CCA modes and scores.</p>
<p>Parameters:
- X: Optional xarray DataArray for predictors. If provided, the model will be fitted using X and Y.
- Y: Optional xarray DataArray for predictands.
- n_modes: Number of modes to plot. If None, plots all modes.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.preprocess_data">
<span class="sig-name descname"><span class="pre">preprocess_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.preprocess_data" title="Link to this definition"></a></dt>
<dd><p>Preprocess the data by detrending, masking, and filling missing values.</p>
<p>Parameters:
- X: xarray DataArray for predictors.
- Y: xarray DataArray for predictands.</p>
<p>Returns:
- X_final: Preprocessed X data.
- Y_final: Preprocessed Y data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.preprocess_test_data">
<span class="sig-name descname"><span class="pre">preprocess_test_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.preprocess_test_data" title="Link to this definition"></a></dt>
<dd><p>Preprocess the test data.</p>
<p>Parameters:
- X_test: xarray DataArray for predictor testing data.
- y_test: xarray DataArray for predictand testing data.
- X_train: xarray DataArray for predictor training data.
- y_train: xarray DataArray for predictand training data.</p>
<p>Returns:
- X_test_prepared: Preprocessed X test data.
- y_test_prepared: Preprocessed Y test data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_cca.WAS_CCA.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_cca.WAS_CCA.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_machine_learning">
<span id="wass2s-was-machine-learning-module"></span><h3>wass2s.was_machine_learning module<a class="headerlink" href="#module-wass2s.was_machine_learning" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.BaseOptimizer">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">BaseOptimizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.BaseOptimizer" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Unified Optimizer. Supports SVR (multi-grid), MLP, and Stacking architectures.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.BaseOptimizer.optimize">
<span class="sig-name descname"><span class="pre">optimize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_space</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scoring</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'neg_mean_squared_error'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.BaseOptimizer.optimize" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.MARS">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">MARS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">max_terms</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">21</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_degree</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">penalty</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_span</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.MARS" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Multivariate Adaptive Regression Splines with corrected forward/backward passes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.MARS.backward_pass">
<span class="sig-name descname"><span class="pre">backward_pass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">B</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.MARS.backward_pass" title="Link to this definition"></a></dt>
<dd><p>Backward pass to prune basis functions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.MARS.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.MARS.fit" title="Link to this definition"></a></dt>
<dd><p>Fit MARS model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.MARS.forward_pass">
<span class="sig-name descname"><span class="pre">forward_pass</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">ndarray</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.MARS.forward_pass" title="Link to this definition"></a></dt>
<dd><p>Forward pass to add basis functions.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.MARS.get_formula">
<span class="sig-name descname"><span class="pre">get_formula</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">feature_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.MARS.get_formula" title="Link to this definition"></a></dt>
<dd><p>Get human-readable formula for the model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.MARS.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">ndarray</span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.MARS.predict" title="Link to this definition"></a></dt>
<dd><p>Predict using fitted MARS model.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_LogisticRegression_Model">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_LogisticRegression_Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_grid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_scaler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="simple">
<dt>Logistic regression for tercile classification (0/1/2) with:</dt><dd><ol class="arabic simple">
<li><p>compute_class(): build tercile classes</p></li>
<li><p>clustering on a spatial statistic of predictand (default: climatological mean)</p></li>
<li><p>hyperparameter optimization per cluster (via BaseOptimizer)</p></li>
<li><p>broadcast best params to (Y,X)</p></li>
<li><p>fit/predict per grid cell using the locally broadcast params</p></li>
</ol>
</dd>
</dl>
<p>Notes:
- “Scale y only” does not apply here because y is categorical (0/1/2).
- X scaling is OFF by default, but you can enable it (x_scaler=’standard’ or ‘robust’).</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_LogisticRegression_Model.classify">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">classify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model.classify" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_LogisticRegression_Model.compute_class">
<span class="sig-name descname"><span class="pre">compute_class</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model.compute_class" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_LogisticRegression_Model.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scoring</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'neg_log_loss'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Returns broadcast hyperparameter arrays + cluster map.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_LogisticRegression_Model.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cw_code_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solver_da</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model.compute_model" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_LogisticRegression_Model.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cw_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solver</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Trains with local hyperparameters and returns proba for classes 0/1/2,
correctly mapped via <a href="#id25"><span class="problematic" id="id26">classes_</span></a> (fix vs positional padding).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_LogisticRegression_Model.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cw_code_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solver_da</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_LogisticRegression_Model.forecast" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_MARS_Model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_terms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">21</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to perform MARS-based modeling on spatiotemporal datasets for climate prediction.
MARS stands for Multivariate Adaptive Regression Splines with Generalized Cross-Validation.</p>
<p>This class is designed to work with Dask and Xarray for parallelized, high-performance
regression computations across large datasets with spatial and temporal dimensions. The primary
methods are for fitting the model, making predictions, and calculating probabilistic predictions
for climate terciles.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.nb_cores">
<span class="sig-name descname"><span class="pre">nb_cores</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.nb_cores" title="Link to this definition"></a></dt>
<dd><p>The number of CPU cores to use for parallel computation (default is 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.dist_method">
<span class="sig-name descname"><span class="pre">dist_method</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.dist_method" title="Link to this definition"></a></dt>
<dd><p>Distribution method for tercile probability calculations. One of
{“t”,”gamma”,”normal”,”lognormal”,”nonparam”}. Default = “gamma”.</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.max_terms">
<span class="sig-name descname"><span class="pre">max_terms</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.max_terms" title="Link to this definition"></a></dt>
<dd><p>Maximum number of basis functions for MARS (default: 21).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.max_degree">
<span class="sig-name descname"><span class="pre">max_degree</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.max_degree" title="Link to this definition"></a></dt>
<dd><p>Maximum degree of interaction for MARS (default: 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.c">
<span class="sig-name descname"><span class="pre">c</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.c" title="Link to this definition"></a></dt>
<dd><p>Cost parameter for effective parameters in GCV for MARS (default: 3).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fits a MARS model, makes predictions, and calculates error if y_test is provided.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.compute_model" title="Link to this definition"></a></dt>
<dd><p>Applies the MARS model across a dataset using parallel computation with Dask.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Computes tercile probabilities for hindcast predictions over specified years.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates a single-year forecast and computes tercile probabilities.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id10">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id10" title="Link to this definition"></a></dt>
<dd><p>Applies MARS regression across a spatiotemporal dataset in parallel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictors with dims (‘T’,’features’).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training targets with dims (‘T’,’Y’,’X’).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test predictors, shape (‘features’,) or (T, features).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test targets with dims (‘Y’,’X’), or broadcastable.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dims (‘output’,’Y’,’X’), where ‘output’=[error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id11">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#id11" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id12">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id12" title="Link to this definition"></a></dt>
<dd><p>Fits a MARS model to the provided training data, makes predictions
on the test data, and calculates the prediction error (if y_test is provided).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>) – Training data (predictors).</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>) – Training targets.</p></li>
<li><p><strong>x_test</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_features</em><em>,</em><em>) or </em><em>(</em><em>1</em><em>, </em><em>n_features</em><em>)</em>) – Test data (predictors).</p></li>
<li><p><strong>y_test</strong> (<em>float</em><em> or </em><em>None</em>) – Test target value. If None, no error is computed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>If y_test is not None, returns [error, prediction].
If y_test is None, returns [prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id13">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id13" title="Link to this definition"></a></dt>
<dd><p>Generates a single-year forecast using MARS, then computes
tercile probabilities using self.dist_method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dims (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year for climatology</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year for climatology</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data with dims (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=[error,prediction], T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Single-year predictor with shape (features,) or (1, features).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (output=2, Y, X) =&gt; [error, prediction].
For a true forecast, error is typically NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; [PB, PN, PA].</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MARS_Model.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MARS_Model.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_MLP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_grid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to perform MLP (Multi-Layer Perceptron) regression on spatiotemporal
datasets for climate prediction, with hyperparameter tuning via clustering + grid search.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nb_cores</strong> (<em>int</em>) – Number of CPU cores to use for parallel computation.</p></li>
<li><p><strong>dist_method</strong> (<em>str</em>) – Distribution method for tercile probability calculations.
One of {‘gamma’, ‘t’, ‘normal’, ‘lognormal’, ‘nonparam’}.</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em>) – Number of clusters to use for KMeans.</p></li>
<li><p><strong>param_grid</strong> (<em>dict</em><em> or </em><em>None</em>) – The hyperparameter search grid for MLPRegressor.
If None, a default grid is used.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">nb_cores,</span> <span class="pre">dist_method,</span> <span class="pre">n_clusters,</span> <span class="pre">param_grid</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Optimized version with Bayesian optimization.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hl_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">act_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter_array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.compute_model" title="Link to this definition"></a></dt>
<dd><p>Runs MLP fit/predict for each (Y,X) cell in parallel, using cluster-based hyperparams.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictors with dims (‘T’,’features’).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training target with dims (‘T’,’Y’,’X’).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test predictors, shape (‘features’,) or broadcastable.</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test target with dims (‘Y’,’X’).</p></li>
<li><p><strong>hl_array</strong> (<em>xarray.DataArray</em>) – Local best hyperparameters from compute_hyperparameters.</p></li>
<li><p><strong>act_array</strong> (<em>xarray.DataArray</em>) – Local best hyperparameters from compute_hyperparameters.</p></li>
<li><p><strong>lr_array</strong> (<em>xarray.DataArray</em>) – Local best hyperparameters from compute_hyperparameters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dims (‘output’, ‘Y’, ‘X’), where ‘output’ = [error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hl_sizes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_init</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxiter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Trains an MLP (with local hyperparams) on the provided training data, then predicts on X_test.
Returns [error, prediction].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>)</p></li>
<li><p><strong>y_train</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>)</p></li>
<li><p><strong>X_test</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_features</em><em>,</em><em>) or </em><em>(</em><em>1</em><em>, </em><em>n_features</em><em>)</em>)</p></li>
<li><p><strong>y_test</strong> (<em>float</em><em> or </em><em>np.nan</em>)</p></li>
<li><p><strong>hl_sizes</strong> (<em>str</em><em> (</em><em>stored as string in xarray</em><em>) or </em><em>None</em>)</p></li>
<li><p><strong>activation</strong> (<em>str</em>)</p></li>
<li><p><strong>lr_init</strong> (<em>float</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>[error, predicted_value]</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray of shape (2,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hl_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">act_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lr_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate a forecast for a single future time (e.g., future year),
then compute tercile probabilities using the chosen distribution method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dims (T, Y, X), used for computing climatological terciles.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data with dims (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=[error,prediction], T, Y, X).
Used to compute error variance or error samples.</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the forecast year, shape (features,) or (1, features).</p></li>
<li><p><strong>hl_array</strong> (<em>xarray.DataArray</em>) – Hyperparameters from <cite>compute_hyperparameters</cite>,
each with dims (Y, X) specifying local MLP settings.</p></li>
<li><p><strong>act_array</strong> (<em>xarray.DataArray</em>) – Hyperparameters from <cite>compute_hyperparameters</cite>,
each with dims (Y, X) specifying local MLP settings.</p></li>
<li><p><strong>lr_array</strong> (<em>xarray.DataArray</em>) – Hyperparameters from <cite>compute_hyperparameters</cite>,
each with dims (Y, X) specifying local MLP settings.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (‘output’,’Y’,’X’), containing [error, prediction].
For a forecast, the “error” is generally NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; PB, PN, PA tercile probabilities.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_MLP.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_MLP.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_PoissonRegression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to perform Poisson Regression on spatiotemporal datasets for count data prediction.</p>
<p>This class is designed to work with Dask and Xarray for parallelized, high-performance
regression computations across large datasets with spatial and temporal dimensions. The primary
methods are for fitting the Poisson regression model, making predictions, and calculating
probabilistic predictions for climate terciles.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.nb_cores">
<span class="sig-name descname"><span class="pre">nb_cores</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.nb_cores" title="Link to this definition"></a></dt>
<dd><p>The number of CPU cores to use for parallel computation (default is 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.dist_method">
<span class="sig-name descname"><span class="pre">dist_method</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.dist_method" title="Link to this definition"></a></dt>
<dd><p>The method to use for tercile probability calculations, e.g. {“t”, “gamma”, “normal”,
“lognormal”, “nonparam”} (default is “gamma”).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fits a Poisson regression model to the training data, predicts on test data, and computes error.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.compute_model" title="Link to this definition"></a></dt>
<dd><p>Applies the Poisson regression model across a dataset using parallel computation
with Dask, returning predictions and error metrics.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Computes tercile probabilities for hindcast rainfall (or count data) predictions
over specified climatological years, using the chosen <cite>dist_method</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id14">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id14" title="Link to this definition"></a></dt>
<dd><p>Computes predictions for spatiotemporal data using Poisson Regression with parallel processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Predictor data with dimensions (T, features).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training target values (count data) with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test data (predictors) with shape (features,) or (T, features), typically squeezed.</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test target values (count data) with dimensions (Y, X) or broadcastable to (T, Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An array with a new dimension (‘output’, size=2) capturing [error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id15">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#id15" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id16">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id16" title="Link to this definition"></a></dt>
<dd><p>Fits a Poisson regression model to the provided training data, makes predictions
on the test data, and calculates the prediction error.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>) – Training data (predictors).</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>) – Training targets (non-negative count data).</p></li>
<li><p><strong>x_test</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_features</em><em>,</em><em>) or </em><em>(</em><em>1</em><em>, </em><em>n_features</em><em>)</em>) – Test data (predictors).</p></li>
<li><p><strong>y_test</strong> (<em>float</em>) – Test target value (actual counts).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>[prediction_error, predicted_value]</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray of shape (2,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate forecasts for a single time (e.g., future year) and compute
tercile probabilities based on the chosen distribution method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Target variable with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of climatology period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data with dimensions (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast array that includes ‘error’ and ‘prediction’ over the historical period.</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the forecast year, shape (features,) or (1, features).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a href="#id27"><span class="problematic" id="id28">result_</span></a>  : xarray.DataArray or numpy array with the forecast’s [error, prediction].
hindcast_prob : xarray.DataArray of shape (probability=3, Y, X) with PB, PN, and PA.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple (<a href="#id29"><span class="problematic" id="id30">result_</span></a>, hindcast_prob)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PoissonRegression.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PoissonRegression.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_PolynomialRegression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class to perform Polynomial Regression on spatiotemporal datasets for climate prediction.</p>
<p>This class is designed to work with Dask and Xarray for parallelized, high-performance
regression computations across large datasets with spatial and temporal dimensions. The primary
methods are for fitting the polynomial regression model, making predictions, and calculating
probabilistic predictions for climate terciles.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.nb_cores">
<span class="sig-name descname"><span class="pre">nb_cores</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.nb_cores" title="Link to this definition"></a></dt>
<dd><p>The number of CPU cores to use for parallel computation (default is 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.degree">
<span class="sig-name descname"><span class="pre">degree</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.degree" title="Link to this definition"></a></dt>
<dd><p>The degree of the polynomial (default is 2).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.dist_method">
<span class="sig-name descname"><span class="pre">dist_method</span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.dist_method" title="Link to this definition"></a></dt>
<dd><p>The distribution method to compute tercile probabilities. One of
{“t”, “gamma”, “normal”, “lognormal”, “nonparam”} (default is “gamma”).</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fits a Polynomial Regression model to the training data, predicts on test data,
and computes error.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.compute_model" title="Link to this definition"></a></dt>
<dd><p>Applies the Polynomial Regression model across a dataset using parallel computation
with Dask, returning predictions and error metrics.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Computes tercile probabilities for hindcast rainfall predictions
over specified climatological years.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates a forecast for a single year (or time step) and calculates tercile probabilities
using the chosen distribution method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id17">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id17" title="Link to this definition"></a></dt>
<dd><p>Computes predictions for spatiotemporal data using Polynomial Regression with parallel processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training data (predictors) with dimensions (T, features).
(It must be chunked properly in Dask, or at least be amenable to chunking.)</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training target values with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test data (predictors) with dimensions (features,) or (T, features).
Typically, you’d match time steps or have a single test.</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test target values with dimensions (Y, X) or broadcastable to (T, Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>An array with shape (2, Y, X) after computing, where the first index
is error and the second is the prediction.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id18">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#id18" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id19">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id19" title="Link to this definition"></a></dt>
<dd><blockquote>
<div><p>Fits a Polynomial Regression model to the provided training data, makes predictions
on the test data, and calculates the prediction error.</p>
</div></blockquote>
<dl>
<dt>.</dt><dd><dl class="simple">
<dt>x<span class="classifier">array-like, shape (n_samples, n_features)</span></dt><dd><p>Training data (predictors).</p>
</dd>
<dt>y<span class="classifier">array-like, shape (n_samples,)</span></dt><dd><p>Training targets.</p>
</dd>
<dt>x_test<span class="classifier">array-like, shape (n_features,) or (1, n_features)</span></dt><dd><p>Test data (predictors) for which we want predictions.</p>
</dd>
<dt>y_test<span class="classifier">float</span></dt><dd><p>Test target value (for computing error).</p>
</dd>
</dl>
<dl class="simple">
<dt>np.ndarray of shape (2,)</dt><dd><p>Array containing [prediction_error, predicted_value].</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="id20">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id20" title="Link to this definition"></a></dt>
<dd><p>Generate forecasts for a single time (e.g., future year) and compute
tercile probabilities based on the chosen distribution method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Target variable with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of climatology period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data with dimensions (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast array that includes ‘error’ and ‘prediction’ over the historical period.</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the forecast year, shape (features,) or (1, features).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a href="#id31"><span class="problematic" id="id32">result_</span></a>  : xarray.DataArray or numpy array with the forecast’s [error, prediction].
hindcast_prob : xarray.DataArray of shape (probability=3, Y, X) with PB, PN, and PA.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple (<a href="#id33"><span class="problematic" id="id34">result_</span></a>, hindcast_prob)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_PolynomialRegression.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_PolynomialRegression.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_RandomForest_XGBoost_ML_Stacking</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_grid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Optimized version with Bayesian optimization.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_param_da</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.compute_model" title="Link to this definition"></a></dt>
<dd><p>Parallel fit/predict across the entire spatial domain, using cluster-based hyperparams.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training data (predictors) with dims (‘T’,’features’).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training target with dims (‘T’,’Y’,’X’).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test data (predictors), shape (features,) or broadcastable across (Y, X).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test target with dims (‘Y’,’X’).</p></li>
<li><p><strong>best_param_da</strong> (<em>xarray.DataArray</em>) – The per-grid best_params from compute_hyperparameters (as strings).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>dims (‘output’,’Y’,’X’), where ‘output’ = [error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params_str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fit a local StackingRegressor with the best hyperparams (parsed from best_params_str),
then predict on X_test, returning [error, prediction].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>)</p></li>
<li><p><strong>y_train</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>)</p></li>
<li><p><strong>X_test</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_features</em><em>,</em><em>) or </em><em>(</em><em>1</em><em>, </em><em>n_features</em><em>)</em>)</p></li>
<li><p><strong>y_test</strong> (<em>float</em><em> or </em><em>np.nan</em>)</p></li>
<li><p><strong>best_params_str</strong> (<em>str</em>) – String of best_params (e.g. “{‘estimators__rf__n_estimators’:100, …}”)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>[error, predicted_value]</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray of shape (2,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_param_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate a forecast for a single time (e.g., future year), then compute
tercile probabilities from the chosen distribution method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dims (T, Y, X), used for climatological terciles.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data, dims (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast, dims (output=[error,prediction], T, Y, X).
Used to compute error variance or error samples.</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the forecast year, shape (features,) or (1, features).</p></li>
<li><p><strong>best_param_da</strong> (<em>xarray.DataArray</em>) – Grid-based hyperparameters from compute_hyperparameters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (‘output’,’Y’,’X’) =&gt; [error, prediction].
For a forecast, the ‘error’ will generally be NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; tercile probabilities PB, PN, PA.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_ML_Stacking.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_RandomForest_XGBoost_Stacking_MLP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_grid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_param_da</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.compute_model" title="Link to this definition"></a></dt>
<dd><p>Parallel training + prediction across the entire spatial domain,
referencing local best_params for each grid cell.</p>
<p>Returns an xarray.DataArray with dim ‘output’ = [error, prediction].</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params_str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.fit_predict" title="Link to this definition"></a></dt>
<dd><p>For a single grid cell, parse the local best_params dict, set them on the
StackingRegressor (with RF + XGB base, MLP meta), train and predict.</p>
<p>Returns [error, prediction].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>)</p></li>
<li><p><strong>y_train</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>)</p></li>
<li><p><strong>X_test</strong> (<em>np.ndarray</em><em>, </em><em>shape</em><em> (</em><em>n_features</em><em>,</em><em>) or </em><em>(</em><em>1</em><em>, </em><em>n_features</em><em>)</em>)</p></li>
<li><p><strong>y_test</strong> (<em>float</em><em> or </em><em>np.nan</em>)</p></li>
<li><p><strong>best_params_str</strong> (<em>str</em>) – Local best hyperparams as a stringified dict.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>[error, prediction]</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray of shape (2,)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_param_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate a forecast for a single future time (e.g., future year),
then compute tercile probabilities from the chosen distribution method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dims (T, Y, X) used for computing climatological terciles.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data, shape (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=[error,prediction], T, Y, X).
Used to estimate error variance or error samples.</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the forecast year, shape (features,) or (1, features).</p></li>
<li><p><strong>best_param_da</strong> (<em>xarray.DataArray</em>) – Grid-based best hyperparams from <cite>compute_hyperparameters</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (‘output’,’Y’,’X’) =&gt; [error, prediction].
For a true forecast, the ‘error’ is typically NaN.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; PB, PN, PA tercile probabilities.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_RandomForest_XGBoost_Stacking_MLP.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_SVR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.1,</span> <span class="pre">1,</span> <span class="pre">10,</span> <span class="pre">100]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.01,</span> <span class="pre">0.1,</span> <span class="pre">0.5,</span> <span class="pre">1]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2,</span> <span class="pre">3,</span> <span class="pre">4]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree_array</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.compute_model" title="Link to this definition"></a></dt>
<dd><p>Computes predictions for spatiotemporal data using SVR with parallel processing via Dask.</p>
<p>We break the data into chunks, apply the <cite>fit_predict</cite> function in parallel,
and combine the results into an output DataArray.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictors with dimensions (‘T’, ‘features’).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training targets with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Test predictors with dimensions (‘features’,).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Test target values with dimensions (‘Y’, ‘X’).</p></li>
<li><p><strong>epsilon</strong> (<em>xarray.DataArray</em>) – Epsilon hyperparameters per grid point.</p></li>
<li><p><strong>C</strong> (<em>xarray.DataArray</em>) – C hyperparameters per grid point.</p></li>
<li><p><strong>degree_array</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Polynomial degrees per grid point (only used if kernel=’poly’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Predictions &amp; errors, stacked along a new ‘output’ dimension (size=2).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.fit_predict" title="Link to this definition"></a></dt>
<dd><p>Fits an SVR model to the provided training data, makes predictions on the test data,
and calculates the prediction error.</p>
<p>We handle data-type issues (e.g., bytes input), set up the SVR with the requested
parameters, fit it, and return both the error and the prediction.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>) – Training predictors.</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>) – Training targets.</p></li>
<li><p><strong>x_test</strong> (<em>array-like</em><em>, </em><em>shape</em><em> (</em><em>n_features</em><em>,</em><em>)</em>) – Test predictors.</p></li>
<li><p><strong>y_test</strong> (<em>float</em><em> or </em><em>None</em>) – Test target value. Used to calculate error if available.</p></li>
<li><p><strong>epsilon</strong> (<em>float</em>) – Epsilon parameter for SVR (defines epsilon-tube).</p></li>
<li><p><strong>C</strong> (<em>float</em>) – Regularization parameter for SVR.</p></li>
<li><p><strong>degree</strong> (<em>int</em><em>, </em><em>optional</em>) – Degree for ‘poly’ kernel. Ignored if kernel != ‘poly’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A 2-element array containing [error, prediction].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">degree_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gamma_array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.forecast" title="Link to this definition"></a></dt>
<dd><p>Generates forecasts and computes probabilities for a specific year.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Target variable (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year for climatology.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year for climatology.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcasts (includes ‘prediction’ and ‘error’ outputs).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the target forecast year (features).</p></li>
<li><p><strong>epsilon</strong> (<em>xarray.DataArray</em>) – Hyperparameter grids for the model.</p></li>
<li><p><strong>C</strong> (<em>xarray.DataArray</em>) – Hyperparameter grids for the model.</p></li>
<li><p><strong>kernel_array</strong> (<em>xarray.DataArray</em>) – Hyperparameter grids for the model.</p></li>
<li><p><strong>degree_array</strong> (<em>xarray.DataArray</em>) – Hyperparameter grids for the model.</p></li>
<li><p><strong>gamma_array</strong> (<em>xarray.DataArray</em>) – Hyperparameter grids for the model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ol class="arabic simple">
<li><p>The forecast results (error, prediction) for that year.</p></li>
<li><p>The corresponding tercile probabilities (PB, PN, PA).</p></li>
</ol>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_SVR.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_SVR.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_machine_learning.</span></span><span class="sig-name descname"><span class="pre">WAS_Stacking_Ridge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_grid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Optimized version with Bayesian optimization.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_param_da</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.compute_model" title="Link to this definition"></a></dt>
<dd><p>Parallel training + prediction across all spatial grid points.
Uses local best hyperparams from best_param_da for each pixel.</p>
<p>Returns an xarray.DataArray with dim (‘output’,’Y’,’X’) =&gt; [error, prediction].</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.fit_predict">
<span class="sig-name descname"><span class="pre">fit_predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params_str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.fit_predict" title="Link to this definition"></a></dt>
<dd><p>For a single grid cell, parse the best params, instantiate the stacking regressor,
fit to local data, and predict.</p>
<p>Returns [error, prediction].</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_param_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.forecast" title="Link to this definition"></a></dt>
<dd><p>Forecast for a single future year (or time) and compute tercile probabilities.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dims (T, Y, X), used for computing climatology thresholds.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start of climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End of climatology period.</p></li>
<li><p><strong>Predictor</strong> (<em>xarray.DataArray</em>) – Historical predictor data, shape (T, features).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Historical deterministic forecast with dims (output=[error,prediction], T, Y, X)
for computing error variance or samples.</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the forecast year, shape (features,) or (1, features).</p></li>
<li><p><strong>best_param_da</strong> (<em>xarray.DataArray</em>) – Local best hyperparams from compute_hyperparameters, shape (Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – dims (output=2, Y, X) =&gt; [error, prediction].
In a real forecast, “error” is typically NaN since we have no future observation.</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – dims (probability=3, Y, X) =&gt; [PB, PN, PA].</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_machine_learning.WAS_Stacking_Ridge.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_machine_learning.WAS_Stacking_Ridge.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_analog">
<span id="wass2s-was-analog-module"></span><h3>wass2s.was_analog module<a class="headerlink" href="#module-wass2s.was_analog" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_analog.</span></span><span class="sig-name descname"><span class="pre">WAS_Analog</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor_vars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[{'area':</span> <span class="pre">[60,</span> <span class="pre">-180,</span> <span class="pre">-60,</span> <span class="pre">180],</span> <span class="pre">'model_name':</span> <span class="pre">'NCEP_2',</span> <span class="pre">'reanalysis_name':</span> <span class="pre">'NOAA',</span> <span class="pre">'variable':</span> <span class="pre">'SST'},</span> <span class="pre">{'area':</span> <span class="pre">[60,</span> <span class="pre">-180,</span> <span class="pre">-60,</span> <span class="pre">180],</span> <span class="pre">'model_name':</span> <span class="pre">'NCEP_2',</span> <span class="pre">'reanalysis_name':</span> <span class="pre">'ERA5',</span> <span class="pre">'variable':</span> <span class="pre">'SP'},</span> <span class="pre">{'area':</span> <span class="pre">[60,</span> <span class="pre">-180,</span> <span class="pre">-60,</span> <span class="pre">180],</span> <span class="pre">'model_name':</span> <span class="pre">'NCEP_2',</span> <span class="pre">'reanalysis_name':</span> <span class="pre">'ERA5',</span> <span class="pre">'variable':</span> <span class="pre">'VGRD_850'}]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method_analog</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'som'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'mean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rolling</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standardize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detrend</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multivariateEOF</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eof_explained_var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_compute</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">some_grid_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(None,</span> <span class="pre">None)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">some_learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">some_neighborhood_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gaussian'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">some_sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">some_num_iteration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gamma'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">affinity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'euclidean'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linkage</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ward'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Analog-based forecasting toolkit for seasonal climate applications.</p>
<p>This class orchestrates the end-to-end workflow required to build analog ensembles
for Sea-Surface Temperature (SST) predictors and to translate them into deterministic
and probabilistic rainfall forecasts over West Africa or any user-defined domain.
Supports five analog-selection strategies: Self-Organizing Maps (SOM),
correlation ranking, Principal-Component (EOF) similarity, K-Means clustering,
and Agglomerative clustering.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory path to save downloaded and processed data files.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Starting year for historical data.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em>) – Target forecast year.</p></li>
<li><p><strong>predictor_vars</strong> (<em>list</em><em> of </em><em>dict</em><em>, </em><em>optional</em>) – List of dictionaries specifying predictor variables, each containing
‘reanalysis_name’, ‘model_name’, ‘variable’, and ‘area’.
Default is a list with NOAA SST and ERA5 SP, VGRD_850 variables.</p></li>
<li><p><strong>method_analog</strong> (<em>str</em><em>, </em><em>optional</em>) – Analog method to use (“som”, “cor_based”, “bias_based, “pca_based”, “kmeans_based”, “agglomerative_based”). Default is “som”.</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em><em>, </em><em>optional</em>) – Month of initialization for forecasts (1-12). If None, uses previous month.</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em>, </em><em>optional</em>) – List of lead times in months. If None, defaults to [1, 2, 3, 4, 5].</p></li>
<li><p><strong>ensemble_mean</strong> (<em>str</em><em>, </em><em>optional</em>) – Method for ensemble mean (“mean” or “median”). Default is “mean”.</p></li>
<li><p><strong>rolling</strong> (<em>int</em><em>, </em><em>optional</em>) – Window size for rolling mean. Default is 3.</p></li>
<li><p><strong>standardize</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, standardize data; otherwise, compute anomalies. Default is True.</p></li>
<li><p><strong>multivariateEOF</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use multivariate EOF analysis. Default is False.</p></li>
<li><p><strong>eof_explained_var</strong> (<em>float</em><em>, </em><em>optional</em>) – Fraction of variance to explain with EOF modes. Default is 0.95.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year for climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year for climatology period.</p></li>
<li><p><strong>index_compute</strong> (<em>list</em><em>, </em><em>optional</em>) – List of climate indices to compute (e.g., [‘NINO34’, ‘DMI’]).</p></li>
<li><p><strong>some_grid_size</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Grid size for SOM (rows, columns). Default is (None, None) for automatic sizing.</p></li>
<li><p><strong>some_learning_rate</strong> (<em>float</em><em>, </em><em>optional</em>) – Learning rate for SOM training. Default is 0.5.</p></li>
<li><p><strong>radius</strong> (<em>float</em><em>, </em><em>optional</em>) – Neighborhood radius for SOM analog search. Default is 1.0.</p></li>
<li><p><strong>some_neighborhood_function</strong> (<em>str</em><em>, </em><em>optional</em>) – Neighborhood function for SOM (“gaussian”, “mexican_hat”). Default is “gaussian”.</p></li>
<li><p><strong>some_sigma</strong> (<em>float</em><em>, </em><em>optional</em>) – Initial neighborhood radius for SOM. Default is 1.0.</p></li>
<li><p><strong>some_num_iteration</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for SOM training. Default is 2000.</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Method for probability calculation (“gamma”, “t”, “normal”, “lognormal”, “nonparam”).
Default is “gamma”.</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of clusters for K-Means and Agglomerative clustering. Default is 4.</p></li>
<li><p><strong>affinity</strong> (<em>str</em><em>, </em><em>optional</em>) – Distance metric for Agglomerative clustering (e.g., ‘euclidean’, ‘manhattan’). Default is ‘euclidean’.</p></li>
<li><p><strong>linkage</strong> (<em>str</em><em>, </em><em>optional</em>) – Linkage criterion for Agglomerative clustering (e.g., ‘ward’, ‘complete’, ‘average’). Default is ‘ward’.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Performance Considerations: For large datasets (e.g., many years or high-dimensional data), the AgglomerativeClustering method (<cite>agglomerative_based</cite>) may be significantly slower than K-Means (<cite>kmeans_based</cite>) or SOM (<cite>som</cite>) due to its computational complexity. Users should consider testing with smaller datasets or reducing the number of clusters when using AgglomerativeClustering.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.Agglomerative_Based">
<span class="sig-name descname"><span class="pre">Agglomerative_Based</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ireference_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.Agglomerative_Based" title="Link to this definition"></a></dt>
<dd><p>Identify similar years using Agglomerative Clustering.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.Bias_Based">
<span class="sig-name descname"><span class="pre">Bias_Based</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ireference_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.Bias_Based" title="Link to this definition"></a></dt>
<dd><p>Identify similar years using bias-based analog method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.Corr_Based">
<span class="sig-name descname"><span class="pre">Corr_Based</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ireference_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.Corr_Based" title="Link to this definition"></a></dt>
<dd><p>Identify similar years using correlation-based analog method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.KMeans_Based">
<span class="sig-name descname"><span class="pre">KMeans_Based</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ireference_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.KMeans_Based" title="Link to this definition"></a></dt>
<dd><p>Identify similar years using K-Means clustering.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.Pca_Based">
<span class="sig-name descname"><span class="pre">Pca_Based</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ireference_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.Pca_Based" title="Link to this definition"></a></dt>
<dd><p>Identify similar years using PCA-based analog method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.SOM">
<span class="sig-name descname"><span class="pre">SOM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ireference_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.SOM" title="Link to this definition"></a></dt>
<dd><p>Identify similar years using Self-Organizing Maps (SOM).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.anomaly_timeseries">
<span class="sig-name descname"><span class="pre">anomaly_timeseries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.anomaly_timeseries" title="Link to this definition"></a></dt>
<dd><p>Compute anomalies by removing the climatological mean.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.arrange_indices_for_som">
<span class="sig-name descname"><span class="pre">arrange_indices_for_som</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.arrange_indices_for_som" title="Link to this definition"></a></dt>
<dd><p>Arrange climate indices for SOM training.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.calc_index">
<span class="sig-name descname"><span class="pre">calc_index</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sst</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.calc_index" title="Link to this definition"></a></dt>
<dd><p>Calculate climate indices from SST data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.composite_plot">
<span class="sig-name descname"><span class="pre">composite_plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot_predictor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'SST'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.composite_plot" title="Link to this definition"></a></dt>
<dd><p>Create composite plots of predictors or predictands.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.compute_eofs">
<span class="sig-name descname"><span class="pre">compute_eofs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.compute_eofs" title="Link to this definition"></a></dt>
<dd><p>Compute EOFs and retain modes explaining at least the specified variance.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itrain</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">itest</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the specified analog method.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.download_and_process">
<span class="sig-name descname"><span class="pre">download_and_process</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.download_and_process" title="Link to this definition"></a></dt>
<dd><p>Download and process reanalysis and forecast data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.download_models">
<span class="sig-name descname"><span class="pre">download_models</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.download_models" title="Link to this definition"></a></dt>
<dd><p>Download and process seasonal forecast and hindcast data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.download_reanalysis">
<span class="sig-name descname"><span class="pre">download_reanalysis</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.download_reanalysis" title="Link to this definition"></a></dt>
<dd><p>Download reanalysis data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate deterministic and probabilistic forecasts for the target year.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.identify_analogs_bmu">
<span class="sig-name descname"><span class="pre">identify_analogs_bmu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bmu_dict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.identify_analogs_bmu" title="Link to this definition"></a></dt>
<dd><p>Identify analog years based on SOM Best Matching Units (BMUs).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.standardize_timeseries">
<span class="sig-name descname"><span class="pre">standardize_timeseries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.standardize_timeseries" title="Link to this definition"></a></dt>
<dd><p>Standardize the dataset by removing climatological mean and scaling by standard deviation.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_analog.WAS_Analog.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_analog.WAS_Analog.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_verification">
<span id="wass2s-was-verification-module"></span><h3>wass2s.was_verification module<a class="headerlink" href="#module-wass2s.was_verification" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_verification.</span></span><span class="sig-name descname"><span class="pre">WAS_Verification</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gamma'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Verification class for evaluating weather and climate forecasts.</p>
<p>Provides methods to compute deterministic, probabilistic, and ensemble-based metrics,
as well as visualization tools for model performance assessment.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probability calculations
(‘t’, ‘gamma’, ‘nonparam’, ‘normal’, ‘lognormal’, ‘weibull_min’). Default is ‘gamma’.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.brier_score">
<span class="sig-name descname"><span class="pre">brier_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PA'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.brier_score" title="Link to this definition"></a></dt>
<dd><p>BS for a single tercile event (PB/PN/PA). y_probs has shape (3, N).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.brier_skill_score">
<span class="sig-name descname"><span class="pre">brier_skill_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PA'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'uniform'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.brier_skill_score" title="Link to this definition"></a></dt>
<dd><p>Event-wise Brier Skill Score (BSS) for tercile forecasts.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>1D array-like</em>) – Observed values (time series for one grid point).</p></li>
<li><p><strong>y_probs</strong> (<em>2D array-like</em><em>, </em><em>shape</em><em> (</em><em>3</em><em>, </em><em>N</em><em>)</em>) – Forecast probabilities for PB/PN/PA over time.</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Indices delimiting the calibration slice inside the <em>masked</em> series.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – Indices delimiting the calibration slice inside the <em>masked</em> series.</p></li>
<li><p><strong>event</strong> (<em>{&quot;PB&quot;</em><em>,</em><em>&quot;PN&quot;</em><em>,</em><em>&quot;PA&quot;</em><em>,</em><em>0</em><em>,</em><em>1</em><em>,</em><em>2}</em><em>, </em><em>optional</em>) – Event to score (default “PA” = above-normal).</p></li>
<li><p><strong>reference</strong> (<em>{&quot;uniform&quot;</em><em>,</em><em>&quot;empirical&quot;}</em><em>, </em><em>optional</em>) – <ul>
<li><p>“uniform”: climatology is [1/3,1/3,1/3]</p></li>
<li><p>”empirical”: base rate computed from calibration slice</p></li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>BSS = 1 - BS / BS_ref (np.nan if not computable).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_groc">
<span class="sig-name descname"><span class="pre">calculate_groc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_classes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_groc" title="Link to this definition"></a></dt>
<dd><p>Compute Generalized Discrimination (GROC) score according to Weigel and Mason (2011).</p>
<p>The GROC score averages the Area Under the ROC Curve (AUC) for each category,
measuring the ability to distinguish occurrences from non-occurrences of each category.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period for computing terciles.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period for computing terciles.</p></li>
<li><p><strong>n_classes</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of classes (default is 3 for terciles).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>float</em> – GROC score, ranging from 0 to 1.
Returns np.nan if insufficient valid data.</p></li>
<li><p><em>Reference</em></p></li>
<li><p><em>———</em></p></li>
<li><p><em>Weigel, A. P. and Mason, S. J. (2011).</em></p></li>
<li><p><em>The generalized discrimination score for ensemble forecasts.</em></p></li>
<li><p><strong>Monthly Weather Review, 139(9)</strong> (<em>3069-3074.</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_groc_">
<span class="sig-name descname"><span class="pre">calculate_groc_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_classes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_groc_" title="Link to this definition"></a></dt>
<dd><p>Compute Generalized Discrimination (GROC) score.</p>
<p>Averages the Area Under the Curve (AUC) for each tercile category.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
<li><p><strong>n_classes</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of classes (default is 3 for terciles).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>GROC score, ranging from 0 to 1. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_groc_fixed">
<span class="sig-name descname"><span class="pre">calculate_groc_fixed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_classes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_groc_fixed" title="Link to this definition"></a></dt>
<dd><p>Fixed from version <a href="#id35"><span class="problematic" id="id36">calculate_groc_</span></a> of GROC calculation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
<li><p><strong>n_classes</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of classes (default is 3 for terciles).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>GROC score, ranging from 0 to 1.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_groc_weighted">
<span class="sig-name descname"><span class="pre">calculate_groc_weighted</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_classes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_groc_weighted" title="Link to this definition"></a></dt>
<dd><p>Compute Generalized Discrimination (GROC) score with category weighting.</p>
<p>Weighted average of AUCs by climatological frequency of each category.
Alternative: Weighted by climatological frequency as in some applications
:param y_true: Observed values.
:type y_true: array-like
:param y_probs: Forecast probabilities with shape (n_classes, n_samples).
:type y_probs: array-like
:param index_start: Start index of the climatology period.
:type index_start: int
:param index_end: End index of the climatology period.
:type index_end: int
:param n_classes: Number of classes (default is 3 for terciles).
:type n_classes: int, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Weighted GROC score, ranging from 0 to 1.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_rpss">
<span class="sig-name descname"><span class="pre">calculate_rpss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_rpss" title="Link to this definition"></a></dt>
<dd><p>Compute Ranked Probability Skill Score (RPSS).</p>
<p>Compares the Ranked Probability Score (RPS) of the forecast to a climatological reference.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>RPSS score, ranging from -Inf to 1. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_rpss_">
<span class="sig-name descname"><span class="pre">calculate_rpss_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_rpss_" title="Link to this definition"></a></dt>
<dd><p>Compute Ranked Probability Skill Score (RPSS) for a single grid point or sample.</p>
<p>Compares the Ranked Probability Score (RPS) of the forecast to a climatological
reference with uniform probabilities (1/3 for each tercile).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em><em> of </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em>) – True class labels, already classified into terciles (0: below-normal, 1: near-normal, 2: above-normal).</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em><em> of </em><em>shape</em><em> (</em><em>3</em><em>, </em><em>n_samples</em><em>)</em>) – Forecast probabilities for each tercile category.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>RPSS score, ranging from -Inf to 1 (1 indicates perfect forecast skill).
Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.classify">
<span class="sig-name descname"><span class="pre">classify</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.classify" title="Link to this definition"></a></dt>
<dd><p>Classify data into terciles based on climatological thresholds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>array-like</em>) – Input data to classify.</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><dl class="simple">
<dt>y_class<span class="classifier">array-like</span></dt><dd><p>Classified data (0: below-normal, 1: near-normal, 2: above-normal).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tercile_33<span class="classifier">float</span></dt><dd><p>33rd percentile threshold.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>tercile_67<span class="classifier">float</span></dt><dd><p>67th percentile threshold.</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.classify_data_into_terciles">
<span class="sig-name descname"><span class="pre">classify_data_into_terciles</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.classify_data_into_terciles" title="Link to this definition"></a></dt>
<dd><p>Classify data into terciles based on given thresholds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>array-like</em>) – Input data to classify.</p></li>
<li><p><strong>T1</strong> (<em>float</em>) – First tercile threshold (33rd percentile).</p></li>
<li><p><strong>T2</strong> (<em>float</em>) – Second tercile threshold (67th percentile).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Classified data (0: below-normal, 1: near-normal, 2: above-normal).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>array-like</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.classify_percent">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">classify_percent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.classify_percent" title="Link to this definition"></a></dt>
<dd><p>Classify a percentage value into predefined categories based on thresholds.</p>
<p>Maps a percentage ratio to one of five categories representing deviation from average.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>p</strong> (<em>float</em><em> or </em><em>array-like</em>) – Percentage value(s) to classify, typically representing a ratio to normal (%).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Category code:
- 1: Well Above Average (&gt;= 150%)
- 2: Above Average (&gt;= 110%)
- 3: Near Average (&gt;= 90%)
- 4: Below Average (&gt;= 50%)
- 5: Well Below Average (&lt; 50%)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>int or array-like</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.compute_class">
<span class="sig-name descname"><span class="pre">compute_class</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.compute_class" title="Link to this definition"></a></dt>
<dd><p>Compute tercile class labels for observed data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Classified data with dimensions (T, Y, X), where values are
0 (below-normal), 1 (near-normal), or 2 (above-normal).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.compute_crps">
<span class="sig-name descname"><span class="pre">compute_crps</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'number'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'T'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.compute_crps" title="Link to this definition"></a></dt>
<dd><p>Compute Continuous Ranked Probability Score (CRPS) for ensemble forecasts.</p>
<p>Measures the difference between the forecast ensemble distribution and observations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X).</p></li>
<li><p><strong>y_pred</strong> (<em>xarray.DataArray</em>) – Ensemble forecast data with dimensions (T, number, Y, X).</p></li>
<li><p><strong>member_dim</strong> (<em>str</em><em>, </em><em>optional</em>) – Dimension name for ensemble members. Default is ‘number’.</p></li>
<li><p><strong>dim</strong> (<em>str</em><em>, </em><em>optional</em>) – Dimension to compute CRPS over (typically time). Default is ‘T’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>CRPS values with dimensions (Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.compute_deterministic_score">
<span class="sig-name descname"><span class="pre">compute_deterministic_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.compute_deterministic_score" title="Link to this definition"></a></dt>
<dd><p>Apply a deterministic scoring function over xarray DataArrays.</p>
<p>Computes the specified metric across the time dimension for each grid point.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>score_func</strong> (<em>callable</em>) – Scoring function to apply (e.g., pearson_corr, kling_gupta_efficiency).</p></li>
<li><p><strong>obs</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X).</p></li>
<li><p><strong>pred</strong> (<em>xarray.DataArray</em>) – Predicted data with dimensions (T, Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Score values with dimensions (Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.compute_one_year_rpss">
<span class="sig-name descname"><span class="pre">compute_one_year_rpss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prob_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.compute_one_year_rpss" title="Link to this definition"></a></dt>
<dd><p>Compute and visualize the Ranked Probability Skill Score (RPSS) for a specific year.</p>
<p>Applies the RPSS calculation across a gridded dataset for a single year, using
tercile classifications based on a climatology period, and plots the results on a map.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X), where T is time, Y is latitude, and X is longitude.</p></li>
<li><p><strong>prob_pred</strong> (<em>xarray.DataArray</em>) – Forecast probabilities with dimensions (probability, T, Y, X), where probability includes
[‘PB’, ‘PN’, ‘PA’] (below-normal, near-normal, above-normal).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period for tercile classification.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period for tercile classification.</p></li>
<li><p><strong>year</strong> (<em>int</em><em> or </em><em>str</em>) – Specific year to compute the RPSS for.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Displays a geographical plot of the RPSS values with a colorbar.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.compute_probabilistic_score">
<span class="sig-name descname"><span class="pre">compute_probabilistic_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score_func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prob_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">score_kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.compute_probabilistic_score" title="Link to this definition"></a></dt>
<dd><p>Apply a probabilistic scoring function over xarray DataArrays.</p>
<p>Computes the specified probabilistic metric across the time dimension for each grid point.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>score_func</strong> (<em>callable</em>) – Probabilistic scoring function to apply (e.g., calculate_rpss, calculate_groc).</p></li>
<li><p><strong>obs</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X).</p></li>
<li><p><strong>prob_pred</strong> (<em>xarray.DataArray</em>) – Forecast probabilities with dimensions (probability, T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Score values with dimensions (Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.gcm_compute_prob">
<span class="sig-name descname"><span class="pre">gcm_compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.gcm_compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.gcm_validation_compute">
<span class="sig-name descname"><span class="pre">gcm_validation_compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">models_files_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_to_save_roc_reliability</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_mean</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gridded</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.gcm_validation_compute" title="Link to this definition"></a></dt>
<dd><p>Validate multiple General Circulation Model (GCM) forecasts using specified metrics.</p>
<p>Computes deterministic, probabilistic, or ensemble-based scores for GCM hindcasts
by processing model data from provided file paths and comparing against observations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>models_files_path</strong> (<em>dict</em>) – Dictionary mapping model identifiers (e.g., model names) to file paths of hindcast NetCDF files.</p></li>
<li><p><strong>Obs</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X), where T is time, Y is latitude, and X is longitude.</p></li>
<li><p><strong>score</strong> (<em>str</em>) – Score to compute, must be a key in self.scores (e.g., ‘Pearson’, ‘RPSS’, ‘ROC_CURVE’, ‘RELIABILITY_DIAGRAM’).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em>) – Month of forecast initialization (1-12).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period for computing tercile thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period for computing tercile thresholds.</p></li>
<li><p><strong>dir_to_save_roc_reliability</strong> (<em>str</em><em> or </em><em>Path</em>) – Directory to save ROC curves and reliability diagram plots.</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – Lead times in months to define the forecast season (e.g., [1, 2, 3] for a 3-month season).
If None, no season is specified.</p></li>
<li><p><strong>ensemble_mean</strong> (<em>str</em><em>, </em><em>optional</em>) – Ensemble statistic to use for deterministic or probabilistic scores (e.g., ‘mean’).
If None, ensemble mean is computed automatically when required.</p></li>
<li><p><strong>gridded</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to perform gridded validation (True) or non-gridded (not implemented). Default is True.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>If score_type is ‘det_score’, ‘prob_score’, or ‘ensemble_score’:</dt><dd><p>Dictionary with model identifiers as keys and xarray.DataArray of scores (dimensions Y, X) as values.</p>
</dd>
<dt>If score_type is ‘all_grid_prob_score’ (e.g., ROC_CURVE, RELIABILITY_DIAGRAM):</dt><dd><p>None, as results are saved as plots.</p>
</dd>
<dt>If score_type is ‘all_grid_det_score’:</dt><dd><p>None (not implemented).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict or None</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the score is not recognized or if non-gridded validation is attempted (not implemented).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.get_scores_metadata">
<span class="sig-name descname"><span class="pre">get_scores_metadata</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.get_scores_metadata" title="Link to this definition"></a></dt>
<dd><p>Retrieve metadata for all available scoring metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing score names as keys and tuples of metadata
(description, min_value, max_value, score_type, colormap, function) as values.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.ignorance_score">
<span class="sig-name descname"><span class="pre">ignorance_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.ignorance_score" title="Link to this definition"></a></dt>
<dd><p>Compute Ignorance Score based on Weijs (2010).</p>
<p>Measures the logarithmic loss of forecast probabilities for the true category.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Ignorance score, non-negative. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.index_of_agreement">
<span class="sig-name descname"><span class="pre">index_of_agreement</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.index_of_agreement" title="Link to this definition"></a></dt>
<dd><p>Compute Index of Agreement (IOA).</p>
<p>Measures the degree of model prediction accuracy relative to observed variability.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_pred</strong> (<em>array-like</em>) – Predicted values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>IOA score, ranging from 0 to 1 (1 is perfect). Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.kling_gupta_efficiency">
<span class="sig-name descname"><span class="pre">kling_gupta_efficiency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.kling_gupta_efficiency" title="Link to this definition"></a></dt>
<dd><p>Compute Kling-Gupta Efficiency (KGE) metric.</p>
<p>KGE combines correlation, bias, and variability ratios to assess model performance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_pred</strong> (<em>array-like</em>) – Predicted values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>KGE score, ranging from -Inf to 1 (1 is perfect). Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.mean_absolute_error">
<span class="sig-name descname"><span class="pre">mean_absolute_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.mean_absolute_error" title="Link to this definition"></a></dt>
<dd><p>Compute Mean Absolute Error (MAE).</p>
<p>Measures the average magnitude of errors in predictions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_pred</strong> (<em>array-like</em>) – Predicted values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>MAE value, non-negative. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.nash_sutcliffe_efficiency">
<span class="sig-name descname"><span class="pre">nash_sutcliffe_efficiency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.nash_sutcliffe_efficiency" title="Link to this definition"></a></dt>
<dd><p>Compute Nash-Sutcliffe Efficiency (NSE).</p>
<p>Measures the predictive skill of the model compared to the mean of observations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_pred</strong> (<em>array-like</em>) – Predicted values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>NSE score, ranging from -Inf to 1 (1 is perfect). Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.pearson_corr">
<span class="sig-name descname"><span class="pre">pearson_corr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.pearson_corr" title="Link to this definition"></a></dt>
<dd><p>Compute Pearson Correlation Coefficient.</p>
<p>Measures the linear correlation between observed and predicted values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_pred</strong> (<em>array-like</em>) – Predicted values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Pearson correlation coefficient, ranging from -1 to 1. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.plot_model_score">
<span class="sig-name descname"><span class="pre">plot_model_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_metric</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_save_score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">figure_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'WAS_MLR'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.plot_model_score" title="Link to this definition"></a></dt>
<dd><p>Plot a deterministic score on a map.</p>
<p>Creates a geographical plot of the specified metric for a single model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_metric</strong> (<em>xarray.DataArray</em>) – Score values with dimensions (Y, X).</p></li>
<li><p><strong>score</strong> (<em>str</em>) – Name of the score to plot (e.g., ‘Pearson’, ‘MAE’).</p></li>
<li><p><strong>dir_save_score</strong> (<em>str</em><em> or </em><em>Path</em>) – Directory to save the plot.</p></li>
<li><p><strong>figure_name</strong> (<em>str</em><em>, </em><em>optional</em>) – Prefix for the figure filename. Default is ‘WAS_MLR’.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.plot_models_score">
<span class="sig-name descname"><span class="pre">plot_models_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_metrics</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_save_score</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.plot_models_score" title="Link to this definition"></a></dt>
<dd><p>Plot multiple model scores on a grid of maps.</p>
<p>Creates a subplot grid with geographical plots for each model’s score.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model_metrics</strong> (<em>dict</em>) – Dictionary of model names and their corresponding score DataArrays (Y, X).</p></li>
<li><p><strong>score</strong> (<em>str</em>) – Name of the score to plot (e.g., ‘Pearson’, ‘MAE’).</p></li>
<li><p><strong>dir_save_score</strong> (<em>str</em><em> or </em><em>Path</em>) – Directory to save the plot.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.plot_roc_curves">
<span class="sig-name descname"><span class="pre">plot_roc_curves</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">modelname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_to_save_score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_true_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bootstraps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ci</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.95</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.plot_roc_curves" title="Link to this definition"></a></dt>
<dd><p>Plot ROC Curves with Confidence Intervals for probabilistic forecasts.</p>
<p>Visualizes the Receiver Operating Characteristic for each tercile category.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>modelname</strong> (<em>str</em>) – Name of the model for labeling the plot.</p></li>
<li><p><strong>dir_to_save_score</strong> (<em>str</em><em> or </em><em>Path</em>) – Directory to save the plot.</p></li>
<li><p><strong>y_true_class</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X).</p></li>
<li><p><strong>y_probs</strong> (<em>xarray.DataArray</em>) – Forecast probabilities with dimensions (probability, T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>n_bootstraps</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of bootstrap samples for confidence intervals. Default is 200.</p></li>
<li><p><strong>ci</strong> (<em>float</em><em>, </em><em>optional</em>) – Confidence interval level (e.g., 0.95 for 95%). Default is 0.95.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.ratio_to_average">
<span class="sig-name descname"><span class="pre">ratio_to_average</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.ratio_to_average" title="Link to this definition"></a></dt>
<dd><p>Compute and visualize the ratio of a specific year’s data to the climatological mean.</p>
<p>Calculates the percentage ratio of the predictand for a given year relative to
the mean over a climatology period, classifies it into categories, and plots the
result on a geographical map.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predictant</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X), where T is time, Y is latitude, and X is longitude.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>year</strong> (<em>int</em><em> or </em><em>str</em>) – Specific year to compute the ratio for.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Displays a geographical plot of the classified ratios with a custom colormap and legend.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.reliability_diagram">
<span class="sig-name descname"><span class="pre">reliability_diagram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">modelname</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_to_save_score</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_true_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([0.1,</span> <span class="pre">0.15,</span> <span class="pre">0.2,</span> <span class="pre">0.25,</span> <span class="pre">0.3,</span> <span class="pre">0.35,</span> <span class="pre">0.4,</span> <span class="pre">0.45,</span> <span class="pre">0.5,</span> <span class="pre">0.55,</span> <span class="pre">0.6,</span> <span class="pre">0.65,</span> <span class="pre">0.67])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.reliability_diagram" title="Link to this definition"></a></dt>
<dd><p>Plot Reliability Diagrams for probabilistic forecasts.</p>
<p>Visualizes the calibration of forecast probabilities against observed frequencies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>modelname</strong> (<em>str</em>) – Name of the model for labeling the plot.</p></li>
<li><p><strong>dir_to_save_score</strong> (<em>str</em><em> or </em><em>Path</em>) – Directory to save the plot.</p></li>
<li><p><strong>y_true</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X).</p></li>
<li><p><strong>y_probs</strong> (<em>xarray.DataArray</em>) – Forecast probabilities with dimensions (probability, T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>bins</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Probability bins for discretizing forecast probabilities.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.reliability_score_grid">
<span class="sig-name descname"><span class="pre">reliability_score_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([0.,</span> <span class="pre">0.025,</span> <span class="pre">0.05,</span> <span class="pre">0.1,</span> <span class="pre">0.15,</span> <span class="pre">0.2,</span> <span class="pre">0.25,</span> <span class="pre">0.3,</span> <span class="pre">0.35,</span> <span class="pre">0.4,</span> <span class="pre">0.45,</span> <span class="pre">0.5,</span> <span class="pre">0.55,</span> <span class="pre">0.6,</span> <span class="pre">0.65,</span> <span class="pre">0.67,</span> <span class="pre">0.675,</span> <span class="pre">0.8,</span> <span class="pre">0.85,</span> <span class="pre">0.9,</span> <span class="pre">0.95,</span> <span class="pre">0.975,</span> <span class="pre">1.])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.reliability_score_grid" title="Link to this definition"></a></dt>
<dd><p>Compute Reliability Score on a grid based on Weijs (2010).</p>
<p>Measures the calibration of forecast probabilities against observed frequencies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
<li><p><strong>bins</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Probability bins for discretizing forecast probabilities.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Reliability score. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.resolution_and_reliability_over_all_grid">
<span class="sig-name descname"><span class="pre">resolution_and_reliability_over_all_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([0.,</span> <span class="pre">0.025,</span> <span class="pre">0.05,</span> <span class="pre">0.1,</span> <span class="pre">0.15,</span> <span class="pre">0.2,</span> <span class="pre">0.25,</span> <span class="pre">0.3,</span> <span class="pre">0.35,</span> <span class="pre">0.4,</span> <span class="pre">0.45,</span> <span class="pre">0.5,</span> <span class="pre">0.55,</span> <span class="pre">0.6,</span> <span class="pre">0.65,</span> <span class="pre">0.67,</span> <span class="pre">0.675,</span> <span class="pre">0.8,</span> <span class="pre">0.85,</span> <span class="pre">0.9,</span> <span class="pre">0.95,</span> <span class="pre">0.975,</span> <span class="pre">1.])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.resolution_and_reliability_over_all_grid" title="Link to this definition"></a></dt>
<dd><p>Compute Resolution and Reliability scores over all grid points.</p>
<p>Based on Weijs (2010), computes scores by aggregating across all grid points.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true_class</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X).</p></li>
<li><p><strong>y_probs</strong> (<em>xarray.DataArray</em>) – Forecast probabilities with dimensions (probability, T, Y, X).</p></li>
<li><p><strong>bins</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Probability bins for discretizing forecast probabilities.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><dl class="simple">
<dt>resolution_sum<span class="classifier">float</span></dt><dd><p>Aggregated resolution score.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>reliability_sum<span class="classifier">float</span></dt><dd><p>Aggregated reliability score.</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.resolution_and_reliability_over_all_grid_per_category">
<span class="sig-name descname"><span class="pre">resolution_and_reliability_over_all_grid_per_category</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([0.,</span> <span class="pre">0.025,</span> <span class="pre">0.05,</span> <span class="pre">0.1,</span> <span class="pre">0.15,</span> <span class="pre">0.2,</span> <span class="pre">0.25,</span> <span class="pre">0.3,</span> <span class="pre">0.35,</span> <span class="pre">0.4,</span> <span class="pre">0.45,</span> <span class="pre">0.5,</span> <span class="pre">0.55,</span> <span class="pre">0.6,</span> <span class="pre">0.65,</span> <span class="pre">0.67,</span> <span class="pre">0.675,</span> <span class="pre">0.8,</span> <span class="pre">0.85,</span> <span class="pre">0.9,</span> <span class="pre">0.95,</span> <span class="pre">0.975,</span> <span class="pre">1.])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.resolution_and_reliability_over_all_grid_per_category" title="Link to this definition"></a></dt>
<dd><p>Assumes y_true_class already contains valid category labels (0, 1, 2).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.resolution_and_reliability_per_category_grid">
<span class="sig-name descname"><span class="pre">resolution_and_reliability_per_category_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([0.,</span> <span class="pre">0.025,</span> <span class="pre">0.05,</span> <span class="pre">0.1,</span> <span class="pre">0.15,</span> <span class="pre">0.2,</span> <span class="pre">0.25,</span> <span class="pre">0.3,</span> <span class="pre">0.35,</span> <span class="pre">0.4,</span> <span class="pre">0.45,</span> <span class="pre">0.5,</span> <span class="pre">0.55,</span> <span class="pre">0.6,</span> <span class="pre">0.65,</span> <span class="pre">0.67,</span> <span class="pre">0.675,</span> <span class="pre">0.8,</span> <span class="pre">0.85,</span> <span class="pre">0.9,</span> <span class="pre">0.95,</span> <span class="pre">0.975,</span> <span class="pre">1.])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.resolution_and_reliability_per_category_grid" title="Link to this definition"></a></dt>
<dd><p>Compute Resolution and Reliability scores per category based on Weijs (2010).</p>
<p>Returns both total scores and per-category breakdowns.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
<li><p><strong>bins</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Probability bins for discretizing forecast probabilities.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary containing:
- ‘total_resolution’: float
- ‘total_reliability’: float
- ‘category_resolution’: list of floats for each category
- ‘category_reliability’: list of floats for each category
- ‘category_base_rates’: list of floats (climatological frequencies)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.resolution_score_grid">
<span class="sig-name descname"><span class="pre">resolution_score_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([0.,</span> <span class="pre">0.025,</span> <span class="pre">0.05,</span> <span class="pre">0.1,</span> <span class="pre">0.15,</span> <span class="pre">0.2,</span> <span class="pre">0.25,</span> <span class="pre">0.3,</span> <span class="pre">0.35,</span> <span class="pre">0.4,</span> <span class="pre">0.45,</span> <span class="pre">0.5,</span> <span class="pre">0.55,</span> <span class="pre">0.6,</span> <span class="pre">0.65,</span> <span class="pre">0.67,</span> <span class="pre">0.675,</span> <span class="pre">0.8,</span> <span class="pre">0.85,</span> <span class="pre">0.9,</span> <span class="pre">0.95,</span> <span class="pre">0.975,</span> <span class="pre">1.])</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.resolution_score_grid" title="Link to this definition"></a></dt>
<dd><p>Compute Resolution Score on a grid based on Weijs (2010).</p>
<p>Measures the ability of the forecast to distinguish between different outcomes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_probs</strong> (<em>array-like</em>) – Forecast probabilities with shape (n_classes, n_samples).</p></li>
<li><p><strong>index_start</strong> (<em>int</em>) – Start index of the climatology period.</p></li>
<li><p><strong>index_end</strong> (<em>int</em>) – End index of the climatology period.</p></li>
<li><p><strong>bins</strong> (<em>array-like</em><em>, </em><em>optional</em>) – Probability bins for discretizing forecast probabilities.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Resolution score, non-negative. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.root_mean_square_error">
<span class="sig-name descname"><span class="pre">root_mean_square_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.root_mean_square_error" title="Link to this definition"></a></dt>
<dd><p>Compute Root Mean Square Error (RMSE).</p>
<p>Measures the square root of the average squared errors in predictions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values.</p></li>
<li><p><strong>y_pred</strong> (<em>array-like</em>) – Predicted values.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>RMSE value, non-negative. Returns np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.spearman_corr">
<span class="sig-name descname"><span class="pre">spearman_corr</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.spearman_corr" title="Link to this definition"></a></dt>
<dd><p>Compute Spearman rank correlation coefficient.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y_true</strong> (<em>array-like</em>) – Observed values (1D).</p></li>
<li><p><strong>y_pred</strong> (<em>array-like</em>) – Predicted values (1D).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Spearman’s rho in [-1, 1]; np.nan if insufficient valid data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.taylor_diagram">
<span class="sig-name descname"><span class="pre">taylor_diagram</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">models</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">correlation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'pearson'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Taylor</span> <span class="pre">diagram'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">figsize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(7,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">savepath</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hide_rms_numbers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.taylor_diagram" title="Link to this definition"></a></dt>
<dd><p>Plot a Taylor diagram comparing one or more model series against observations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>obs</strong> (<em>xarray.DataArray</em><em> or </em><em>np.ndarray</em>) – Observations. If xarray, can be (T), (T,Y,X), etc.</p></li>
<li><p><strong>models</strong> (<em>dict</em><em>[</em><em>str</em><em>, </em><em>xarray.DataArray</em><em> | </em><em>np.ndarray</em><em>]</em>) – Mapping of model name -&gt; forecast array (same shape as obs or broadcastable).</p></li>
<li><p><strong>normalize</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True (default), normalize std and CRMSD by std(obs).</p></li>
<li><p><strong>correlation</strong> (<em>{&quot;pearson&quot;</em><em>,</em><em>&quot;spearman&quot;}</em><em>, </em><em>optional</em>) – Correlation metric used on paired, finite values.</p></li>
<li><p><strong>labels</strong> (<em>dict</em><em>[</em><em>str</em><em>,</em><em>str</em><em>]</em><em>, </em><em>optional</em>) – Custom display labels for model markers. Defaults to model keys.</p></li>
<li><p><strong>title</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – Figure title.</p></li>
<li><p><strong>figsize</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Matplotlib figure size.</p></li>
<li><p><strong>savepath</strong> (<em>str</em><em> or </em><em>None</em><em>, </em><em>optional</em>) – If provided, save figure to this path.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>(fig, ax)</strong></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>matplotlib Figure and Axes</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_verification.WAS_Verification.weighted_gcm_forecasts">
<span class="sig-name descname"><span class="pre">weighted_gcm_forecasts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_models</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scores</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variable</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PRCP'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_verification.WAS_Verification.weighted_gcm_forecasts" title="Link to this definition"></a></dt>
<dd><p>Generate weighted ensemble forecasts from selected GCMs based on their performance scores.</p>
<p>Combines hindcasts and forecasts from multiple models using weights derived from
the GROC score, scales the results to match observed climatology, and computes
tercile probabilities.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Obs</strong> (<em>xarray.DataArray</em>) – Observed data with dimensions (T, Y, X), used for scaling and probability calculations.</p></li>
<li><p><strong>best_models</strong> (<em>dict</em>) – Dictionary of model identifiers (keys) to be included in the ensemble.</p></li>
<li><p><strong>scores</strong> (<em>dict</em>) – Dictionary containing scores (e.g., GROC) for each model, with model identifiers as keys.</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em> of </em><em>int</em>) – Lead times in months for the forecast season (e.g., [1, 2, 3] for a 3-month season).</p></li>
<li><p><strong>model_dir</strong> (<em>str</em><em> or </em><em>Path</em>) – Directory containing hindcast and forecast NetCDF files.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period for computing tercile thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period for computing tercile thresholds.</p></li>
<li><p><strong>variable</strong> (<em>str</em><em>, </em><em>optional</em>) – Variable name in the NetCDF files (e.g., ‘PRCP’ for precipitation). Default is ‘PRCP’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><dl class="simple">
<dt>hindcast_det<span class="classifier">xarray.DataArray</span></dt><dd><p>Weighted deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>hindcast_prob<span class="classifier">xarray.DataArray</span></dt><dd><p>Tercile probabilities for hindcasts with dimensions (probability, T, Y, X).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>forecast_prob<span class="classifier">xarray.DataArray</span></dt><dd><p>Tercile probabilities for forecasts with dimensions (probability, Y, X).</p>
</dd>
</dl>
</li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Model files are expected to follow a naming convention like
‘hindcast_{center}_{variable}_{init_month}_{season}_{lead}.nc’.</p></li>
<li><p>The GROC score is used as the weighting metric.</p></li>
<li><p>A scaling factor is applied based on the ratio of observed to hindcast mean.</p></li>
</ul>
</dd></dl>

</dd></dl>

</section>
<section id="module-wass2s.was_mme">
<span id="wass2s-was-mme-module"></span><h3>wass2s.was_mme module<a class="headerlink" href="#module-wass2s.was_mme" title="Link to this heading"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Gene">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">EP_Gene</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictor_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Random</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.EP_Gene" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Gene.OPERATORS">
<span class="sig-name descname"><span class="pre">OPERATORS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'ADD':</span> <span class="pre">&lt;built-in</span> <span class="pre">function</span> <span class="pre">add&gt;,</span> <span class="pre">'MULTIPLY':</span> <span class="pre">&lt;built-in</span> <span class="pre">function</span> <span class="pre">mul&gt;}</span></em><a class="headerlink" href="#wass2s.was_mme.EP_Gene.OPERATORS" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Gene.REL_OPS">
<span class="sig-name descname"><span class="pre">REL_OPS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'&lt;=':</span> <span class="pre">&lt;built-in</span> <span class="pre">function</span> <span class="pre">le&gt;,</span> <span class="pre">'&gt;':</span> <span class="pre">&lt;built-in</span> <span class="pre">function</span> <span class="pre">gt&gt;}</span></em><a class="headerlink" href="#wass2s.was_mme.EP_Gene.REL_OPS" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Gene.copy">
<span class="sig-name descname"><span class="pre">copy</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_mme.EP_Gene" title="wass2s.was_mme.EP_Gene"><span class="pre">EP_Gene</span></a></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Gene.copy" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Gene.evaluate">
<span class="sig-name descname"><span class="pre">evaluate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Gene.evaluate" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Gene.mutate_element">
<span class="sig-name descname"><span class="pre">mutate_element</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Random</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Gene.mutate_element" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Implements the mutation menu and approximate weights from Roebber (2015):</dt><dd><p>overall mutation is handled by the caller (50%).
then select ONE element type to mutate in this gene.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Gene.replace_structure_from_maternal_keep_paternal_coeffs">
<span class="sig-name descname"><span class="pre">replace_structure_from_maternal_keep_paternal_coeffs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">maternal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#wass2s.was_mme.EP_Gene" title="wass2s.was_mme.EP_Gene"><span class="pre">EP_Gene</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Gene.replace_structure_from_maternal_keep_paternal_coeffs" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Individual">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">EP_Individual</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predictor_names</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_genes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Random</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sex</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.EP_Individual" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Individual.compute_mse">
<span class="sig-name descname"><span class="pre">compute_mse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rows</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_norm</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ndarray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Individual.compute_mse" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Individual.copy">
<span class="sig-name descname"><span class="pre">copy</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_mme.EP_Individual" title="wass2s.was_mme.EP_Individual"><span class="pre">EP_Individual</span></a></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Individual.copy" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Individual.crossover">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">crossover</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">paternal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#wass2s.was_mme.EP_Individual" title="wass2s.was_mme.EP_Individual"><span class="pre">EP_Individual</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">maternal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#wass2s.was_mme.EP_Individual" title="wass2s.was_mme.EP_Individual"><span class="pre">EP_Individual</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Random</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_mme.EP_Individual" title="wass2s.was_mme.EP_Individual"><span class="pre">EP_Individual</span></a></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Individual.crossover" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Individual.predict_row">
<span class="sig-name descname"><span class="pre">predict_row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Individual.predict_row" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.EP_Individual.transposition">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">transposition</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">child</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#wass2s.was_mme.EP_Individual" title="wass2s.was_mme.EP_Individual"><span class="pre">EP_Individual</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">rng</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Random</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="headerlink" href="#wass2s.was_mme.EP_Individual.transposition" title="Link to this definition"></a></dt>
<dd><p>Copy one EP-gene segment from one line to another.
Segment set (as in Roebber 2015 text):</p>
<blockquote>
<div><p>A: (V1, OR, V2)
B: (C1, V3, O1)
C: (C2, V4, O2)
D: (C3, V5)</p>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.HPELMWrapper">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">HPELMWrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neurons</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sigm'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.HPELMWrapper" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseEstimator</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RegressorMixin</span></code></p>
<p>Wrapper for HPELM to make it compatible with scikit-learn’s hyperparameter optimization.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.HPELMWrapper.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.HPELMWrapper.fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.HPELMWrapper.get_params">
<span class="sig-name descname"><span class="pre">get_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">deep</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.HPELMWrapper.get_params" title="Link to this definition"></a></dt>
<dd><p>Get parameters for this estimator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>deep</strong> (<em>bool</em><em>, </em><em>default=True</em>) – If True, will return the parameters for this estimator and
contained subobjects that are estimators.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>params</strong> – Parameter names mapped to their values.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.HPELMWrapper.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.HPELMWrapper.predict" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.HPELMWrapper.score">
<span class="sig-name descname"><span class="pre">score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.HPELMWrapper.score" title="Link to this definition"></a></dt>
<dd><p>Return the coefficient of determination of the prediction.</p>
<p>The coefficient of determination <span class="math notranslate nohighlight">\(R^2\)</span> is defined as
<span class="math notranslate nohighlight">\((1 - \frac{u}{v})\)</span>, where <span class="math notranslate nohighlight">\(u\)</span> is the residual
sum of squares <code class="docutils literal notranslate"><span class="pre">((y_true</span> <span class="pre">-</span> <span class="pre">y_pred)**</span> <span class="pre">2).sum()</span></code> and <span class="math notranslate nohighlight">\(v\)</span>
is the total sum of squares <code class="docutils literal notranslate"><span class="pre">((y_true</span> <span class="pre">-</span> <span class="pre">y_true.mean())</span> <span class="pre">**</span> <span class="pre">2).sum()</span></code>.
The best possible score is 1.0 and it can be negative (because the
model can be arbitrarily worse). A constant model that always predicts
the expected value of <cite>y</cite>, disregarding the input features, would get
a <span class="math notranslate nohighlight">\(R^2\)</span> score of 0.0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X</strong> (<em>array-like</em><em> of </em><em>shape</em><em> (</em><em>n_samples</em><em>, </em><em>n_features</em><em>)</em>) – Test samples. For some estimators this may be a precomputed
kernel matrix or a list of generic objects instead with shape
<code class="docutils literal notranslate"><span class="pre">(n_samples,</span> <span class="pre">n_samples_fitted)</span></code>, where <code class="docutils literal notranslate"><span class="pre">n_samples_fitted</span></code>
is the number of samples used in the fitting for the estimator.</p></li>
<li><p><strong>y</strong> (<em>array-like</em><em> of </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>) or </em><em>(</em><em>n_samples</em><em>, </em><em>n_outputs</em><em>)</em>) – True values for <cite>X</cite>.</p></li>
<li><p><strong>sample_weight</strong> (<em>array-like</em><em> of </em><em>shape</em><em> (</em><em>n_samples</em><em>,</em><em>)</em><em>, </em><em>default=None</em>) – Sample weights.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>score</strong> – <span class="math notranslate nohighlight">\(R^2\)</span> of <code class="docutils literal notranslate"><span class="pre">self.predict(X)</span></code> w.r.t. <cite>y</cite>.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The <span class="math notranslate nohighlight">\(R^2\)</span> score used when calling <code class="docutils literal notranslate"><span class="pre">score</span></code> on a regressor uses
<code class="docutils literal notranslate"><span class="pre">multioutput='uniform_average'</span></code> from version 0.23 to keep consistent
with default value of <code class="xref py py-func docutils literal notranslate"><span class="pre">r2_score()</span></code>.
This influences the <code class="docutils literal notranslate"><span class="pre">score</span></code> method of all the multioutput
regressors (except for
<code class="xref py py-class docutils literal notranslate"><span class="pre">MultiOutputRegressor</span></code>).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.HPELMWrapper.set_params">
<span class="sig-name descname"><span class="pre">set_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.HPELMWrapper.set_params" title="Link to this definition"></a></dt>
<dd><p>Set the parameters of this estimator.</p>
<p>The method works on simple estimators as well as on nested objects
(such as <code class="xref py py-class docutils literal notranslate"><span class="pre">Pipeline</span></code>). The latter have
parameters of the form <code class="docutils literal notranslate"><span class="pre">&lt;component&gt;__&lt;parameter&gt;</span></code> so that it’s
possible to update each component of a nested object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>**params</strong> (<em>dict</em>) – Estimator parameters.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>self</strong> – Estimator instance.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>estimator instance</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">Roebber2015Config</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">population_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'int'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_genes</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'int'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'int'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_mates_per_male</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'int'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qualify_quantile</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'float'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tighten_factor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'float'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.97</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">relax_factor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'float'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_qualify</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'int'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_mutation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'float'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_transposition</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'float'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="s"><span class="pre">'int'</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">42</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.max_iter">
<span class="sig-name descname"><span class="pre">max_iter</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">100</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.max_iter" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.max_mates_per_male">
<span class="sig-name descname"><span class="pre">max_mates_per_male</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">10</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.max_mates_per_male" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.min_qualify">
<span class="sig-name descname"><span class="pre">min_qualify</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">10</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.min_qualify" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.num_genes">
<span class="sig-name descname"><span class="pre">num_genes</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">10</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.num_genes" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.p_mutation">
<span class="sig-name descname"><span class="pre">p_mutation</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.5</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.p_mutation" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.p_transposition">
<span class="sig-name descname"><span class="pre">p_transposition</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.5</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.p_transposition" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.population_size">
<span class="sig-name descname"><span class="pre">population_size</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">50</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.population_size" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.qualify_quantile">
<span class="sig-name descname"><span class="pre">qualify_quantile</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.5</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.qualify_quantile" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.random_state">
<span class="sig-name descname"><span class="pre">random_state</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">42</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.random_state" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.relax_factor">
<span class="sig-name descname"><span class="pre">relax_factor</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1.1</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.relax_factor" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.Roebber2015Config.tighten_factor">
<span class="sig-name descname"><span class="pre">tighten_factor</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.97</span></em><a class="headerlink" href="#wass2s.was_mme.Roebber2015Config.tighten_factor" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_EnsembleBMA">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_EnsembleBMA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'normal'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_EnsembleBMA" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Baseline mixture postprocessor, with optional terciles.</p>
<dl class="simple">
<dt>model_type:</dt><dd><ul class="simple">
<li><p>‘normal’ : Gaussian mixture around each member forecast (shared sigma per gridpoint)</p></li>
<li><p>‘gamma’  : Gamma mixture; component mean = member forecast; shape is fitted per gridpoint</p></li>
<li><p>‘gamma0’ : Zero-adjusted gamma (precip): POP via logistic + Gamma mixture for positive part</p></li>
</ul>
</dd>
</dl>
<p>fit() can store gridpoint terciles from obs.</p>
<dl class="simple">
<dt>predict_probabilistic() returns:</dt><dd><ul class="simple">
<li><p>predictive_mean (T,Y,X)</p></li>
<li><p>predictive_quantiles (‘quantile’,T,Y,X)</p></li>
<li><p>tercile_thresholds (‘tercile’,Y,X)  [if available]</p></li>
<li><p>tercile_probability (‘category’,T,Y,X) with [‘PB’,’PN’,’PA’] [if available]</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_EnsembleBMA.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hcst_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_EnsembleBMA.fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_EnsembleBMA.predict_probabilistic">
<span class="sig-name descname"><span class="pre">predict_probabilistic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_forecasts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.1,</span> <span class="pre">0.5,</span> <span class="pre">0.9)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_for_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">xr.Dataset</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_EnsembleBMA.predict_probabilistic" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_GaussianBMA_EM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">200</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'memberwise'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equal_sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">equal_weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q_fit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Gaussian BMA (Raftery/Wilks-style) with optional terciles.</p>
<dl class="simple">
<dt>Bias correction (Eq. 8.34):</dt><dd><p>m_{t,k} = a_k + b_k x_{t,k}</p>
</dd>
<dt>Predictive CDF:</dt><dd><p>F(q) = sum_k w_k Phi((q - m_{t,k}) / sigma_k)</p>
</dd>
</dl>
<p>EM estimates weights and sigma_k (optionally constrained equal).</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.a">
<span class="sig-name descname"><span class="pre">a</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.a" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.b">
<span class="sig-name descname"><span class="pre">b</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.b" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.bias_mode">
<span class="sig-name descname"><span class="pre">bias_mode</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'memberwise'</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.bias_mode" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.clim_terciles">
<span class="sig-name descname"><span class="pre">clim_terciles</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.clim_terciles" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.compute_terciles">
<span class="sig-name descname"><span class="pre">compute_terciles</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.compute_terciles" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.equal_sigma">
<span class="sig-name descname"><span class="pre">equal_sigma</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.equal_sigma" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.equal_weights">
<span class="sig-name descname"><span class="pre">equal_weights</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.equal_weights" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hcst_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.fitted">
<span class="sig-name descname"><span class="pre">fitted</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.fitted" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.max_iter">
<span class="sig-name descname"><span class="pre">max_iter</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">200</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.max_iter" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.min_sigma">
<span class="sig-name descname"><span class="pre">min_sigma</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.001</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.min_sigma" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.predict_probabilistic">
<span class="sig-name descname"><span class="pre">predict_probabilistic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_forecasts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.1,</span> <span class="pre">0.5,</span> <span class="pre">0.9)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_for_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">xr.Dataset</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.predict_probabilistic" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.sigma">
<span class="sig-name descname"><span class="pre">sigma</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.sigma" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.tercile_q_fit">
<span class="sig-name descname"><span class="pre">tercile_q_fit</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.tercile_q_fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.tol">
<span class="sig-name descname"><span class="pre">tol</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.0001</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.tol" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianBMA_EM.weights">
<span class="sig-name descname"><span class="pre">weights</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianBMA_EM.weights" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_GaussianDressing_WangBishop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clip_negative</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'exchangeable'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q_fit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sD</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Gaussian dressing (Wang &amp; Bishop 2005), with optional terciles.</p>
<p>Uses bias-corrected members m_{t,k} and equal weights 1/M and a common dressing sD.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.a">
<span class="sig-name descname"><span class="pre">a</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.a" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.b">
<span class="sig-name descname"><span class="pre">b</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.b" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.bias_mode">
<span class="sig-name descname"><span class="pre">bias_mode</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">str</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'exchangeable'</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.bias_mode" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.clim_terciles">
<span class="sig-name descname"><span class="pre">clim_terciles</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.clim_terciles" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.clip_negative">
<span class="sig-name descname"><span class="pre">clip_negative</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.clip_negative" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.compute_terciles">
<span class="sig-name descname"><span class="pre">compute_terciles</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.compute_terciles" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hcst_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">20</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.fitted">
<span class="sig-name descname"><span class="pre">fitted</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.fitted" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.min_sigma">
<span class="sig-name descname"><span class="pre">min_sigma</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.001</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.min_sigma" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.predict_probabilistic">
<span class="sig-name descname"><span class="pre">predict_probabilistic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_forecasts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.1,</span> <span class="pre">0.5,</span> <span class="pre">0.9)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_for_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">xr.Dataset</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.predict_probabilistic" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.sD">
<span class="sig-name descname"><span class="pre">sD</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.sD" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_GaussianDressing_WangBishop.tercile_q_fit">
<span class="sig-name descname"><span class="pre">tercile_q_fit</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_GaussianDressing_WangBishop.tercile_q_fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_Min2009_ProbWeighted">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_Min2009_ProbWeighted</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distribution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gaussian'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_samples_for_chisq</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'total_ensemble'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_Min2009_ProbWeighted" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Implementation of Min et al. (2009) Probability-Weighted Multi-Model Ensemble.</p>
<p>Based on: “Probabilistic Multimodel Ensemble (PMME) forecasting at APCC”
Journal: Weather and Forecasting, 2009</p>
<p>Key methodology:
1. Individual model probabilistic forecasts are computed using Gaussian approximation
2. Model weights are proportional to sqrt(ensemble_size) [Eq. 6 in paper]
3. Tercile probabilities (BN, NN, AN) are combined using total probability formula</p>
<p>Notes:
- For temperature: Gaussian assumption is reasonable
- For precipitation: Consider using log-normal, Gamma distribution, or empirical methods
- The χ² test uses configurable n (ensemble size) - avoid overly conservative n=1
- Cross-validation is recommended for hindcast statistics</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_Min2009_ProbWeighted.compute_combined_map">
<span class="sig-name descname"><span class="pre">compute_combined_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pmme_probs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_sizes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_names</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">significance_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_Min2009_ProbWeighted.compute_combined_map" title="Link to this definition"></a></dt>
<dd><p>Compute combined map with significance testing (χ² test).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>pmme_probs</strong> (<em>dict</em>) – PMME probabilities for BN, NN, AN categories</p></li>
<li><p><strong>ensemble_sizes</strong> (<em>dict</em>) – Dictionary mapping model names to ensemble sizes</p></li>
<li><p><strong>model_names</strong> (<em>list</em>) – List of model names</p></li>
<li><p><strong>significance_level</strong> (<em>float</em>) – Significance level for χ² test (default 0.05)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>combined_map</strong> (<em>xarray.DataArray</em>) – Combined map showing dominant category where significant</p></li>
<li><p><strong>chi_square</strong> (<em>xarray.DataArray</em>) – χ² statistic values</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_Min2009_ProbWeighted.compute_pmme_probabilities">
<span class="sig-name descname"><span class="pre">compute_pmme_probabilities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">forecasts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcasts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">climatology</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ensemble_sizes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_Min2009_ProbWeighted.compute_pmme_probabilities" title="Link to this definition"></a></dt>
<dd><p>Compute PMME probabilities according to Min et al. (2009).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>forecasts</strong> (<em>dict</em><em> of </em><em>xarray.DataArray</em>) – Dictionary of forecast ensembles for each model</p></li>
<li><p><strong>hindcasts</strong> (<em>dict</em><em> of </em><em>xarray.DataArray</em>) – Dictionary of hindcast ensembles for each model</p></li>
<li><p><strong>climatology</strong> (<em>xarray.DataArray</em>) – Climatological data</p></li>
<li><p><strong>ensemble_sizes</strong> (<em>dict</em>) – Dictionary mapping model names to ensemble sizes</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>pmme_probs</strong> – Dictionary with keys ‘BN’, ‘NN’, ‘AN’ containing PMME probabilities</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_SchmeitsKok2010">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_PrecipBMA_SchmeitsKok2010</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q_fit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_SchmeitsKok2010" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007" title="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007"><code class="xref py py-class docutils literal notranslate"><span class="pre">WAS_PrecipBMA_Sloughter2007</span></code></a></p>
<dl class="simple">
<dt>Variant where P(Y=0) uses a shared logistic based on ensemble-mean cube-root:</dt><dd><p>p0_t = logistic(a0 + a1 * mean_k x_{t,k}^{1/3})</p>
</dd>
</dl>
<p>applied to all members.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_SchmeitsKok2010.predict_probabilistic">
<span class="sig-name descname"><span class="pre">predict_probabilistic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_forecasts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.1,</span> <span class="pre">0.5,</span> <span class="pre">0.9)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_for_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">xr.Dataset</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_SchmeitsKok2010.predict_probabilistic" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_PrecipBMA_Sloughter2007</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compute_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q_fit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_shape</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_scale</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fitted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Precipitation BMA with mixed discrete-continuous components.</p>
<ul class="simple">
<li><dl class="simple">
<dt>Logistic regression for P(Y=0) per member:</dt><dd><p>p0_{t,k} = logistic(a0_k + a1_k * x_{t,k}^{1/3} + a2_k * I(x_{t,k}=0))</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Gamma distribution on cube-root transformed positive amounts z=y^(1/3):</dt><dd><p>z ~ Gamma(shape_k, scale_k)</p>
</dd>
</dl>
</li>
</ul>
<dl>
<dt>Predictive CDF for q&gt;=0:</dt><dd><blockquote>
<div><p>F(q) = sum_k w_k [ p0_{t,k} + (1 - p0_{t,k}) * F_gamma(z_q) ]</p>
</div></blockquote>
<p>where z_q = q^(1/3)</p>
</dd>
</dl>
<p>Tercile probabilities computed directly from this predictive CDF.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.clim_terciles">
<span class="sig-name descname"><span class="pre">clim_terciles</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.clim_terciles" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.compute_terciles">
<span class="sig-name descname"><span class="pre">compute_terciles</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">True</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.compute_terciles" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hcst_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">30</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.fitted">
<span class="sig-name descname"><span class="pre">fitted</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">bool</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">False</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.fitted" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.g_scale">
<span class="sig-name descname"><span class="pre">g_scale</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.g_scale" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.g_shape">
<span class="sig-name descname"><span class="pre">g_shape</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.g_shape" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.logit">
<span class="sig-name descname"><span class="pre">logit</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.logit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.predict_probabilistic">
<span class="sig-name descname"><span class="pre">predict_probabilistic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_forecasts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantiles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.1,</span> <span class="pre">0.5,</span> <span class="pre">0.9)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_for_terciles</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">xr.DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tercile_q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">xr.Dataset</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.predict_probabilistic" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.tercile_q_fit">
<span class="sig-name descname"><span class="pre">tercile_q_fit</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.tercile_q_fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.tol">
<span class="sig-name descname"><span class="pre">tol</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.0001</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.tol" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.weights">
<span class="sig-name descname"><span class="pre">weights</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">None</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_PrecipBMA_Sloughter2007.weights" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_ProbWeighted">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_ProbWeighted</span></span><a class="headerlink" href="#wass2s.was_mme.WAS_ProbWeighted" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Probability-Weighted Multi-Model Ensemble for seasonal rainfall forecasting.</p>
<p>Implements a threshold-based weighting scheme for combining multiple climate
model outputs (hindcasts and forecasts). Model weights are derived from performance.
It’s currently for only GROC scores. With a stepwise transformation:
- ≤ threshold → weight = 0 (excluded)
- threshold &lt; score ≤ 0.6 → weight = 0.6
- 0.6 &lt; score ≤ 0.8 → weight = 0.8
- &gt; 0.8 → weight = 1.0</p>
<p>This approach aims to emphasize better-performing models while maintaining some
contribution from moderately skilled ones, and completely excluding very poor models.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>None</strong></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>All input data (hindcast, forecast, scores) are interpolated to the rainfall grid
using nearest-neighbor interpolation with extrapolation.</p></li>
<li><p>A spatial mask is derived from the first time step of rainfall observations.</p></li>
<li><p>Supports an optional ‘complete’ mode that fills missing values with simple
unweighted ensemble mean.</p></li>
<li><p>Designed primarily for seasonal climate forecasting applications.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_ProbWeighted.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rainfall</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdcst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fcst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scores</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">complete</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_ProbWeighted.compute" title="Link to this definition"></a></dt>
<dd><p>Compute probability-weighted multi-model ensemble mean for hindcast and forecast.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rainfall</strong> (<em>xarray.DataArray</em>) – Observed rainfall used as reference grid and for masking.
Expected dimensions: (T, Y, X, M) or (T, Y, X).
The M dimension (if present) is ignored.</p></li>
<li><p><strong>hdcst</strong> (<em>xarray.DataArray</em>) – Multi-model hindcast dataset.
Expected dimensions: (T, M, Y, X)</p></li>
<li><p><strong>fcst</strong> (<em>xarray.DataArray</em>) – Multi-model forecast dataset (single lead time).
Expected dimensions: (T, M, Y, X)</p></li>
<li><p><strong>scores</strong> (<em>dict</em>) – Dictionary mapping model names (str) to performance score arrays.
Each score array should be an xarray.DataArray with spatial coordinates (Y, X).</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em>, </em><em>default=0.5 for GROC</em>) – Minimum score value below which a model is completely excluded (weight = 0).</p></li>
<li><p><strong>complete</strong> (<em>bool</em><em>, </em><em>default=False</em>) – If True, areas where weighted mean is NaN are filled with the simple
unweighted ensemble mean.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>hindcast_weighted</strong> (<em>xarray.DataArray</em>) – Weighted hindcast ensemble mean.
Dimensions: (T, Y, X)</p></li>
<li><p><strong>forecast_weighted</strong> (<em>xarray.DataArray</em>) – Weighted forecast ensemble mean.
Dimensions: (T, Y, X)</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Time coordinate of forecast is adjusted to match the expected seasonal month
based on the first timestep of rainfall observations.</p></li>
<li><p>All interpolations use ‘nearest’ method with extrapolation for boundary points.</p></li>
<li><p>Final output is masked using the spatial coverage of observed rainfall.</p></li>
<li><p>Models with NaN scores or failed interpolation will contribute zero weight.</p></li>
<li><p>The stepwise weighting is currently hardcoded (0.6 / 0.8 / 1.0 breakpoints).</p></li>
<li><p>It’s only for GROC currently.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>Make sure that model names in <cite>hdcst.M</cite>, <cite>fcst.M</cite> and <cite>scores.keys()</cite> match exactly.</p></li>
<li><p>Performance may degrade if score grids have very different resolution/spatial extent
from the rainfall target grid.</p></li>
</ul>
</div>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_MLP</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">search_method='random',</span> <span class="pre">hidden_layer_sizes_range=[(10,),</span> <span class="pre">(10,</span> <span class="pre">5),</span> <span class="pre">(20,</span> <span class="pre">10)],</span> <span class="pre">activation_options=['relu',</span> <span class="pre">'tanh',</span> <span class="pre">'logistic'],</span> <span class="pre">learning_rate_init_range=&lt;scipy.stats._distn_infrastructure.rv_continuous_frozen</span> <span class="pre">object&gt;,</span> <span class="pre">solver_options=['adam',</span> <span class="pre">'sgd',</span> <span class="pre">'lbfgs'],</span> <span class="pre">alpha_range=[0.0001,</span> <span class="pre">0.001,</span> <span class="pre">0.01,</span> <span class="pre">0.1],</span> <span class="pre">max_iter=200,</span> <span class="pre">random_state=42,</span> <span class="pre">dist_method='nonparam',</span> <span class="pre">n_iter_search=10,</span> <span class="pre">cv_folds=3,</span> <span class="pre">n_clusters=4,</span> <span class="pre">optuna_n_jobs=1,</span> <span class="pre">optuna_timeout=None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Multi-Layer Perceptron (MLP) for Multi-Model Ensemble (MME) forecasting.
This class implements a Multi-Layer Perceptron model using scikit-learn’s MLPRegressor
for deterministic forecasting, with optional tercile probability calculations using
various statistical distributions. Implements multiple hyperparameter optimization methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘grid’, ‘random’, or ‘bayesian’ (default: ‘random’).</p></li>
<li><p><strong>hidden_layer_sizes_range</strong> (<em>list</em><em> of </em><em>tuples</em><em>, </em><em>optional</em>) – List of hidden layer sizes to tune, e.g., [(10,), (10, 5), (20, 10)] (default).</p></li>
<li><p><strong>activation_options</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Activation functions to tune (‘identity’, ‘logistic’, ‘tanh’, ‘relu’) (default is [‘relu’, ‘tanh’, ‘logistic’]).</p></li>
<li><p><strong>solver_options</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Solvers to tune (‘lbfgs’, ‘sgd’, ‘adam’) (default is [‘adam’, ‘sgd’, ‘lbfgs’]).</p></li>
<li><p><strong>alpha_range</strong> (<em>list</em><em> of </em><em>float</em><em>, </em><em>optional</em>) – L2 regularization parameters to tune (default is [0.0001, 0.001, 0.01, 0.1]).</p></li>
<li><p><strong>learning_rate_init_range</strong> (<em>list</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – Learning rate initialization range for random/bayesian search (default is loguniform(0.0001, 0.01)).
For grid search, provide a list of values.</p></li>
<li><p><strong>max_iter</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum iterations (default is 200).</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities (‘bestfit’, ‘nonparam’) (default is ‘nonparam’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized/bayesian search (default is 10).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of clusters for homogenized zones (default is 4).</p></li>
<li><p><strong>optuna_n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of parallel jobs for Optuna (default is 1).</p></li>
<li><p><strong>optuna_timeout</strong> (<em>int</em><em>, </em><em>optional</em>) – Timeout in seconds for Optuna optimization (default is None).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Independently computes the best hyperparameters using selected optimization method
on stacked training data for each homogenized zone.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_params_dict</strong> (<em>dict</em>) – Best hyperparameters for each cluster.</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels with dimensions (Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the MLP model with injected hyperparameters for each zone.
:param X_train: Training predictor data with dimensions (T, M, Y, X).
:type X_train: xarray.DataArray
:param y_train: Training predictand data with dimensions (T, Y, X).
:type y_train: xarray.DataArray
:param X_test: Testing predictor data with dimensions (T, M, Y, X).
:type X_test: xarray.DataArray
:param y_test: Testing predictand data with dimensions (T, Y, X).
:type y_test: xarray.DataArray
:param clim_year_start: Start year of the climatology period.
:type clim_year_start: int
:param clim_year_end: End year of the climatology period.
:type clim_year_end: int
:param best_params: Pre-computed best hyperparameters per cluster. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate deterministic and probabilistic forecast for a target year using the MLP model with injected hyperparameters.
Stacks and cleans the data, uses provided best_params (or computes if None),
fits the final MLP with best params, predicts for the target year, reverses standardization,
and computes tercile probabilities.
:param Predictant: Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).
:type Predictant: xarray.DataArray
:param clim_year_start: Start year of the climatology period.
:type clim_year_start: int or str
:param clim_year_end: End year of the climatology period.
:type clim_year_end: int or str
:param hindcast_det: Deterministic hindcast data for training with dimensions (T, M, Y, X).
:type hindcast_det: xarray.DataArray
:param hindcast_det_cross: Deterministic hindcast data for error estimation with dimensions (T, Y, X).
:type hindcast_det_cross: xarray.DataArray
:param Predictor_for_year: Predictor data for the target year with dimensions (T, M, Y, X).
:type Predictor_for_year: xarray.DataArray
:param best_params: Pre-computed best hyperparameters. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_MLP_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">search_method='random',</span> <span class="pre">hidden_layer_sizes_range=[(10,),</span> <span class="pre">(10,</span> <span class="pre">5),</span> <span class="pre">(20,</span> <span class="pre">10)],</span> <span class="pre">learning_rate_init_range=&lt;scipy.stats._distn_infrastructure.rv_continuous_frozen</span> <span class="pre">object&gt;,</span> <span class="pre">activation_options=['relu',</span> <span class="pre">'tanh',</span> <span class="pre">'logistic'],</span> <span class="pre">solver_options=['adam',</span> <span class="pre">'sgd',</span> <span class="pre">'lbfgs'],</span> <span class="pre">alpha_range=[0.0001,</span> <span class="pre">0.001,</span> <span class="pre">0.01,</span> <span class="pre">0.1],</span> <span class="pre">max_iter=200,</span> <span class="pre">random_state=42,</span> <span class="pre">dist_method='nonparam',</span> <span class="pre">n_iter_search=10,</span> <span class="pre">cv_folds=3,</span> <span class="pre">optuna_n_jobs=1,</span> <span class="pre">optuna_timeout=None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Multi-Layer Perceptron (MLP) for Multi-Model Ensemble (MME) forecasting.
This class implements a Multi-Layer Perceptron model using scikit-learn’s MLPRegressor
for deterministic forecasting, with optional tercile probability calculations using
various statistical distributions. Implements multiple hyperparameter optimization methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘grid’, ‘random’, or ‘bayesian’ (default: ‘random’).</p></li>
<li><p><strong>hidden_layer_sizes_range</strong> (<em>list</em><em> of </em><em>tuples</em><em>, </em><em>optional</em>) – List of hidden layer sizes to tune, e.g., [(10,), (10, 5), (20, 10)] (default).</p></li>
<li><p><strong>activation_options</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Activation functions to tune (‘identity’, ‘logistic’, ‘tanh’, ‘relu’) (default is [‘relu’, ‘tanh’, ‘logistic’]).</p></li>
<li><p><strong>solver_options</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Solvers to tune (‘lbfgs’, ‘sgd’, ‘adam’) (default is [‘adam’, ‘sgd’, ‘lbfgs’]).</p></li>
<li><p><strong>alpha_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – L2 regularization parameters to tune (default is [0.0001, 0.001, 0.01, 0.1]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>learning_rate_init_range</strong> (<em>list</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – Learning rate initialization range (default is loguniform(0.0001, 0.01)).
For grid search, provide a list of values.</p></li>
<li><p><strong>max_iter</strong> (<em>int</em><em>, </em><em>optional</em>) – Maximum iterations (default is 200).</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities (‘bestfit’, ‘nonparam’, etc.) (default is ‘nonparam’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized/bayesian search or points to sample for grid search (default is 10).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
<li><p><strong>optuna_n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of parallel jobs for Optuna (default is 1).</p></li>
<li><p><strong>optuna_timeout</strong> (<em>int</em><em>, </em><em>optional</em>) – Timeout in seconds for Optuna optimization (default is None).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Independently computes the best hyperparameters using selected optimization method
on stacked training data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Best hyperparameters found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the MLP model with injected hyperparameters.</p>
<p>Stacks and cleans the data, uses provided best_params (or computes if None),
fits the final MLP with best params, and predicts on test data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Testing predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Testing predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate deterministic and probabilistic forecast for a target year using the MLP model with injected hyperparameters.</p>
<p>Stacks and cleans the data, uses provided best_params (or computes if None),
fits the final MLP with best params, predicts for the target year, reverses standardization,
and computes tercile probabilities.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for training with dimensions (T, M, Y, X).</p></li>
<li><p><strong>hindcast_det_cross</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for error estimation with dimensions (T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the target year with dimensions (T, M, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MLP_.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MLP_.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MVA">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_MVA</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'bestfit'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'nonparam'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'nonparam'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MVA" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Method 1 of Torralba et al. (2017) (MVA): rescales ensemble to match obs mean &amp; std.
Assumes both reference and predicted distributions are approximately Gaussian.</p>
<dl class="simple">
<dt>Expected dims:</dt><dd><p>hindcast: (M, T, Y, X)
obs     : (T, Y, X)
forecast: (M, T, Y, X)</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">fit(hindcast,</span> <span class="pre">obs)</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">transform(forecast)</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">fit_transform_loocv(hindcast,</span> <span class="pre">obs)</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">compute_prob(Predictant,</span> <span class="pre">clim_year_start,</span> <span class="pre">clim_year_end,</span> <span class="pre">hindcast_det,</span> <span class="pre">...)</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">-</span> <span class="pre">forecast(Predictant,</span> <span class="pre">clim_year_start,</span> <span class="pre">clim_year_end,</span> <span class="pre">hindcast_det,</span> <span class="pre">forecast_det,</span> <span class="pre">...)</span></span></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MVA.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_cross</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MVA.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><p>derive climatological terciles analytically from (best_code/shape/loc/scale)
and compute predictive probabilities with the same family.</p></li>
</ul>
</dd>
<dt>Else (‘nonparam’):</dt><dd><ul class="simple">
<li><p>use empirical terciles and historical error samples.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MVA.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hindcast</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#wass2s.was_mme.WAS_mme_MVA" title="wass2s.was_mme.WAS_mme_MVA"><span class="pre">WAS_mme_MVA</span></a></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MVA.fit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MVA.fit_transform_loocv">
<span class="sig-name descname"><span class="pre">fit_transform_loocv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hindcast</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MVA.fit_transform_loocv" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MVA.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_cross</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forecast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MVA.forecast" title="Link to this definition"></a></dt>
<dd><p>Calibrate forecast and return (calibrated_deterministic_mean, tercile_probs).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MVA.predict_mean">
<span class="sig-name descname"><span class="pre">predict_mean</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">forecast</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MVA.predict_mean" title="Link to this definition"></a></dt>
<dd><p>Calibrate members then return ensemble mean over M: (T,Y,X).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_MVA.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">forecast</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_MVA.transform" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_NGR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'NGR'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">apply_to</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'all'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'two-sided'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param_bounds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Operational WAS_mme_NGR calibration for ensemble post-processing.</p>
<p>Implements Non-homogeneous Gaussian Regression (NGR) with two variants:
- “NGR”: Minimize Gaussian CRPS (parametric)
- “ensNGR”: Minimize ensemble CRPS (non-parametric)</p>
<p>The calibration model:
μ = a + b * ensemble_mean
σ = sqrt(c² + d² * ensemble_variance)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>type</strong> (<em>{'NGR'</em><em>, </em><em>'ensNGR'}</em><em>, </em><em>default='NGR'</em>) – CRPS minimization method</p></li>
<li><p><strong>apply_to</strong> (<em>{'all'</em><em>, </em><em>'sig'</em><em>, </em><em>'pos'</em><em>, </em><em>'neg'}</em><em>, </em><em>default='all'</em>) – When to apply calibration:
- ‘all’: Always apply calibration
- ‘sig’: Only apply if regression is statistically significant
- ‘pos’: Only apply if positive correlation is significant
- ‘neg’: Only apply if negative correlation is significant</p></li>
<li><p><strong>alpha</strong> (<em>float</em><em>, </em><em>default=0.1</em>) – Significance level for statistical tests (0 &lt; alpha &lt; 1)</p></li>
<li><p><strong>test_direction</strong> (<em>{'two-sided'</em><em>, </em><em>'greater'</em><em>, </em><em>'less'}</em><em>, </em><em>default='two-sided'</em>) – Direction of statistical test for regression significance</p></li>
<li><p><strong>param_bounds</strong> (<em>dict</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Custom bounds for parameters [a, b, c, d]
Example: {‘a’: (-10, 10), ‘b’: (0, 5), ‘c’: (0, 5), ‘d’: (0, 5)}</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.params">
<span class="sig-name descname"><span class="pre">params</span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.params" title="Link to this definition"></a></dt>
<dd><p>Calibration parameters [a, b, c, d]</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray or numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.clim_terciles">
<span class="sig-name descname"><span class="pre">clim_terciles</span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.clim_terciles" title="Link to this definition"></a></dt>
<dd><p>Climate terciles computed from observations</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray or numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.fitted">
<span class="sig-name descname"><span class="pre">fitted</span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.fitted" title="Link to this definition"></a></dt>
<dd><p>Whether the model has been fitted</p>
<dl class="field-list simple">
<dt class="field-odd">Type<span class="colon">:</span></dt>
<dd class="field-odd"><p>bool</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.DEFAULT_BOUNDS">
<span class="sig-name descname"><span class="pre">DEFAULT_BOUNDS</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'a':</span> <span class="pre">(-inf,</span> <span class="pre">inf),</span> <span class="pre">'b':</span> <span class="pre">(0.0,</span> <span class="pre">inf),</span> <span class="pre">'c':</span> <span class="pre">(0.0,</span> <span class="pre">inf),</span> <span class="pre">'d':</span> <span class="pre">(0.0,</span> <span class="pre">inf)}</span></em><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.DEFAULT_BOUNDS" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hcst_grid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_grid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.fit" title="Link to this definition"></a></dt>
<dd><p>Fit calibration parameters using hindcast data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>hcst_grid</strong> (<em>xarray.DataArray</em><em> or </em><em>numpy.ndarray</em>) – Hindcast ensemble data with dimensions (member, time, lat, lon)</p></li>
<li><p><strong>obs_grid</strong> (<em>xarray.DataArray</em><em> or </em><em>numpy.ndarray</em>) – Observations with dimensions (time, lat, lon)</p></li>
<li><p><strong>clim_terciles</strong> (<em>bool</em><em>, </em><em>default=False</em>) – Compute climate terciles from observations</p></li>
<li><p><strong>member_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>time_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>lat_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>lon_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>show_progress</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Show progress bar during fitting</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>self</strong> – Fitted model</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="#wass2s.was_mme.WAS_mme_NGR" title="wass2s.was_mme.WAS_mme_NGR">WAS_mme_NGR</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.get_optimization_stats">
<span class="sig-name descname"><span class="pre">get_optimization_stats</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.get_optimization_stats" title="Link to this definition"></a></dt>
<dd><p>Get optimization statistics from fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>stats</strong> – Dictionary containing optimization statistics if model is fitted</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict or None</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fcst_grid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantiles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_terciles</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parametric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show_progress</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.predict" title="Link to this definition"></a></dt>
<dd><p>Apply calibration and compute requested outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fcst_grid</strong> (<em>xarray.DataArray</em><em> or </em><em>numpy.ndarray</em>) – Forecast ensemble data</p></li>
<li><p><strong>quantiles</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Quantile levels to compute (e.g., [0.05, 0.5, 0.95])</p></li>
<li><p><strong>clim_terciles</strong> (<em>bool</em><em>, </em><em>default=False</em>) – Compute tercile probabilities</p></li>
<li><p><strong>parametric</strong> (<em>bool</em><em> or </em><em>None</em><em>, </em><em>default=None</em>) – Use parametric (Gaussian) method for quantiles/terciles
If None, uses the model type (NGR=parametric, ensNGR=non-parametric)</p></li>
<li><p><strong>member_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>time_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>lat_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>lon_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>show_progress</strong> (<em>bool</em><em>, </em><em>default=True</em>) – Show progress bar</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>results</strong> – Calibrated products</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset or tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.predict_fast">
<span class="sig-name descname"><span class="pre">predict_fast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fcst_grid</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.predict_fast" title="Link to this definition"></a></dt>
<dd><p>Accelerated prediction using Numba (if available).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.summary">
<span class="sig-name descname"><span class="pre">summary</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.summary" title="Link to this definition"></a></dt>
<dd><p>Print summary of the fitted model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_NGR.transform">
<span class="sig-name descname"><span class="pre">transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fcst_grid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">member_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'M'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'X'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_NGR.transform" title="Link to this definition"></a></dt>
<dd><p>Apply calibration to forecast data (returns calibrated ensemble only).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fcst_grid</strong> (<em>xarray.DataArray</em><em> or </em><em>numpy.ndarray</em>) – Forecast ensemble data</p></li>
<li><p><strong>member_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>time_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>lat_dim</strong> (<em>str</em>) – Dimension names</p></li>
<li><p><strong>lon_dim</strong> (<em>str</em>) – Dimension names</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>cal_ens</strong> (<em>xarray.DataArray or numpy.ndarray</em>) – Calibrated ensemble</p></li>
<li><p><strong>mu</strong> (<em>xarray.DataArray or numpy.ndarray</em>) – Calibrated mean</p></li>
<li><p><strong>sigma</strong> (<em>xarray.DataArray or numpy.ndarray</em>) – Calibrated standard deviation</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_RF</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_estimators_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[50,</span> <span class="pre">100,</span> <span class="pre">200,</span> <span class="pre">300]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_depth_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[None,</span> <span class="pre">10,</span> <span class="pre">20,</span> <span class="pre">30]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples_split_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2,</span> <span class="pre">5,</span> <span class="pre">10]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples_leaf_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">4]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_features_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[None,</span> <span class="pre">'sqrt',</span> <span class="pre">'log2',</span> <span class="pre">0.33,</span> <span class="pre">0.5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optuna_n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optuna_timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Random Forest-based Multi-Model Ensemble (MME) forecasting.
This class implements a single-model forecasting approach using scikit-learn’s RandomForestRegressor
for deterministic predictions, with optional tercile probability calculations using
various statistical distributions. Implements multiple hyperparameter optimization methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘grid’, ‘random’, or ‘bayesian’ (default: ‘random’).</p></li>
<li><p><strong>n_estimators_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of n_estimators values to tune (default is [50, 100, 200, 300]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>max_depth_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of max depths to tune (default is [None, 10, 20, 30]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>min_samples_split_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of minimum samples required to split to tune (default is [2, 5, 10]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>min_samples_leaf_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of minimum samples required at leaf node to tune (default is [1, 2, 4]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>max_features_range</strong> (<em>list</em><em> of </em><em>str</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – List of max features to tune (default is [None, ‘sqrt’, 0.33, 0.5]).</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities (‘bestfit’, ‘nonparam’, etc.) (default is ‘nonparam’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized/bayesian search or points to sample for grid search (default is 10).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of clusters for homogenized zones (default is 4).</p></li>
<li><p><strong>optuna_n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of parallel jobs for Optuna (default is 1).</p></li>
<li><p><strong>optuna_timeout</strong> (<em>int</em><em>, </em><em>optional</em>) – Timeout in seconds for Optuna optimization (default is None).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Independently computes the best hyperparameters using selected optimization method
on stacked training data for each homogenized zone.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_params_dict</strong> (<em>dict</em>) – Best hyperparameters for each cluster.</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels with dimensions (Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the RandomForestRegressor model with injected hyperparameters for each zone.
:param X_train: Training predictor data with dimensions (T, M, Y, X).
:type X_train: xarray.DataArray
:param y_train: Training predictand data with dimensions (T, Y, X).
:type y_train: xarray.DataArray
:param X_test: Testing predictor data with dimensions (T, M, Y, X).
:type X_test: xarray.DataArray
:param y_test: Testing predictand data with dimensions (T, Y, X).
:type y_test: xarray.DataArray
:param clim_year_start: Start year of the climatology period.
:type clim_year_start: int
:param clim_year_end: End year of the climatology period.
:type clim_year_end: int
:param best_params: Pre-computed best hyperparameters per cluster. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF.forecast" title="Link to this definition"></a></dt>
<dd><p>Forecast method using a single Random Forest model with optimized hyperparameters.
:param Predictant: Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).
:type Predictant: xarray.DataArray
:param clim_year_start: Start year of the climatology period.
:type clim_year_start: int or str
:param clim_year_end: End year of the climatology period.
:type clim_year_end: int or str
:param hindcast_det: Deterministic hindcast data for training with dimensions (T, M, Y, X).
:type hindcast_det: xarray.DataArray
:param hindcast_det_cross: Deterministic hindcast data for error estimation with dimensions (T, Y, X).
:type hindcast_det_cross: xarray.DataArray
:param Predictor_for_year: Predictor data for the target year with dimensions (T, M, Y, X).
:type Predictor_for_year: xarray.DataArray
:param best_params: Pre-computed best hyperparameters. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_RF_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_estimators_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[50,</span> <span class="pre">100,</span> <span class="pre">200,</span> <span class="pre">300]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_depth_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[None,</span> <span class="pre">10,</span> <span class="pre">20,</span> <span class="pre">30]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples_split_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[2,</span> <span class="pre">5,</span> <span class="pre">10]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_samples_leaf_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">2,</span> <span class="pre">4]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_features_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[None,</span> <span class="pre">'sqrt',</span> <span class="pre">'log2',</span> <span class="pre">0.33,</span> <span class="pre">0.5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Random Forest-based Multi-Model Ensemble (MME) forecasting.
This class implements a single-model forecasting approach using scikit-learn’s RandomForestRegressor
for deterministic predictions, with optional tercile probability calculations using
various statistical distributions. Implements multiple hyperparameter optimization methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_estimators_range</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – List of n_estimators values to tune (default is [50, 100, 200, 300]).</p></li>
<li><p><strong>max_depth_range</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – List of max depths to tune (default is [None, 10, 20, 30]).</p></li>
<li><p><strong>min_samples_split_range</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – List of minimum samples required to split to tune (default is [2, 5, 10]).</p></li>
<li><p><strong>min_samples_leaf_range</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – List of minimum samples required at leaf node to tune (default is [1, 2, 4]).</p></li>
<li><p><strong>max_features_range</strong> (<em>list</em><em> of </em><em>str</em><em> or </em><em>float</em><em>, </em><em>optional</em>) – List of max features to tune (default is [None, ‘sqrt’, 0.33, 0.5]).</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities (‘bestfit’, ‘nonparam’, etc.) (default is ‘nonparam’).</p></li>
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘random’ (RandomizedSearchCV),
‘grid’ (GridSearchCV), or ‘bayesian’ (Optuna) (default is ‘random’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized search (default is 10).</p></li>
<li><p><strong>n_trials</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of trials for Bayesian optimization with Optuna (default is 100).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Independently computes the best hyperparameters using selected optimization method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Best hyperparameters found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the RandomForestRegressor model with injected hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Testing predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Testing predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_.forecast" title="Link to this definition"></a></dt>
<dd><p>Forecast method using a single Random Forest model with optimized hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for training with dimensions (T, M, Y, X).</p></li>
<li><p><strong>hindcast_det_cross</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for error estimation with dimensions (T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the target year with dimensions (T, M, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_RF_.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_RF_.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Roebber2015">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_Roebber2015</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="#wass2s.was_mme.Roebber2015Config" title="wass2s.was_mme.Roebber2015Config"><span class="pre">Roebber2015Config</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">Roebber2015Config(population_size=50,</span> <span class="pre">num_genes=10,</span> <span class="pre">max_iter=100,</span> <span class="pre">max_mates_per_male=10,</span> <span class="pre">qualify_quantile=0.5,</span> <span class="pre">tighten_factor=0.97,</span> <span class="pre">relax_factor=1.1,</span> <span class="pre">min_qualify=10,</span> <span class="pre">p_mutation=0.5,</span> <span class="pre">p_transposition=0.5,</span> <span class="pre">random_state=42)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Roebber2015" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Procedurally faithful Roebber (2015) EP / GA trainer for gridded xarray inputs.</p>
<blockquote>
<div><ul class="simple">
<li><p>sexual selection mating system</p></li>
<li><p>paternal coefficients retained in crossover</p></li>
<li><p>mutation + transposition rules</p></li>
<li><p>probabilistic output uses surviving population predictions</p></li>
</ul>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Roebber2015.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_ensemble</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_members</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">DataArray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Roebber2015.compute_model" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>(T,Y,X) mean of survivors’ predictions
y_ens:  (member,T,Y,X) survivors’ predictions (optional)</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>y_mean</p>
</dd>
</dl>
<p>Note: This is <em>probabilistic</em> by construction (survivors define predictive distribution).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Roebber2015.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">DataArray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Roebber2015.forecast" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Roebber2015.tercile_probs_from_ensemble">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">tercile_probs_from_ensemble</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ens</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q33</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q66</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Roebber2015.tercile_probs_from_ensemble" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Roebber2015.tercile_thresholds_from_obs">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">tercile_thresholds_from_obs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">DataArray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">DataArray</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Roebber2015.tercile_thresholds_from_obs" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_Stacking</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meta_learner_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ridge'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1_ratio_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stacking_cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Stacking ensemble for Multi-Model Ensemble (MME) forecasting.</p>
<dl>
<dt>Base models (fixed in this implementation):</dt><dd><ul class="simple">
<li><p>WAS_mme_hpELM</p></li>
<li><p>WAS_mme_MLP</p></li>
<li><p>WAS_mme_XGBoosting</p></li>
<li><p>WAS_mme_RF</p></li>
</ul>
</dd>
<dt>Each base model is expected to expose:</dt><dd><ul>
<li><dl class="simple">
<dt>compute_hyperparameters(Predictors, Predictand, clim_year_start, clim_year_end)</dt><dd><p>-&gt; (best_params_per_cluster: dict[int, dict], cluster_da: xr.DataArray[Y,X])</p>
</dd>
</dl>
</li>
<li><dl>
<dt>compute_model(X_train, y_train, X_test, y_test,</dt><dd><blockquote>
<div><p>best_params=best_params_per_cluster,
cluster_da=cluster_da)</p>
</div></blockquote>
<p>-&gt; xr.DataArray[T,Y,X] deterministic predictions</p>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>This class:</dt><dd><ol class="arabic simple">
<li><p>Computes/uses hyperparameters for each base &amp; cluster.</p></li>
<li><p>Builds out-of-fold (OOF) predictions per base on training data.</p></li>
<li><p>Trains a meta-learner separately for each cluster.</p></li>
<li><dl class="simple">
<dt>For new data (hindcast test or forecast), predicts via:</dt><dd><p>meta( base_1_pred, base_2_pred, base_3_pred, base_4_pred )</p>
</dd>
</dl>
</li>
<li><p>Provides tercile probabilities via compute_prob / forecast.</p></li>
</ol>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Run each base model’s hyperparameter search.
Use clustering from the first base model as the common cluster_da.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking.compute_model" title="Link to this definition"></a></dt>
<dd><p>Train stacked model on (X_train, y_train) and predict on X_test.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>provided</strong> (<em>- If best_params &amp; cluster_da are</em>)</p></li>
<li><p><strong>used.</strong> (<em>they are</em>)</p></li>
<li><p><strong>Otherwise</strong> (<em>-</em>) – order to compute base hyperparameters.</p></li>
<li><p><strong>in</strong> (<em>clim_year_start &amp; clim_year_end must be given</em>) – order to compute base hyperparameters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>xr.DataArray[T,Y,X] predictions on X_test.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for stacked deterministic hindcasts.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking.forecast" title="Link to this definition"></a></dt>
<dd><p>One-step forecast for target year using stacking.</p>
<p>Mirrors pattern of other WAS_mme_* classes:
- uses hindcast_det as training predictors
- uses Predictor_for_year as new predictors
- reuses per-base hyperparameters &amp; cluster_da
- meta-learners trained on standardized hindcast period</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_Stacking_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">meta_learner_type</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'ridge'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l1_ratio_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stacking_cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meta_n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Stacking ensemble for Multi-Model Ensemble (MME) forecasting using provided base models.
Stacks <a href="#id37"><span class="problematic" id="id38">hpELM_</span></a>, <a href="#id39"><span class="problematic" id="id40">MLP_</span></a>, <a href="#id41"><span class="problematic" id="id42">XGBoosting_</span></a>, <a href="#id43"><span class="problematic" id="id44">RF_</span></a> via a meta-learner (ridge/lasso/elasticnet/linear).
Supports deterministic and probabilistic (tercile) outputs.</p>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Nonparametric terciles using historical error samples (gridwise, vectorized over T).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Collect per-base best params (no clustering assumed for underscore bases).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_.compute_model" title="Link to this definition"></a></dt>
<dd><p>Fit stacking on training (using OOF), then predict on X_test.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.
Returns (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_.forecast" title="Link to this definition"></a></dt>
<dd><p>One-step forecast for target period using stacking; returns (deterministic, probabilities).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Stacking_.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Stacking_.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Root for Weibull shape k: (Gamma(1+2/k)/Gamma(1+1/k)^2 - 1) - V/M^2 = 0</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_Weighted</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">equal_weighted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'GROC'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Weighted Multi-Model Ensemble (MME) for climate forecasting.</p>
<p>This class implements a weighted ensemble approach for combining multiple climate models,
supporting both equal weighting and score-based weighting. It also provides methods for
computing tercile probabilities using various statistical distributions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>equal_weighted</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use equal weights for all models; otherwise, use score-based weights. Default is False.</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Statistical distribution for probability calculations (‘t’, ‘gamma’, ‘normal’, ‘lognormal’,
‘weibull_min’, ‘nonparam’). Default is ‘gamma’.</p></li>
<li><p><strong>metric</strong> (<em>str</em><em>, </em><em>optional</em>) – Performance metric for weighting (‘MAE’, ‘Pearson’, ‘GROC’). Default is ‘GROC’.</p></li>
<li><p><strong>threshold</strong> (<em>float</em><em>, </em><em>optional</em>) – Threshold for score transformation. Default is 0.5.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted.compute">
<span class="sig-name descname"><span class="pre">compute</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rainfall</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdcst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fcst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scores</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">complete</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted.compute" title="Link to this definition"></a></dt>
<dd><p>Compute weighted hindcast and forecast using model scores.</p>
<p>This method calculates weighted averages of hindcast and forecast data based on model scores.
If <cite>complete</cite> is True, missing values are filled with unweighted averages.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rainfall</strong> (<em>xarray.DataArray</em>) – Observed rainfall data with dimensions (T, Y, X, M).</p></li>
<li><p><strong>hdcst</strong> (<em>xarray.DataArray</em>) – Hindcast data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>fcst</strong> (<em>xarray.DataArray</em>) – Forecast data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>scores</strong> (<em>dict</em>) – Dictionary mapping model names to score arrays.</p></li>
<li><p><strong>complete</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, fill missing values with unweighted averages. Default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Weighted hindcast data with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Weighted forecast data with dimensions (T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forecast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted.forecast" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted.transform_score">
<span class="sig-name descname"><span class="pre">transform_score</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">score_array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted.transform_score" title="Link to this definition"></a></dt>
<dd><p>Transform score array based on the chosen metric and threshold.</p>
<p>For ‘MAE’, scores below the threshold are set to 1, others to 0. For ‘Pearson’ or ‘GROC’,
scores above the threshold are set to 1, others to 0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>score_array</strong> (<em>xarray.DataArray</em>) – Score array to transform.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>transformed_score</strong> – Transformed score array with binary weights.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_Weighted.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_Weighted.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_XGBoosting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_estimators_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[50,</span> <span class="pre">100,</span> <span class="pre">200,</span> <span class="pre">300]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_rate_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.01,</span> <span class="pre">0.05,</span> <span class="pre">0.1,</span> <span class="pre">0.2]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_depth_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[3,</span> <span class="pre">5,</span> <span class="pre">7,</span> <span class="pre">9]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_child_weight_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">3,</span> <span class="pre">5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.6,</span> <span class="pre">0.8,</span> <span class="pre">1.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colsample_bytree_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.6,</span> <span class="pre">0.8,</span> <span class="pre">1.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optuna_n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optuna_timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>XGBoost-based Multi-Model Ensemble (MME) forecasting.
This class implements a single-model forecasting approach using XGBoost’s XGBRegressor
for deterministic predictions, with optional tercile probability calculations using
various statistical distributions. Implements multiple hyperparameter optimization methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘grid’, ‘random’, or ‘bayesian’ (default: ‘random’).</p></li>
<li><p><strong>n_estimators_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of n_estimators values to tune (default is [50, 100, 200, 300]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>learning_rate_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of learning rates to tune (default is [0.01, 0.05, 0.1, 0.2]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>max_depth_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of max depths to tune (default is [3, 5, 7, 9]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>min_child_weight_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of minimum child weights to tune (default is [1, 3, 5]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>subsample_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of subsample ratios to tune (default is [0.6, 0.8, 1.0]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>colsample_bytree_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of column sampling ratios to tune (default is [0.6, 0.8, 1.0]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities (‘bestfit’, ‘nonparam’, etc.) (default is ‘nonparam’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized/bayesian search or points to sample for grid search (default is 10).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of clusters for homogenized zones (default is 4).</p></li>
<li><p><strong>optuna_n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of parallel jobs for Optuna (default is 1).</p></li>
<li><p><strong>optuna_timeout</strong> (<em>int</em><em>, </em><em>optional</em>) – Timeout in seconds for Optuna optimization (default is None).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Independently computes the best hyperparameters using selected optimization method
on stacked training data for each homogenized zone.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_params_dict</strong> (<em>dict</em>) – Best hyperparameters for each cluster.</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels with dimensions (Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the XGBRegressor model with injected hyperparameters for each zone.
:param X_train: Training predictor data with dimensions (T, M, Y, X).
:type X_train: xarray.DataArray
:param y_train: Training predictand data with dimensions (T, Y, X).
:type y_train: xarray.DataArray
:param X_test: Testing predictor data with dimensions (T, M, Y, X).
:type X_test: xarray.DataArray
:param y_test: Testing predictand data with dimensions (T, Y, X).
:type y_test: xarray.DataArray
:param clim_year_start: Start year of the climatology period.
:type clim_year_start: int
:param clim_year_end: End year of the climatology period.
:type clim_year_end: int
:param best_params: Pre-computed best hyperparameters per cluster. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting.forecast" title="Link to this definition"></a></dt>
<dd><p>Forecast method using a single XGBoost model with optimized hyperparameters.
:param Predictant: Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).
:type Predictant: xarray.DataArray
:param clim_year_start: Start year of the climatology period.
:type clim_year_start: int or str
:param clim_year_end: End year of the climatology period.
:type clim_year_end: int or str
:param hindcast_det: Deterministic hindcast data for training with dimensions (T, M, Y, X).
:type hindcast_det: xarray.DataArray
:param hindcast_det_cross: Deterministic hindcast data for error estimation with dimensions (T, Y, X).
:type hindcast_det_cross: xarray.DataArray
:param Predictor_for_year: Predictor data for the target year with dimensions (T, M, Y, X).
:type Predictor_for_year: xarray.DataArray
:param best_params: Pre-computed best hyperparameters. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_XGBoosting_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_estimators_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[50,</span> <span class="pre">100,</span> <span class="pre">200,</span> <span class="pre">300]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_rate_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.01,</span> <span class="pre">0.05,</span> <span class="pre">0.1,</span> <span class="pre">0.2]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_depth_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[3,</span> <span class="pre">5,</span> <span class="pre">7,</span> <span class="pre">9]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_child_weight_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[1,</span> <span class="pre">3,</span> <span class="pre">5]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subsample_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.6,</span> <span class="pre">0.8,</span> <span class="pre">1.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colsample_bytree_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.6,</span> <span class="pre">0.8,</span> <span class="pre">1.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optuna_n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optuna_timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>XGBoost-based Multi-Model Ensemble (MME) forecasting.
This class implements a single-model forecasting approach using XGBoost’s XGBRegressor
for deterministic predictions, with optional tercile probability calculations using
various statistical distributions. Implements multiple hyperparameter optimization methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘grid’, ‘random’, or ‘bayesian’ (default: ‘random’).</p></li>
<li><p><strong>n_estimators_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of n_estimators values to tune (default is [50, 100, 200, 300]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>learning_rate_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of learning rates to tune (default is [0.01, 0.05, 0.1, 0.2]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>max_depth_range</strong> (<em>list</em><em> of </em><em>int</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of max depths to tune (default is [3, 5, 7, 9]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>min_child_weight_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of minimum child weights to tune (default is [1, 3, 5]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>subsample_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of subsample ratios to tune (default is [0.6, 0.8, 1.0]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>colsample_bytree_range</strong> (<em>list</em><em> of </em><em>float</em><em> or </em><em>scipy.stats distribution</em><em>, </em><em>optional</em>) – List of column sampling ratios to tune (default is [0.6, 0.8, 1.0]).
Can be a list for grid search or a distribution for random/bayesian search.</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities (‘bestfit’, ‘nonparam’, etc.) (default is ‘nonparam’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized/bayesian search or points to sample for grid search (default is 10).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
<li><p><strong>optuna_n_jobs</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of parallel jobs for Optuna (default is 1).</p></li>
<li><p><strong>optuna_timeout</strong> (<em>int</em><em>, </em><em>optional</em>) – Timeout in seconds for Optuna optimization (default is None).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Independently computes the best hyperparameters using selected optimization method
on stacked training data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Best hyperparameters found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the XGBRegressor model with injected hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Testing predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Testing predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_.forecast" title="Link to this definition"></a></dt>
<dd><p>Forecast method using a single XGBoost model with optimized hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for training with dimensions (T, M, Y, X).</p></li>
<li><p><strong>hindcast_det_cross</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for error estimation with dimensions (T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the target year with dimensions (T, M, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_XGBoosting_.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_XGBoosting_.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_gaussian_process">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_gaussian_process</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kernel_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_restarts_optimizer_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">2)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iter_predict_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(100,</span> <span class="pre">200)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_train_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hpo_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_random_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warm_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_gaussian_process" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Gaussian Process Classifier MME (multiclass via One-vs-Rest in sklearn).</p>
<dl class="simple">
<dt>This class mirrors the structure of WAS_mme_logistic:</dt><dd><ul class="simple">
<li><p>cluster the predictand time series (per gridpoint) -&gt; cluster_da</p></li>
<li><p>for each cluster: stack samples (T,Y,X), fit a classifier, predict class + proba</p></li>
<li><p>reconstruct to (T,Y,X) and return deterministic forecast + tercile probabilities</p></li>
</ul>
</dd>
</dl>
<p>IMPORTANT: GP classification scales cubically with N samples. To avoid infeasible runs,
we subsample per cluster to max_train_samples during training and HPO.</p>
<dl class="simple">
<dt>Supports three hyperparameter optimization methods:</dt><dd><ul class="simple">
<li><p>‘grid’: GridSearchCV (default)</p></li>
<li><p>‘random’: RandomizedSearchCV</p></li>
<li><p>‘bayesian’: Optuna Bayesian optimization</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_gaussian_process.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_gaussian_process.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Computes best hyperparameters using selected HPO method.</p>
<p>NOTE: As in your logistic version, this uses pre-standardized data.
That preserves your current behavior but can introduce leakage if the
standardization includes information beyond each CV fold.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_gaussian_process.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_gaussian_process.compute_model" title="Link to this definition"></a></dt>
<dd><p>Fit per-cluster GP models and predict on X_test.</p>
<p>Assumes y_train already contains classes (0/1/2) consistent with your pipeline.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_gaussian_process.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictors_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_gaussian_process.forecast" title="Link to this definition"></a></dt>
<dd><p>Train on Predictors_train / Predictant, forecast for Predictor_for_year (1 time slice),
returning deterministic class + tercile probabilities.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_gaussian_process.get_hpo_summary">
<span class="sig-name descname"><span class="pre">get_hpo_summary</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_gaussian_process.get_hpo_summary" title="Link to this definition"></a></dt>
<dd><p>Get summary of HPO method and parameters.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_hpELM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neurons_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[10,</span> <span class="pre">20,</span> <span class="pre">50,</span> <span class="pre">100]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['sigm',</span> <span class="pre">'tanh',</span> <span class="pre">'relu',</span> <span class="pre">'rbf_linf',</span> <span class="pre">'rbf_gauss']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.1,</span> <span class="pre">1.0,</span> <span class="pre">10.0,</span> <span class="pre">100.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'nonparam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials_bayesian</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayesian_sampler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tpe'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scoring</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'neg_mean_squared_error'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Extreme Learning Machine (ELM) based Multi-Model Ensemble (MME) forecasting using hpelm library.
This class implements a single-model forecasting approach using HPELM for deterministic predictions,
with optional tercile probability calculations using various statistical distributions.
Implements hyperparameter optimization via multiple methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neurons_range</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – List of neuron counts to tune for HPELM (default is [10, 20, 50, 100]).</p></li>
<li><p><strong>activation_options</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Activation functions to tune for HPELM (default is [‘sigm’, ‘tanh’, ‘lin’, ‘rbf_l1’, ‘rbf_l2’, ‘rbf_linf’]).</p></li>
<li><p><strong>norm_range</strong> (<em>list</em><em> of </em><em>float</em><em>, </em><em>optional</em>) – Regularization parameters to tune for HPELM (default is [0.1, 1.0, 10.0, 100.0]).</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities.</p></li>
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘grid’, ‘random’, or ‘bayesian’ (default: ‘random’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized search (default is 10).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of clusters for homogenized zones (default is 4).</p></li>
<li><p><strong>n_trials_bayesian</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of trials for Bayesian optimization (default=50).</p></li>
<li><p><strong>bayesian_sampler</strong> (<em>str</em><em>, </em><em>optional</em>) – Sampler for Bayesian optimization: ‘tpe’ or ‘random’ (default=’tpe’).</p></li>
<li><p><strong>scoring</strong> (<em>str</em><em>, </em><em>optional</em>) – Scoring metric for optimization (default=’neg_mean_squared_error’).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.compare_optimization_methods">
<span class="sig-name descname"><span class="pre">compare_optimization_methods</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">methods</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['grid',</span> <span class="pre">'random',</span> <span class="pre">'bayesian']</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.compare_optimization_methods" title="Link to this definition"></a></dt>
<dd><p>Compare different hyperparameter optimization methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>array-like</em>) – Training features</p></li>
<li><p><strong>y_train</strong> (<em>array-like</em>) – Training targets</p></li>
<li><p><strong>methods</strong> (<em>list</em>) – List of methods to compare</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Comparison results for each method</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Independently computes the best hyperparameters using selected optimization method
on stacked training data for each homogenized zone.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_params_dict</strong> (<em>dict</em>) – Best hyperparameters for each cluster.</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels with dimensions (Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the HPELM model with injected hyperparameters for each zone.
:param X_train: Training predictor data with dimensions (T, M, Y, X).
:type X_train: xarray.DataArray
:param y_train: Training predictand data with dimensions (T, Y, X).
:type y_train: xarray.DataArray
:param X_test: Testing predictor data with dimensions (T, M, Y, X).
:type X_test: xarray.DataArray
:param y_test: Testing predictand data with dimensions (T, Y, X).
:type y_test: xarray.DataArray
:param best_params: Pre-computed best hyperparameters per cluster. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.forecast" title="Link to this definition"></a></dt>
<dd><p>Forecast method using a single HPELM model with optimized hyperparameters.
:param Predictant: Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).
:type Predictant: xarray.DataArray
:param clim_year_start: Start year of the climatology period.
:type clim_year_start: int or str
:param clim_year_end: End year of the climatology period.
:type clim_year_end: int or str
:param hindcast_det: Deterministic hindcast data for training with dimensions (T, M, Y, X).
:type hindcast_det: xarray.DataArray
:param hindcast_det_cross: Deterministic hindcast data for error estimation with dimensions (T, Y, X).
:type hindcast_det_cross: xarray.DataArray
:param Predictor_for_year: Predictor data for the target year with dimensions (T, M, Y, X).
:type Predictor_for_year: xarray.DataArray
:param best_params: Pre-computed best hyperparameters. If None, computes internally.
:type best_params: dict, optional
:param cluster_da: Pre-computed cluster labels. If None, computes internally.
:type cluster_da: xarray.DataArray, optional</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.get_optimization_results">
<span class="sig-name descname"><span class="pre">get_optimization_results</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.get_optimization_results" title="Link to this definition"></a></dt>
<dd><p>Return optimization results for analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing optimization results.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.plot_optimization_history">
<span class="sig-name descname"><span class="pre">plot_optimization_history</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_id</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.plot_optimization_history" title="Link to this definition"></a></dt>
<dd><p>Plot optimization history (for Bayesian optimization only).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cluster_id</strong> (<em>int</em><em>, </em><em>optional</em>) – Specific cluster to plot. If None, plots all clusters.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_hpELM_</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">neurons_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[10,</span> <span class="pre">20,</span> <span class="pre">50,</span> <span class="pre">100]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">activation_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['sigm',</span> <span class="pre">'tanh',</span> <span class="pre">'relu',</span> <span class="pre">'rbf_linf',</span> <span class="pre">'rbf_gauss']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.1,</span> <span class="pre">1.0,</span> <span class="pre">10.0,</span> <span class="pre">100.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gamma'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'random'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials_bayesian</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bayesian_sampler</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'tpe'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scoring</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'neg_mean_squared_error'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Extreme Learning Machine (ELM) based Multi-Model Ensemble (MME) forecasting using hpelm library.
This class implements a single-model forecasting approach using HPELM for deterministic predictions,
with optional tercile probability calculations using various statistical distributions.
Implements hyperparameter optimization via multiple methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>neurons_range</strong> (<em>list</em><em> of </em><em>int</em><em>, </em><em>optional</em>) – List of neuron counts to tune for HPELM (default is [10, 20, 50, 100]).</p></li>
<li><p><strong>activation_options</strong> (<em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – Activation functions to tune for HPELM (default is [‘sigm’, ‘tanh’, ‘lin’, ‘rbf_l1’, ‘rbf_l2’, ‘rbf_linf’]).</p></li>
<li><p><strong>norm_range</strong> (<em>list</em><em> of </em><em>float</em><em>, </em><em>optional</em>) – Regularization parameters to tune for HPELM (default is [0.1, 1.0, 10.0, 100.0]).</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for reproducibility (default is 42).</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probabilities (‘bestfit’ or ‘nonparam’.) (default is ‘bestfit’).</p></li>
<li><p><strong>search_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Hyperparameter optimization method: ‘grid’, ‘random’, or ‘bayesian’ (default: ‘random’).</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for randomized search (default is 10).</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default is 3).</p></li>
<li><p><strong>n_trials_bayesian</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of trials for Bayesian optimization (default=50).</p></li>
<li><p><strong>bayesian_sampler</strong> (<em>str</em><em>, </em><em>optional</em>) – Sampler for Bayesian optimization: ‘tpe’ or ‘random’ (default=’tpe’).</p></li>
<li><p><strong>scoring</strong> (<em>str</em><em>, </em><em>optional</em>) – Scoring metric for optimization (default=’neg_mean_squared_error’).</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Computes the best hyperparameters using selected optimization method on stacked training data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of the climatology period.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Best hyperparameters found.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the HPELM model with injected hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Testing predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Testing predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>predicted_da</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.forecast" title="Link to this definition"></a></dt>
<dd><p>Forecast method using a single HPELM model with optimized hyperparameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for training with dimensions (T, M, Y, X).</p></li>
<li><p><strong>hindcast_det_cross</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for error estimation with dimensions (T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the target year with dimensions (T, M, Y, X).</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best hyperparameters. If None, computes internally.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.get_optimization_results">
<span class="sig-name descname"><span class="pre">get_optimization_results</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.get_optimization_results" title="Link to this definition"></a></dt>
<dd><p>Return optimization results for analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary containing optimization results.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.plot_optimization_history">
<span class="sig-name descname"><span class="pre">plot_optimization_history</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.plot_optimization_history" title="Link to this definition"></a></dt>
<dd><p>Plot optimization history (for Bayesian optimization only).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_hpELM_.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_hpELM_.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_logistic">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_logistic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimization_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'grid'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[0.1,</span> <span class="pre">1.0,</span> <span class="pre">10.0,</span> <span class="pre">100.0]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">solver_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['newton-cg',</span> <span class="pre">'lbfgs',</span> <span class="pre">'sag',</span> <span class="pre">'saga']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">random_state</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">42</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv_folds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter_search</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_logistic" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Multinomial Logistic Regression MME with multiple hyperparameter optimization methods.</p>
<p>This class implements a unified approach for logistic regression with spatial clustering
and three hyperparameter optimization strategies:
1. Grid Search
2. Random Search
3. Bayesian Optimization (using Optuna)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>optimization_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Method for hyperparameter optimization. Options:
‘grid’, ‘random’, ‘bayesian’, ‘none’ (default: ‘grid’)</p></li>
<li><p><strong>C_range</strong> (<em>list</em><em> or </em><em>tuple</em><em>, </em><em>optional</em>) – For grid/random search: list of C values
For Bayesian: tuple of (min_C, max_C) for log-uniform sampling</p></li>
<li><p><strong>solver_options</strong> (<em>list</em><em>, </em><em>optional</em>) – List of solver algorithms to consider</p></li>
<li><p><strong>random_state</strong> (<em>int</em><em>, </em><em>optional</em>) – Random seed for reproducibility (default: 42)</p></li>
<li><p><strong>cv_folds</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of cross-validation folds (default: 5)</p></li>
<li><p><strong>n_clusters</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of spatial clusters (default: 4)</p></li>
<li><p><strong>n_iter_search</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations for random/bayesian search (default: 20)</p></li>
<li><p><strong>n_trials</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of trials for Bayesian optimization (default: 50)</p></li>
<li><p><strong>timeout</strong> (<em>int</em><em>, </em><em>optional</em>) – Timeout in seconds for Bayesian optimization (default: None)</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_logistic.compute_hyperparameters">
<span class="sig-name descname"><span class="pre">compute_hyperparameters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictand</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_logistic.compute_hyperparameters" title="Link to this definition"></a></dt>
<dd><p>Computes best hyperparameters using the selected optimization method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictors</strong> (<em>xarray.DataArray</em>) – Predictor data with dimensions (T, M, Y, X)</p></li>
<li><p><strong>Predictand</strong> (<em>xarray.DataArray</em>) – Predictand data with dimensions (T, Y, X)</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of climatology period</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of climatology period</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>best_params_dict</strong> (<em>dict</em>) – Best hyperparameters for each cluster</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em>) – Cluster labels for each spatial point</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_logistic.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_logistic.compute_model" title="Link to this definition"></a></dt>
<dd><p>Train models and compute predictions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data (classes)</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Testing predictor data</p></li>
<li><p><strong>y_test</strong> (<em>xarray.DataArray</em>) – Testing predictand data</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of climatology period</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of climatology period</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best parameters</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Pre-computed cluster labels</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>predicted_da</strong> (<em>xarray.DataArray</em>) – Predicted classes</p></li>
<li><p><strong>predicted_prob_da</strong> (<em>xarray.DataArray</em>) – Predicted probabilities</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_logistic.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictors_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_logistic.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate forecasts for a target year.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed predictand data</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em>) – Start year of climatology period</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em>) – End year of climatology period</p></li>
<li><p><strong>Predictors_train</strong> (<em>xarray.DataArray</em>) – Training predictor data</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for target year</p></li>
<li><p><strong>best_params</strong> (<em>dict</em><em>, </em><em>optional</em>) – Pre-computed best parameters</p></li>
<li><p><strong>cluster_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Pre-computed cluster labels</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>forecast_det</strong> (<em>xarray.DataArray</em>) – Deterministic forecast (classes)</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Probabilistic forecast</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_logistic.get_optimization_results">
<span class="sig-name descname"><span class="pre">get_optimization_results</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_logistic.get_optimization_results" title="Link to this definition"></a></dt>
<dd><p>Get detailed results from hyperparameter optimization.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>results</strong> – Dictionary containing optimization results</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELM">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_xcELM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">elm_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'gamma'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELM" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Extreme Learning Machine (ELM) for Multi-Model Ensemble (MME) forecasting derived from xcast.</p>
<p>This class implements an Extreme Learning Machine model for deterministic forecasting,
with optional tercile probability calculations using various statistical distributions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>elm_kwargs</strong> (<em>dict</em><em>, </em><em>optional</em>) – Keyword arguments to pass to the xcast ELM model. If None, default parameters are used:
{‘regularization’: 10, ‘hidden_layer_size’: 5, ‘activation’: ‘lin’, ‘preprocessing’: ‘none’, ‘n_estimators’: 5}.
Default is None.</p></li>
<li><p><strong>dist_method</strong> (<em>str</em><em>, </em><em>optional</em>) – Distribution method for tercile probability calculations (‘t’, ‘gamma’, ‘nonparam’, ‘normal’, ‘lognormal’, ‘weibull_min’).
Default is ‘gamma’.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELM.calculate_tercile_probabilities_bestfit">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_bestfit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_variance</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dof</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELM.calculate_tercile_probabilities_bestfit" title="Link to this definition"></a></dt>
<dd><p>Generic tercile probabilities using best-fit family per grid cell.</p>
<p>Inputs (per grid cell):
- best_guess : 1D array over T (hindcast_det or forecast_det)
- T1, T2     : scalar terciles from climatological best-fit distribution
- dist_code  : int, as in _ppf_terciles_from_code
- shape, loc, scale : scalars from climatology fit</p>
<p>Strategy:
- For each time step, build a predictive distribution of the same family:</p>
<blockquote>
<div><ul class="simple">
<li><p>Use best_guess[t] to adjust mean / location;</p></li>
<li><p>Keep shape parameters from climatology.</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Then compute probabilities:</dt><dd><p>P(B) = F(T1), P(N) = F(T2) - F(T1), P(A) = 1 - F(T2).</p>
</dd>
</dl>
</li>
</ul>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELM.calculate_tercile_probabilities_nonparametric">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_tercile_probabilities_nonparametric</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">best_guess</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">first_tercile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">second_tercile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELM.calculate_tercile_probabilities_nonparametric" title="Link to this definition"></a></dt>
<dd><p>Non-parametric method using historical error samples.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELM.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELM.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute deterministic hindcast using the ELM model.</p>
<p>Fits the ELM model on training data and predicts deterministic values for the test data.
Applies regridding and drymasking to ensure data consistency.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Testing predictor data with dimensions (T, M, Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>result_</strong> – Deterministic hindcast with dimensions (T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELM.compute_prob">
<span class="sig-name descname"><span class="pre">compute_prob</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELM.compute_prob" title="Link to this definition"></a></dt>
<dd><p>Compute tercile probabilities for deterministic hindcasts.</p>
<dl class="simple">
<dt>If dist_method == ‘bestfit’:</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Use cluster-based best-fit distributions to:</dt><dd><ul>
<li><p>derive terciles analytically from (best_code_da, best_shape_da, best_loc_da, best_scale_da),</p></li>
<li><p>compute predictive probabilities using the same family.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
<dt>Otherwise:</dt><dd><ul class="simple">
<li><p>Use empirical terciles from Predictant climatology and the selected
parametric / nonparametric method.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed data (T, Y, X) or (T, Y, X, M).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – Climatology period (inclusive) for thresholds.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast (T, Y, X).</p></li>
<li><p><strong>best_code_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_shape_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_loc_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
<li><p><strong>best_scale_da</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Output from WAS_TransformData.fit_best_distribution_grid, required for ‘bestfit’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Probabilities with dims (probability=[‘PB’,’PN’,’PA’], T, Y, X).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELM.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det_cross_val</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_code_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_shape_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_loc_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_scale_da</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELM.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate deterministic and probabilistic forecast for a target year using the ELM model.</p>
<p>Fits the ELM model on hindcast data, predicts deterministic values for the target year,
and computes tercile probabilities. Applies regridding, drymasking, and standardization.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period.</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for training with dimensions (T, M, Y, X).</p></li>
<li><p><strong>hindcast_det_cross_val</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data for error estimation with dimensions (T, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the target year with dimensions (T, M, Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>result_</strong> (<em>xarray.DataArray</em>) – Deterministic forecast with dimensions (T, Y, X).</p></li>
<li><p><strong>hindcast_prob</strong> (<em>xarray.DataArray</em>) – Tercile probabilities with dimensions (probability, T, Y, X), where probability
includes [‘PB’, ‘PN’, ‘PA’] (below-normal, normal, above-normal).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELM.weibull_shape_solver">
<em class="property"><span class="k"><span class="pre">static</span></span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">weibull_shape_solver</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">M</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELM.weibull_shape_solver" title="Link to this definition"></a></dt>
<dd><p>Function to find the root of the Weibull shape parameter ‘k’.
We find ‘k’ such that the theoretical variance/mean^2 ratio
matches the observed V/M^2 ratio.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELR">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">WAS_mme_xcELR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">elm_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELR" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Extended Logistic Regression (ELR) for Multi-Model Ensemble (MME) forecasting derived from xcast package.</p>
<p>This class implements an Extended Logistic Regression for probabilistic forecasting,
directly computing tercile probabilities without requiring separate probability calculations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>elm_kwargs</strong> (<em>dict</em><em>, </em><em>optional</em>) – Keyword arguments to pass to the xcast ELR model. If None, an empty dictionary is used.
Default is None.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELR.compute_model">
<span class="sig-name descname"><span class="pre">compute_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELR.compute_model" title="Link to this definition"></a></dt>
<dd><p>Compute probabilistic hindcast using the ELR model.</p>
<p>Fits the ELR model on training data and predicts tercile probabilities for the test data.
Applies regridding and drymasking to ensure data consistency.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>X_train</strong> (<em>xarray.DataArray</em>) – Training predictor data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>y_train</strong> (<em>xarray.DataArray</em>) – Training predictand data with dimensions (T, Y, X).</p></li>
<li><p><strong>X_test</strong> (<em>xarray.DataArray</em>) – Testing predictor data with dimensions (T, M, Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>result_</strong> – Tercile probabilities with dimensions (probability, T, Y, X), where probability
includes [‘PB’, ‘PN’, ‘PA’] (below-normal, normal, above-normal).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="wass2s.was_mme.WAS_mme_xcELR.forecast">
<span class="sig-name descname"><span class="pre">forecast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Predictant</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_det</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Predictor_for_year</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.WAS_mme_xcELR.forecast" title="Link to this definition"></a></dt>
<dd><p>Generate probabilistic forecast for a target year using the ELR model.</p>
<p>Fits the ELR model on hindcast data and predicts tercile probabilities for the target year.
Applies regridding and drymasking to ensure data consistency.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Predictant</strong> (<em>xarray.DataArray</em>) – Observed predictand data with dimensions (T, Y, X) or (T, M, Y, X).</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em> or </em><em>str</em>) – Start year of the climatology period (not used in this method).</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em> or </em><em>str</em>) – End year of the climatology period (not used in this method).</p></li>
<li><p><strong>hindcast_det</strong> (<em>xarray.DataArray</em>) – Deterministic hindcast data with dimensions (T, M, Y, X).</p></li>
<li><p><strong>Predictor_for_year</strong> (<em>xarray.DataArray</em>) – Predictor data for the target year with dimensions (T, M, Y, X).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>hindcast_prob</strong> – Tercile probabilities with dimensions (probability, T, Y, X), where probability
includes [‘PB’, ‘PN’, ‘PA’] (below-normal, normal, above-normal).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.was_mme.compute_gridpoint_terciles_from_obs">
<span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">compute_gridpoint_terciles_from_obs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataArray</span></span></em>, <em class="sig-param"><span class="keyword-only-separator o"><abbr title="Keyword-only parameters separator (PEP 3102)"><span class="pre">*</span></abbr></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'T'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lat_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Y'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lon_dim</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'X'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">(0.3333333333333333,</span> <span class="pre">0.6666666666666666)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">('lower',</span> <span class="pre">'upper')</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">DataArray</span></span></span><a class="headerlink" href="#wass2s.was_mme.compute_gridpoint_terciles_from_obs" title="Link to this definition"></a></dt>
<dd><p>Compute gridpoint tercile thresholds from observations.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>dims (‘tercile’, Y, X) with tercile labels [‘lower’,’upper’] (by default).</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>xr.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.was_mme.myfill">
<span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">myfill</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">all_model_fcst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.myfill" title="Link to this definition"></a></dt>
<dd><p>Fill missing values in forecast data using random samples from observations.</p>
<p>This function fills NaN values in the forecast data by randomly sampling values from the observed
rainfall data along the time dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>all_model_fcst</strong> (<em>xarray.DataArray</em>) – Forecast data with dimensions (T, M, Y, X) containing possible NaN values.</p></li>
<li><p><strong>obs</strong> (<em>xarray.DataArray</em>) – Observed rainfall data with dimensions (T, Y, X) used for filling NaNs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>da_filled_random</strong> – Forecast data with NaN values filled using random samples from observations.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.was_mme.predict_fast">
<span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">predict_fast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fcst_grid</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.predict_fast" title="Link to this definition"></a></dt>
<dd><p>Accelerated prediction using Numba (if available).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.was_mme.process_datasets_for_mme">
<span class="sig-prename descclassname"><span class="pre">wass2s.was_mme.</span></span><span class="sig-name descname"><span class="pre">process_datasets_for_mme</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rainfall</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdcsted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fcsted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agroparam</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Prob</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hydro</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ELM_ELR</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_to_save_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">best_models</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score_metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'GROC'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">var</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PRCP'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.was_mme.process_datasets_for_mme" title="Link to this definition"></a></dt>
<dd><p>Process hindcast and forecast datasets for a multi-model ensemble.</p>
<p>This function loads, interpolates, and concatenates hindcast and forecast datasets from various sources
(GCMs, agroparameters, or others) to prepare them for a multi-model ensemble. It supports different score
metrics and configurations for probabilistic or deterministic outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rainfall</strong> (<em>xarray.DataArray</em>) – Observed rainfall data used for interpolation and masking.</p></li>
<li><p><strong>hdcsted</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of hindcast datasets for different models.</p></li>
<li><p><strong>fcsted</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary of forecast datasets for different models.</p></li>
<li><p><strong>gcm</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, process data as GCM data. Default is True.</p></li>
<li><p><strong>agroparam</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, process data as agroparameter data. Default is False.</p></li>
<li><p><strong>Prob</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, process data as probabilistic forecasts. Default is False.</p></li>
<li><p><strong>ELM_ELR</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, use ELM_ELR configuration for dimension renaming. Default is False.</p></li>
<li><p><strong>dir_to_save_model</strong> (<em>str</em><em>, </em><em>optional</em>) – Directory path to load model data.</p></li>
<li><p><strong>best_models</strong> (<em>list</em><em>, </em><em>optional</em>) – List of model names to include in the ensemble.</p></li>
<li><p><strong>scores</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary containing model scores, with the key specified by <cite>score_metric</cite>.</p></li>
<li><p><strong>year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Starting year for the data range.</p></li>
<li><p><strong>year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – Ending year for the data range.</p></li>
<li><p><strong>model</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, treat data as model-based. Default is True.</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em><em>, </em><em>optional</em>) – Month when the forecast is initialized.</p></li>
<li><p><strong>lead_time</strong> (<em>int</em><em>, </em><em>optional</em>) – Forecast lead time in months.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – Year for which the forecast is generated.</p></li>
<li><p><strong>score_metric</strong> (<em>str</em><em>, </em><em>optional</em>) – Metric used to organize scores (e.g., ‘Pearson’, ‘MAE’, ‘GROC’). Default is ‘GROC’.</p></li>
<li><p><strong>var</strong> (<em>str</em><em>, </em><em>optional</em>) – variables used ( e.g., ‘PRCP’)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>all_model_hdcst</strong> (<em>xarray.DataArray</em>) – Concatenated hindcast data across models.</p></li>
<li><p><strong>all_model_fcst</strong> (<em>xarray.DataArray</em>) – Concatenated forecast data across models.</p></li>
<li><p><strong>obs</strong> (<em>xarray.DataArray</em>) – Observed rainfall data expanded with a model dimension and masked.</p></li>
<li><p><strong>scores_organized</strong> (<em>dict</em>) – Dictionary of organized scores for selected models.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-wass2s.utils">
<span id="wass2s-utils-module"></span><h3>wass2s.utils module<a class="headerlink" href="#module-wass2s.utils" title="Link to this heading"></a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.anomalize_timeseries">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">anomalize_timeseries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.anomalize_timeseries" title="Link to this definition"></a></dt>
<dd><p>Compute anomalies by subtracting the climatological mean.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em><em> or </em><em>xarray.DataArray</em>) – Input dataset or data array.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year of the climatology period. If None, uses the full time range.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year of the climatology period. If None, uses the full time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Anomalized dataset or data array (ds - mean).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset or xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Anomalies are computed as ds - mean, where mean is calculated over the
specified climatology period or the entire time dimension.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.build_iridl_url_ersst">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">build_iridl_url_ersst</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">year_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bbox</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">run_avg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_start</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Jan'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_end</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'Dec'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.build_iridl_url_ersst" title="Link to this definition"></a></dt>
<dd><p>Build a parameterized IRIDL URL for NOAA ERSST dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>year_start</strong> (<em>int</em>) – Start year for the data request.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year for the data request.</p></li>
<li><p><strong>bbox</strong> (<em>list</em>) – Bounding box coordinates in the format [North, West, South, East].</p></li>
<li><p><strong>run_avg</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of time steps for running average (default is 3). If None, no running average is applied.</p></li>
<li><p><strong>month_start</strong> (<em>str</em><em>, </em><em>optional</em>) – Starting month for the time range (default is ‘Jan’).</p></li>
<li><p><strong>month_end</strong> (<em>str</em><em>, </em><em>optional</em>) – Ending month for the time range (default is ‘Dec’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Constructed IRIDL URL for accessing NOAA ERSST data.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The bounding box is reordered to match IRIDL’s expected format: Y/(south)/(north)/, X/(west)/(east)/.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.compute_other_indices">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">compute_other_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.compute_other_indices" title="Link to this definition"></a></dt>
<dd><p>Compute indices for non-SST variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_data</strong> (<em>str</em>) – Directory path where data is stored.</p></li>
<li><p><strong>indices_dict</strong> (<em>dict</em>) – Dictionary mapping index names to coordinates (label, lon_min, lon_max, lat_min, lat_max).</p></li>
<li><p><strong>variables_list</strong> (<em>str</em>) – Variable string in the format ‘center.variable’.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the data.</p></li>
<li><p><strong>season</strong> (<em>list</em>) – List of month numbers defining the season.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year for climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year for climatology period.</p></li>
<li><p><strong>model</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, load model data; otherwise, load reanalysis data (default is False).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em><em>, </em><em>optional</em>) – Month of model initialization.</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em>, </em><em>optional</em>) – List of lead times in months.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – Forecast year.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset containing computed indices as variables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.compute_sst_indices">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">compute_sst_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">others_zone</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.compute_sst_indices" title="Link to this definition"></a></dt>
<dd><p>Compute Sea Surface Temperature (SST) indices for reanalysis or model data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_data</strong> (<em>str</em>) – Directory path where data is stored.</p></li>
<li><p><strong>indices</strong> (<em>list</em>) – List of SST indices to compute (e.g., [‘NINO34’, ‘TNA’]).</p></li>
<li><p><strong>variables_list</strong> (<em>str</em>) – Variable string in the format ‘center.variable’.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the data.</p></li>
<li><p><strong>season</strong> (<em>list</em>) – List of month numbers defining the season.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year for climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year for climatology period.</p></li>
<li><p><strong>others_zone</strong> (<em>dict</em><em>, </em><em>optional</em>) – Additional custom zones for SST indices with coordinates.</p></li>
<li><p><strong>model</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, load model data; otherwise, load reanalysis data (default is False).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em><em>, </em><em>optional</em>) – Month of model initialization.</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em>, </em><em>optional</em>) – List of lead times in months.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – Forecast year.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset containing computed SST indices as variables.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Derived indices like ‘TASI’ and ‘DMI’ are computed as differences of other indices.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.decode_cf">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">decode_cf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time_var</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.decode_cf" title="Link to this definition"></a></dt>
<dd><p>Decode time dimension to CFTime standards.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Input dataset containing the time variable to decode.</p></li>
<li><p><strong>time_var</strong> (<em>str</em>) – Name of the time variable in the dataset.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset with decoded time dimension adhering to CFTime standards.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>If the calendar attribute of the time variable is ‘360’, it is converted to ‘360_day’
to ensure compatibility with CFTime decoding.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.download_file">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">download_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">url</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">local_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">force_download</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">chunk_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8192</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">timeout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.download_file" title="Link to this definition"></a></dt>
<dd><p>Download a file from a URL to a local path with progress tracking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> (<em>str</em>) – URL of the file to download.</p></li>
<li><p><strong>local_path</strong> (<em>str</em><em> or </em><em>pathlib.Path</em>) – Local path where the file will be saved.</p></li>
<li><p><strong>force_download</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, overwrite existing file (default is False).</p></li>
<li><p><strong>chunk_size</strong> (<em>int</em><em>, </em><em>optional</em>) – Size of chunks for streaming download (default is 8192 bytes).</p></li>
<li><p><strong>timeout</strong> (<em>int</em><em>, </em><em>optional</em>) – Timeout for the HTTP request in seconds (default is 120).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Path to the downloaded file, or None if download fails.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pathlib.Path or None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Skips download if the file already exists and <cite>force_download</cite> is False.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.et0_fao56_daily">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">et0_fao56_daily</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tmin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mlsp</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dem</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tdew</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">u10</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v10</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.et0_fao56_daily" title="Link to this definition"></a></dt>
<dd><p>Compute daily reference evapotranspiration (ET₀) using the FAO-56 Penman-Monteith equation.</p>
<p>Calculates ET₀ for a hypothetical reference crop (grass, 0.12 m height) based on
daily meteorological data, following the standardized FAO-56 methodology.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tmax</strong> (<em>xarray.DataArray</em>) – Daily maximum temperature in °C, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>tmin</strong> (<em>xarray.DataArray</em>) – Daily minimum temperature in °C, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>tdew</strong> (<em>xarray.DataArray</em>) – Daily mean dew point temperature in °C, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>u10</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Daily mean zonal wind speed at 10 m height in m s^-1, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>v10</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Daily mean meridional wind speed at 10 m height in m s^-1, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>wff</strong> (<em>xarray.DataArray</em><em>, </em><em>optional</em>) – Daily mean wind speed at 10 m height in m s^-1, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>rs</strong> (<em>xarray.DataArray</em>) – Daily mean incoming solar radiation in W m^-2 or MJ m^-2 day^-1, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>mlsp</strong> (<em>xarray.DataArray</em>) – Daily mean sea-level pressure in hPa, with dimensions (‘T’, ‘Y’, ‘X’).</p></li>
<li><p><strong>dem</strong> (<em>xarray.DataArray</em>) – Digital elevation model (terrain height) in meters, with dimensions (‘Y’, ‘X’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Daily reference evapotranspiration (ET₀) in mm day^-1, with dimensions (‘T’, ‘Y’, ‘X’),
and attributes for units and long name.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>All input arrays must be on matching grids with dimensions (‘T’, ‘Y’, ‘X’) except for
<cite>dem</cite>, which is typically (‘Y’, ‘X’) and interpolated to match.</p></li>
<li><p>Solar radiation input (<cite>rs</cite>) is automatically converted from W m^-2 to MJ m^-2 day^-1
if values exceed 200 (assumed to be in W m^-2).</p></li>
<li><p>Wind speed at 10 m is converted to 2 m height using a logarithmic profile.</p></li>
<li><p>Soil heat flux (G) is assumed to be zero for daily calculations.</p></li>
<li><p>The albedo for the reference crop is fixed at 0.23.</p></li>
<li><p>Polar night conditions are handled in the extraterrestrial radiation calculation.</p></li>
</ul>
<p class="rubric">References</p>
<p>Allen, R. G., Pereira, L. S., Raes, D., &amp; Smith, M. (1998). Crop
evapotranspiration: Guidelines for computing crop water requirements.
FAO Irrigation and Drainage Paper 56.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.extraterrestrial_radiation">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">extraterrestrial_radiation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lat_da</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">time</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.extraterrestrial_radiation" title="Link to this definition"></a></dt>
<dd><p>Calculate daily extraterrestrial radiation (Ra) following FAO-56 equations (21–23).</p>
<p>Computes the solar radiation at the top of the Earth’s atmosphere, accounting
for latitude, day of the year, and solar geometry. Handles polar day/night
conditions by setting radiation to zero during polar night.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lat_da</strong> (<em>xarray.DataArray</em>) – 2D latitude field in degrees, with dimensions (‘Y’, ‘X’).</p></li>
<li><p><strong>time</strong> (<em>pandas.DatetimeIndex</em>) – 1D array of datetime objects representing the time dimension.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Daily extraterrestrial radiation (Ra) with dimensions (‘T’, ‘Y’, ‘X’),
units MJ m^-2 day^-1, and attributes for units and long name.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Based on FAO-56 Reference Evapotranspiration methodology (Allen et al., 1998).</p></li>
<li><p>Polar day/night is handled by setting Ra to 0 where the sunset hour angle is undefined.</p></li>
<li><p>The solar constant used is 0.082 MJ m^-2 min^-1, converted to daily values.</p></li>
</ul>
<p class="rubric">References</p>
<p>Allen, R. G., Pereira, L. S., Raes, D., &amp; Smith, M. (1998). Crop
evapotranspiration: Guidelines for computing crop water requirements.
FAO Irrigation and Drainage Paper 56.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.find_best_distribution_grid">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">find_best_distribution_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rainfall</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distribution_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.find_best_distribution_grid" title="Link to this definition"></a></dt>
<dd><p>Determine the best-fitting distribution for variables data at each grid cell.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rainfall</strong> (<em>xarray.DataArray</em>) – Precipitation data with a time dimension ‘T’ and spatial dimensions ‘Y’, ‘X’.</p></li>
<li><p><strong>distribution_map</strong> (<em>dict</em><em>, </em><em>optional</em>) – Mapping of distribution names to numeric codes. Defaults to:
{‘norm’: 1, ‘lognorm’: 2, ‘expon’: 3, ‘gamma’: 4, ‘weibull_min’: 5}</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Array with numeric codes for the best-fitting distribution at each grid cell.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses the Fitter library to fit distributions and select the best based on sum-of-squared errors.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.fix_time_coord">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">fix_time_coord</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seas</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.fix_time_coord" title="Link to this definition"></a></dt>
<dd><p>Fix time coordinates by extracting year and assigning a fixed month/day.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em>) – Input dataset with time dimension ‘T’.</p></li>
<li><p><strong>seas</strong> (<em>tuple</em>) – Tuple containing season information, where seas[1] is the month (e.g., ‘11’ for November).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset with updated time coordinates in the format ‘YYYY-MM-01’.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Assumes the input dataset’s time values can be converted to pandas datetime objects.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.get_best_models">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">get_best_models</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">center_variable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scores</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'MAE'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">top_n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">6</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gcm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agroparam</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hydro</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.get_best_models" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.load_gridded_predictor">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">load_gridded_predictor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.load_gridded_predictor" title="Link to this definition"></a></dt>
<dd><p>Load gridded predictor data for reanalysis or model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_data</strong> (<em>str</em>) – Directory path where predictor data is stored.</p></li>
<li><p><strong>variables_list</strong> (<em>str</em>) – Variable string in the format ‘center.variable’.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the data.</p></li>
<li><p><strong>season</strong> (<em>list</em><em>, </em><em>optional</em>) – List of month numbers defining the season.</p></li>
<li><p><strong>model</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, load model data (hindcast/forecast); otherwise, load reanalysis data (default is False).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em><em>, </em><em>optional</em>) – Month of model initialization (required if model=True).</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em>, </em><em>optional</em>) – List of lead times in months (required if model=True).</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – Forecast year (required for forecast data if model=True).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Loaded predictor data array renamed to ‘predictor’.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Converts dataset to data array, drops ‘variable’ dimension, and ensures datetime64[ns] time coordinates.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.parse_variable">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">parse_variable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variables_list</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.parse_variable" title="Link to this definition"></a></dt>
<dd><p>Extract center and variable names from a variable string.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>variables_list</strong> (<em>str</em>) – Variable string in the format ‘center.variable’.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tuple containing (center, variable).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse_variable</span><span class="p">(</span><span class="s2">&quot;NOAA.SST&quot;</span><span class="p">)</span>
<span class="go">(&#39;NOAA&#39;, &#39;SST&#39;)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.plot_date">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">plot_date</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.plot_date" title="Link to this definition"></a></dt>
<dd><p>Plot a map of dates, interpreting values as offsets from 2024-01-01.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>A</strong> (<em>xarray.DataArray</em>) – Data array with values representing days since 2024-01-01, and dimensions ‘Y’, ‘X’.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Converts colorbar ticks to calendar dates (e.g., ‘01-Jan’) for readability.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.plot_map">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">plot_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">extent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sst_indices</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fig_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(10,</span> <span class="pre">8)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.plot_map" title="Link to this definition"></a></dt>
<dd><p>Plot a map with specified geographic extent and optional SST index boxes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>extent</strong> (<em>list</em>) – Geographic extent in the format [west, east, south, north].</p></li>
<li><p><strong>title</strong> (<em>str</em><em>, </em><em>optional</em>) – Title of the map (default is ‘Map’).</p></li>
<li><p><strong>sst_indices</strong> (<em>dict</em><em>, </em><em>optional</em>) – Dictionary containing SST index information with keys as index names and
values as tuples (label, lon_w, lon_e, lat_s, lat_n).</p></li>
<li><p><strong>fig_size</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Figure size as (width, height) in inches (default is (10, 8)).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses Cartopy for map projection and Matplotlib for plotting.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.plot_prob_forecasts">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">plot_prob_forecasts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forecast_prob</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['Below-Normal',</span> <span class="pre">'Near-Normal',</span> <span class="pre">'Above-Normal']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reverse_cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hspace</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logo_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(None,</span> <span class="pre">None)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logo_position</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lower</span> <span class="pre">left'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">res</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.plot_prob_forecasts" title="Link to this definition"></a></dt>
<dd><p>Plot probabilistic forecasts with tercile categories.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory path to save the plot.</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Data array containing probability forecasts with a ‘probability’ dimension.</p></li>
<li><p><strong>model_name</strong> (<em>str</em><em> or </em><em>numpy.ndarray</em>) – Name of the model for the plot title.</p></li>
<li><p><strong>labels</strong> (<em>list</em><em>, </em><em>optional</em>) – Labels for the tercile categories (default is [“Below-Normal”, “Near-Normal”, “Above-Normal”]).</p></li>
<li><p><strong>reverse_cmap</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, reverse the colormap order for categories (default is True).</p></li>
<li><p><strong>hspace</strong> (<em>float</em><em>, </em><em>optional</em>) – Height space between the main plot and the colorbar (default is -0.6).</p></li>
<li><p><strong>sigma</strong> (<em>float</em><em>, </em><em>optional</em>) – Standard deviation for Gaussian smoothing of probabilities (default is None, no smoothing).</p></li>
<li><p><strong>res</strong> (<em>float</em><em>, </em><em>optional</em>) – Resolution for interpolation of the forecast probabilities (default is None, no interpolation).</p></li>
<li><p><strong>logo</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the logo image to be added to the plot (default is None).</p></li>
<li><p><strong>logo_size</strong> (<em>tuple</em><em>, </em><em>optional</em>) – Size of the logo image in the plot (default is 0.5).</p></li>
<li><p><strong>logo_position</strong> (<em>str</em><em>, </em><em>optional</em>) – Position of the logo image in the plot (default is “lower left”).</p></li>
<li><p><strong>logo_size</strong> – Size of the logo image in the plot as (width, height) in inches (default is (None, None)).</p></li>
</ul>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Saves the plot as a PNG file and displays it.
Uses custom colormaps for each tercile category.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.plot_prob_forecasts1">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">plot_prob_forecasts1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forecast_prob</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['Below-Normal',</span> <span class="pre">'Near-Normal',</span> <span class="pre">'Above-Normal']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reverse_cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logo_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.plot_prob_forecasts1" title="Link to this definition"></a></dt>
<dd><p>Plot probabilistic forecasts with tercile categories.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory path to save the plot.</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Data array containing probability forecasts with a ‘probability’ dimension.</p></li>
<li><p><strong>model_name</strong> (<em>str</em><em> or </em><em>numpy.ndarray</em>) – Name of the model for the plot title.</p></li>
<li><p><strong>labels</strong> (<em>list</em><em>, </em><em>optional</em>) – Labels for the tercile categories (default is [“Below-Normal”, “Near-Normal”, “Above-Normal”]).</p></li>
<li><p><strong>reverse_cmap</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, reverse the colormap order for categories (default is True).</p></li>
<li><p><strong>logo</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the logo image to be added to the plot (default is None).</p></li>
<li><p><strong>logo_size</strong> (<em>float</em><em>, </em><em>optional</em>) – Size of the logo image in the plot (default is 0.5).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Saves the plot as a PNG file and displays it.
Uses custom colormaps for each tercile category.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.plot_prob_forecasts2">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">plot_prob_forecasts2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forecast_prob</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['Below-Normal',</span> <span class="pre">'Near-Normal',</span> <span class="pre">'Above-Normal']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reverse_cmap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logo</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logo_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.plot_prob_forecasts2" title="Link to this definition"></a></dt>
<dd><p>Plot probabilistic forecasts with tercile categories.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory path to save the plot.</p></li>
<li><p><strong>forecast_prob</strong> (<em>xarray.DataArray</em>) – Data array containing probability forecasts with a ‘probability’ dimension.</p></li>
<li><p><strong>model_name</strong> (<em>str</em><em> or </em><em>numpy.ndarray</em>) – Name of the model for the plot title.</p></li>
<li><p><strong>labels</strong> (<em>list</em><em>, </em><em>optional</em>) – Labels for the tercile categories (default is [“Below-Normal”, “Near-Normal”, “Above-Normal”]).</p></li>
<li><p><strong>reverse_cmap</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, reverse the colormap order for categories (default is True).</p></li>
<li><p><strong>logo</strong> (<em>str</em><em>, </em><em>optional</em>) – Path to the logo image to be added to the plot (default is None).</p></li>
<li><p><strong>logo_size</strong> (<em>float</em><em>, </em><em>optional</em>) – Size of the logo image in the plot (default is 0.5).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Saves the plot as a PNG file and displays it.
Uses custom colormaps for each tercile category.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.plot_tercile">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">plot_tercile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">A</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_dir</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.plot_tercile" title="Link to this definition"></a></dt>
<dd><p>Plot a tercile map with categories: Below, Normal, Above.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>A</strong> (<em>xarray.DataArray</em>) – Data array with tercile categories (0: Below, 1: Normal, 2: Above) and dimensions ‘T’, ‘Y’, ‘X’.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Uses a custom colormap and displays a legend for tercile categories.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.pre_process_biophysical_model">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">pre_process_biophysical_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdcst_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fcst_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_hdcst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_fcst_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PRCP'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.pre_process_biophysical_model" title="Link to this definition"></a></dt>
<dd><p>Process model hindcasts and forecasts data for extended seasonal forecasts with biophysical models (Hype, SARRAO).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory path to save processed data.</p></li>
<li><p><strong>hdcst_file_path</strong> (<em>dict</em>) – Dictionary mapping model names to hindcast file paths.</p></li>
<li><p><strong>fcst_file_path</strong> (<em>dict</em>) – Dictionary mapping model names to forecast file paths.</p></li>
<li><p><strong>obs_hdcst</strong> (<em>xarray.Dataset</em>) – Observational hindcast dataset.</p></li>
<li><p><strong>obs_fcst_year</strong> (<em>xarray.Dataset</em>) – Observational forecast dataset for the specified year.</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em>) – Month of model initialization.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the hindcast data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the hindcast data.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em>) – Forecast year.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of dictionaries (saved_hindcast_paths, saved_forecast_paths) mapping model names to saved file paths.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.predictant_mask">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">predictant_mask</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.predictant_mask" title="Link to this definition"></a></dt>
<dd><p>Create a mask for predictand data based on rainfall thresholds and latitude.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>xarray.DataArray</em>) – Input data array with a time dimension ‘T’ and spatial dimensions ‘Y’, ‘X’.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Mask with 1 where conditions are met, NaN elsewhere.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The mask is set to 1 where mean rainfall &gt; 20 mm and latitude is within ±19.5 degrees,
otherwise NaN.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.prepare_predictand">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">prepare_predictand</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save_Obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_obs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">daily</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">param</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'prcp'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.prepare_predictand" title="Link to this definition"></a></dt>
<dd><p>Prepare the predictand dataset from observational data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_save_Obs</strong> (<em>str</em>) – Directory path where observational data is stored.</p></li>
<li><p><strong>variables_obs</strong> (<em>list</em>) – List containing the variable string in the format ‘center.variable’.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the data.</p></li>
<li><p><strong>season</strong> (<em>list</em><em>, </em><em>optional</em>) – List of month numbers defining the season (e.g., [6, 7, 8] for JJA).</p></li>
<li><p><strong>ds</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, return dataset without converting to array (default is True).</p></li>
<li><p><strong>daily</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, load daily data; otherwise, load seasonal data (default is False).</p></li>
<li><p><strong>param</strong> (<em>Indicate parameter name</em>)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Prepared predictand dataset or data array.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset or xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Applies a mask for non-daily data based on rainfall thresholds and latitude.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.proceed_seasonal_daily_bias_correction">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">proceed_seasonal_daily_bias_correction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_save_model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">observation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hindcast_files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">forecast_files</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">varname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'PRCP'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wet_day</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.proceed_seasonal_daily_bias_correction" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.process_model_for_other_params">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">process_model_for_other_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">agmParamModel</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dir_to_save</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hdcst_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fcst_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_hdcst</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obs_fcst_year</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nb_cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">agrometparam</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Onset'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.process_model_for_other_params" title="Link to this definition"></a></dt>
<dd><p>Process model hindcast and forecast data for agrometeorological parameters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>agmParamModel</strong> (<em>object</em>) – Model object with a compute method for processing agrometeorological parameters.</p></li>
<li><p><strong>dir_to_save</strong> (<em>str</em>) – Directory path to save processed data.</p></li>
<li><p><strong>hdcst_file_path</strong> (<em>dict</em>) – Dictionary mapping model names to hindcast file paths.</p></li>
<li><p><strong>fcst_file_path</strong> (<em>dict</em>) – Dictionary mapping model names to forecast file paths.</p></li>
<li><p><strong>obs_hdcst</strong> (<em>xarray.Dataset</em>) – Observational hindcast dataset.</p></li>
<li><p><strong>obs_fcst_year</strong> (<em>xarray.Dataset</em>) – Observational forecast dataset for the specified year.</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em>) – Month of model initialization.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the hindcast data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the hindcast data.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em>) – Forecast year.</p></li>
<li><p><strong>nb_cores</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of CPU cores for parallel processing (default is 2).</p></li>
<li><p><strong>agrometparam</strong> (<em>str</em><em>, </em><em>optional</em>) – Name of the agrometeorological parameter (default is ‘Onset’).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple of dictionaries (saved_hindcast_paths, saved_forecast_paths) mapping model names to saved file paths.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.retrieve_several_zones_for_PCR">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">retrieve_several_zones_for_PCR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.retrieve_several_zones_for_PCR" title="Link to this definition"></a></dt>
<dd><p>Retrieve data for multiple zones for Principal Component Regression (PCR).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_data</strong> (<em>str</em>) – Directory path where data is stored.</p></li>
<li><p><strong>indices_dict</strong> (<em>dict</em>) – Dictionary mapping index names to coordinates (label, lon_min, lon_max, lat_min, lat_max).</p></li>
<li><p><strong>variables_list</strong> (<em>str</em>) – Variable string in the format ‘center.variable’.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the data.</p></li>
<li><p><strong>season</strong> (<em>list</em>) – List of month numbers defining the season.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year for climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year for climatology period.</p></li>
<li><p><strong>model</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, load model data (hindcast and forecast); otherwise, load reanalysis data (default is False).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em><em>, </em><em>optional</em>) – Month of model initialization.</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em>, </em><em>optional</em>) – List of lead times in months.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – Forecast year.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of xarray.DataArray objects, each representing a standardized region.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.retrieve_single_zone_for_PCR">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">retrieve_single_zone_for_PCR</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dir_to_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variables_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_start</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_end</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">season</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">month_of_initialization</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lead_time</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">year_forecast</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">standardize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.retrieve_single_zone_for_PCR" title="Link to this definition"></a></dt>
<dd><p>Retrieve data for a single zone for Principal Component Regression (PCR) with interpolation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dir_to_data</strong> (<em>str</em>) – Directory path where data is stored.</p></li>
<li><p><strong>indices_dict</strong> (<em>dict</em>) – Dictionary mapping a single index name to coordinates (label, lon_min, lon_max, lat_min, lat_max).</p></li>
<li><p><strong>variables_list</strong> (<em>str</em>) – Variable string in the format ‘center.variable’.</p></li>
<li><p><strong>year_start</strong> (<em>int</em>) – Start year of the data.</p></li>
<li><p><strong>year_end</strong> (<em>int</em>) – End year of the data.</p></li>
<li><p><strong>season</strong> (<em>list</em><em>, </em><em>optional</em>) – List of month numbers defining the season.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year for climatology period.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year for climatology period.</p></li>
<li><p><strong>model</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, load model data (hindcast and forecast); otherwise, load reanalysis data (default is False).</p></li>
<li><p><strong>month_of_initialization</strong> (<em>int</em><em>, </em><em>optional</em>) – Month of model initialization.</p></li>
<li><p><strong>lead_time</strong> (<em>list</em><em>, </em><em>optional</em>) – List of lead times in months.</p></li>
<li><p><strong>year_forecast</strong> (<em>int</em><em>, </em><em>optional</em>) – Forecast year.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Standardized and interpolated data array for the specified region.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.reverse_standardize">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">reverse_standardize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds_st</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.reverse_standardize" title="Link to this definition"></a></dt>
<dd><p>Reverse standardization of a dataset to original units.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds_st</strong> (<em>xarray.Dataset</em><em> or </em><em>xarray.DataArray</em>) – Standardized dataset or data array (z-scores).</p></li>
<li><p><strong>ds</strong> (<em>xarray.Dataset</em><em> or </em><em>xarray.DataArray</em>) – Original dataset used to compute standardization parameters.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year of the climatology period. If None, uses the full time range.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year of the climatology period. If None, uses the full time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dataset or data array in original units.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset or xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Reverses standardization using ds_st * std + mean, where mean and std are
computed from the original dataset over the specified period.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.standardize_timeseries">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">standardize_timeseries</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_start</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clim_year_end</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.standardize_timeseries" title="Link to this definition"></a></dt>
<dd><p>Standardize a dataset over a specified climatology period.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ds</strong> (<em>xarray.Dataset</em><em> or </em><em>xarray.DataArray</em>) – Input dataset or data array to standardize.</p></li>
<li><p><strong>clim_year_start</strong> (<em>int</em><em>, </em><em>optional</em>) – Start year of the climatology period. If None, uses the full time range.</p></li>
<li><p><strong>clim_year_end</strong> (<em>int</em><em>, </em><em>optional</em>) – End year of the climatology period. If None, uses the full time range.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Standardized dataset or data array (z-scores).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.Dataset or xarray.DataArray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Standardization is performed as (ds - mean) / std, where mean and std are
computed over the specified climatology period or the entire time dimension.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.svp">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">svp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">T</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.svp" title="Link to this definition"></a></dt>
<dd><p>Calculate saturated vapor pressure (es) using FAO-56 Equation 3.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>T</strong> (<em>xarray.DataArray</em><em> or </em><em>numpy.ndarray</em>) – Air temperature in degrees Celsius.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Saturated vapor pressure in kPa, with same shape as input.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray or numpy.ndarray</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Based on the Tetens equation as presented in FAO-56.</p></li>
<li><p>Assumes input temperature is in Celsius.</p></li>
</ul>
<p class="rubric">References</p>
<p>Allen, R. G., Pereira, L. S., Raes, D., &amp; Smith, M. (1998). Crop
evapotranspiration: Guidelines for computing crop water requirements.
FAO Irrigation and Drainage Paper 56.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.to_iridl_lat">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">to_iridl_lat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#wass2s.utils.to_iridl_lat" title="Link to this definition"></a></dt>
<dd><p>Convert numeric latitude to IRIDL latitude string format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>lat</strong> (<em>float</em>) – Latitude value in degrees (positive for North, negative for South).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>IRIDL-formatted latitude string (e.g., ‘10N’ for +10, ‘5S’ for -5).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_iridl_lat</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">&#39;10N&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_iridl_lat</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span>
<span class="go">&#39;5S&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.to_iridl_lon">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">to_iridl_lon</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lon</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">str</span></span></span><a class="headerlink" href="#wass2s.utils.to_iridl_lon" title="Link to this definition"></a></dt>
<dd><p>Convert numeric longitude to IRIDL longitude string format.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>lon</strong> (<em>float</em>) – Longitude value in degrees (positive for East, negative for West).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>IRIDL-formatted longitude string (e.g., ‘15E’ for +15, ‘15W’ for -15).</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">to_iridl_lon</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="go">&#39;15E&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">to_iridl_lon</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">)</span>
<span class="go">&#39;15W&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.trend_data">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">trend_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.trend_data" title="Link to this definition"></a></dt>
<dd><p>Compute trends in data using ExtendedEOF.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>data</strong> (<em>xarray.DataArray</em>) – Input data array with time dimension ‘T’.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Trended data array based on the first mode of ExtendedEOF.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xarray.DataArray</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>RuntimeError</strong> – If ExtendedEOF fitting fails.</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Missing values are filled with the time mean before fitting.
Uses ExtendedEOF with specified parameters (n_modes=2, tau=1, embedding=3, n_pca_modes=20).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="wass2s.utils.verify_station_network">
<span class="sig-prename descclassname"><span class="pre">wass2s.utils.</span></span><span class="sig-name descname"><span class="pre">verify_station_network</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df_filtered</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">extent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">map_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Rain-gauge</span> <span class="pre">network'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#wass2s.utils.verify_station_network" title="Link to this definition"></a></dt>
<dd><p>Plot station locations on a map to verify the station network.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df_filtered</strong> (<em>pandas.DataFrame</em>) – DataFrame containing station data with ‘STATION’ column (‘LAT’, ‘LON’) and station names.</p></li>
<li><p><strong>extent</strong> (<em>list</em>) – Geographic extent in the format [west, east, south, north].</p></li>
<li><p><strong>map_name</strong> (<em>str</em><em>, </em><em>optional</em>) – Title of the map (default is ‘Rain-gauge network’).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Stations are plotted as red markers with labels, using Cartopy for map features.</p>
</dd></dl>

</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ImplementWASNextGen.html" class="btn btn-neutral float-left" title="Implementation of WAS-NextGen Approaches" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Mandela C. M. HOUNGNIBO.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>